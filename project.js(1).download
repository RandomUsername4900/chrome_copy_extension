!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};e[s].call(i.exports,i,i.exports,n);i.l=!0;return i.exports}var s=[{name:"head-dlb/bundle.production.js",path:"head-dlb/static-1.368/bundle.production.js",ids:{}},{name:"hubspot-dlb/bundle.production.js",path:"hubspot-dlb/static-1.427/bundle.production.js",ids:{enviro:1}}];n.dlbpr=function(e,t){var i=s[e];if(!i.r){i.r=window["__webpack_require_"+i.name+"__"];if(!i.r)throw new Error("dlb "+i.name+" not loaded");i.r.linkDlb(n,i.ids)}return i.r(t)};n.m=e;n.c=t;n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})};n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:!0})};n.t=function(e,t){1&t&&(e=n(e));if(8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);n.r(s);Object.defineProperty(s,"default",{enumerable:!0,value:e});if(2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s};n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="//static.hsappstatic.net/calling-cross-tab-embed/static-1.9075/";n(n.s=22)}([function(e,t,n){e.exports=n.dlbpr(1,9)},function(e,t,n){e.exports=n.dlbpr(0,9)},function(e,t,n){e.exports=n.dlbpr(0,5)},function(e,t,n){e.exports=n.dlbpr(1,22)},function(e,t,n){e.exports=n.dlbpr(0,10)},function(e,t,n){e.exports=n.dlbpr(1,31)},function(e,t,n){e.exports=n.dlbpr(1,80)},,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t);var s=n(0),i=n.n(s),a=n(2),o=n.n(a);let r,d;function c(){return r?Promise.resolve(r):i()().then(e=>{o.a.setUserContext({id:e.user.user_id,email:e.user.email,locale:e.user.locale});r=e;return e})}!function(e){e.UNINITIALIZED="UNINITIALIZED";e.STARTED="STARTED";e.SUCCEEDED="SUCCEEDED";e.FAILED="FAILED";e.DEPRECATED="DEPRECATED";e.UNSUPPORTED="UNSUPPORTED"}(d||(d={}));const l="REGISTER_PORT_CONNECTION_ACK",E="REGISTER_PORT_CONNECTION_ACK_FAILED",_="HEARTBEAT_REQUEST",p="PORT_CONNECTION_COMPLETE",g=e=>e&&e.type===_;function u(e){return e&&e.type===l}function h(e){return e&&e.type===E}function D(e){return e&&e.type===p}function R(e,t){if(null==e)return{};var n,s,i={},a=Object.keys(e);for(s=0;s<a.length;s++){n=a[s];t.indexOf(n)>=0||(i[n]=e[n])}return i}const A=(e="")=>{let t,n="";for(let e=0;e<32;e++){t=16*Math.random()|0;8!==e&&12!==e&&16!==e&&20!==e||(n+="-");n+=(12===e?4:16===e?3&t|8:t).toString(16)}return`${e}_${n}`};function I({type:e,name:t,version:n}){return{type:e,format:t+"_shared-worker-versioning",id:A(`${t}_${e}`),version:n}}const T="REGISTER_PORT_CONNECTION",m="UN_REGISTER_PORT_CONNECTION",O="HEARTBEAT_RESPONSE";const C=({name:e,requestId:t,version:n})=>Object.assign({},I({type:O,name:e,version:n}),{destinationConnectionId:_,responseRequest:{requestId:t}});function N(e){let{name:t,originConnectionId:n,appDataVersion:s,portalId:i}=e,a=R(e,["name","originConnectionId","appDataVersion","portalId"]);return Object.assign({},I({name:t,type:T,version:s}),{originConnectionId:n,responseRequest:{type:l},payload:Object.assign({appDataVersion:s,portalId:i},a)})}const S=({originConnectionId:e,appDataVersion:t,name:n})=>Object.assign({},I({type:m,name:n,version:t}),{originConnectionId:e,payload:{appDataVersion:t,name:n}});function f({url:e,name:t}){const n={worker:null,error:null};try{n.worker=new SharedWorker(e,{name:t,credentials:"include"})}catch(e){n.error=e}return n}const b="Error From WorkerScript",M=({url:e,workerName:t,onMessage:n,onMessageError:s,version:i})=>{const{worker:a,error:o}=f({name:t,url:e});if(!a||o)throw o;a.addEventListener("error",e=>{s(new Error(b),{message:e.message,lineno:e.lineno,filename:e.filename})});a.port.addEventListener("message",e=>{e&&e.data&&g(e.data)?a.port.postMessage(C({name:t,requestId:e.data.id,version:i})):n(e)});a.port.addEventListener("messageerror",e=>{const t=e&&e.data?e.data:{};s(new Error("Message Error in Shared Worker Port"),{messageData:t})});a.port.start();return a};var v=n(3);function w(e){let t,n=!1;return function(...s){if(!n){n=!0;t=e.apply(this,s)}return t}}const P=w(()=>{const e=Object(v.parse)(window.location.search.substring(1));e.origin&&(e.origin=decodeURIComponent(e.origin));return e}),W=()=>{const{connectionType:e}=P();return{connectionType:e}};function y(){let e="#";for(let t=0;t<3;t++)e+=("0"+Math.floor((1+Math.random())*Math.pow(16,2)/2).toString(16)).slice(-2);return e}class U{constructor(e){this._color=y();this.connectionType="";this.log=(...e)=>{let t=`%c[${this.connectionType?this.connectionType.toLowerCase()+"-":""}${this._prefix}]: `;if(console.groupCollapsed&&e.length>1){const[n,...s]=e;if(Array.isArray(n)){const[e,s]=n;t+=e;console.groupCollapsed(t,`color:${this._color};`,s)}else{t+=n;console.groupCollapsed(t,`color:${this._color};`)}console.log(...s);console.groupEnd();return}const[n,...s]=e;t+=n;console.log(t,`color:${this._color};`,...s)};this._prefix=e}}const L="DEBUG_CALLING_SHARED_WORKER",k={messageDebug:!1,localEmbed:!1};let B=!1;const V=()=>{if(B)return k;B=!0;try{if(localStorage&&"true"===localStorage.getItem(L)){k.messageDebug=!0;k.localEmbed=!0;return k}const e=localStorage&&JSON.parse(localStorage.getItem(L)||"{}");if(e){const{messageDebug:t,localEmbed:n}=e;k.messageDebug=!0===t;k.localEmbed=!0===n}return k}catch(e){return k}},G="calling-cross-tab-embed";let F;const K=w(()=>{try{if(V().messageDebug){if(F)return F.log;F=new U(""+G);return F.log}}catch(e){}}),j=(...e)=>{const t=K();t&&t(...e)};let $;!function(e){e.WEB_WORKER="WEB_WORKER";e.SHARED_WORKER="SHARED_WORKER"}($||($={}));var x=n(4),q=n.n(x);const z="/calling-cross-tab-embed",H=z+"/shared-worker.js";function Y(e,t={},n="error"){if("function"==typeof console.group){console.groupCollapsed(`%c ${e.name||"UnknownError"} ${n.toUpperCase()} %c`,`background-color:#${"error"===n?"c51212":"516f90"};color:white;padding:.15em .25em`,"color:#33475b",e.message);console.log("Message: "+e.message);console.log(t);console.error(e);console.groupEnd()}}const Z={level:"error",tags:{},extra:{},fingerprint:[]},J=(e,t={})=>{const n=Object.assign({},Z,{},t),s=window.newrelic&&window.newrelic.noticeError;"function"==typeof s&&"error"===n.level&&s(e,n.tags);window.Raven&&window.Raven.captureException&&window.Raven.captureException(e,n);Y(e,n.extra,n.level)};let X;!function(e){e.CURRENT="0.0.9";e["0.0.8"]="0.0.8";e["0.0.7"]="0.0.7"}(X||(X={}));const Q=X.CURRENT,ee="calling";class te extends Error{constructor({message:e,criticalFailure:t,details:n}){super(e);this.details={};this.name="CallingCrossTabClientError";"captureStackTrace"in Error&&Error.captureStackTrace(this,this.constructor);this.details=n||{};this.criticalFailure=Boolean(t)}}let ne;!function(e){e.UNINITIALIZED="UNINITIALIZED";e.LOADING="LOADING";e.READY="READY";e.INITIALIZING_OUTBOUND_CALL="INITIALIZING_OUTBOUND_CALL";e.INCOMING_INBOUND_CALL="INCOMING_INBOUND_CALL";e.RINGING="RINGING";e.ANSWERED="ANSWERED";e.ENDING="ENDING";e.ENDED="ENDED";e.SYNC_TIMEOUT="SYNC_TIMEOUT"}(ne||(ne={}));ne.UNINITIALIZED,ne.LOADING,ne.READY,ne.INITIALIZING_OUTBOUND_CALL,ne.INCOMING_INBOUND_CALL,ne.RINGING,ne.ANSWERED,ne.ENDING,ne.ENDED,ne.SYNC_TIMEOUT;let se;!function(e){e.NONE="NONE";e.FETCH_TOKEN_ERROR="FETCH_TOKEN_ERROR"}(se||(se={}));const ie=A(),ae=()=>({version:Q,deprecated:!1,widgetDetails:{uuid:ie,callStatus:ne.READY,activeCallDetails:void 0,standaloneConnectionId:void 0,deviceErrorCode:void 0,criticalFailureReason:se.NONE}});class oe{constructor(){this._appData=ae();this.getAppData=()=>this._appData;this.setAppData=e=>{V().messageDebug&&j("appData Updated",{next:JSON.parse(JSON.stringify(e)),previous:JSON.parse(JSON.stringify(this._appData))});this._appData=Object.assign({},e)};this.updateToDeprecated=()=>{const e=ae();e.deprecated=!0;this._appData=e};this.setWidgetDetails=e=>{this._appData.widgetDetails=Object.assign({},e)}}}var re=new oe;let de;!function(e){e.APP_DATA_UPDATE="APP_DATA_UPDATE";e.APP_DATA_UPDATED="APP_DATA_UPDATED";e.BROADCAST="BROADCAST";e.FROM_WORKER="FROM_WORKER";e.TO_WORKER="TO_WORKER";e.TO_SERVICE_WORKER="TO_SERVICE_WORKER"}(de||(de={}));function ce(e){return e&&e.metadata&&e.metadata.messageRelayType===de.BROADCAST}function le(e){if(!e||!e.data){J(new Error("message event does not have a data attribute"),{extra:{messageEventType:e.type}});return!1}if(!e.data.destinationConnectionId)return!0;const t=e.data,{connectionId:n}=P();return n===t.destinationConnectionId}const Ee="__calling_cross_tab_message";function _e(e){return e&&e.format===Ee}const pe=/(?:(?:app(?:-[a-z]{0,2}\d)?)|(?:local))\.hubspot(?:qa)?\.com/,ge=e=>"__shared-worker-versioning-embed-message--"+e,ue=e=>({format:ge(e),id:A(e)});let he;!function(e){e.TO_EMBED="TO_EMBED";e.FROM_EMBED="FROM_EMBED";e.EMBED_READY="EMBED_READY";e.EMBED_INIT_FAILED="EMBED_INIT_FAILED";e.EMBED_WORKER_CONNECTION_STATUS_UPDATE="EMBED_WORKER_CONNECTION_STATUS_UPDATE"}(he||(he={}));const De=(e,t)=>{const n=ge(t);return Boolean(e&&e.id&&e.format===n)},Re=e=>Boolean(e.type&&e.type===he.TO_EMBED),Ae=(e,t)=>Object.assign({},ue(e),{type:he.FROM_EMBED,message:t}),Ie=(e,t)=>Object.assign({},ue(e),{type:he.EMBED_READY,payload:t}),Te=(e,t)=>Object.assign({},ue(e),{type:he.EMBED_INIT_FAILED,payload:t}),me=(e,t,n)=>Object.assign({},ue(e),{type:he.EMBED_WORKER_CONNECTION_STATUS_UPDATE,payload:{appData:t,status:n}}),Oe=(e,t,n=window)=>{n.parent.postMessage(e,t)},Ce=w((e,t=window)=>!t.parent||!e);class Ne{constructor(e){this._handleMessage=e=>{if(!(e.origin.match(pe)&&e.data&&e.data.message&&De(e.data,this._options.embedName)&&Re(e.data)))return;const{data:{message:t}}=e;this._options.onParentMessage(t)};this.sendEmbedReadyMessage=e=>{const{parentOrigin:t,embedName:n,logClientDebug:s}=this._options;if(Ce(t))return;const i=Ie(n,e);s("Sending message to embed host "+i.type,i);Oe(i,t)};this.sendFromEmbedMessage=e=>{const{parentOrigin:t,embedName:n,logClientDebug:s}=this._options;if(!Ce(t)){s("Sending message to embed host "+e.type,e);Oe(Ae(n,e),t)}};this.sendWorkerConnectionStatusUpdateMessage=(e,t)=>{const{parentOrigin:n,embedName:s,logClientDebug:i}=this._options;if(!Ce(n)){i(`Sending message to embed host ${he.EMBED_WORKER_CONNECTION_STATUS_UPDATE}, status: ${e}`);Oe(me(s,t,e),n)}};this.sendEmbedInitializationFailedMessage=e=>{const{parentOrigin:t,embedName:n,logClientDebug:s}=this._options;s("Sending message to embed host "+he.EMBED_INIT_FAILED,e);Ne.sendEmbedInitializationFailedMessage(n,t,e)};this._options=e;window.addEventListener("message",this._handleMessage,!1)}}Ne.sendEmbedInitializationFailedMessage=(e,t,n)=>{if(Ce(t))return;const s=Te(e,n);Oe(s,t)};const Se=e=>{_e(e)&&Tt.isInitialized&&Tt.sendMessage(e)};var fe=new Ne({embedName:ee,parentOrigin:P().origin,onParentMessage:Se,logClientDebug:j});let be,Me;!function(e){e.FROM_WORKER_UPDATED_WIDGET_DETAILS="FROM_WORKER_UPDATED_WIDGET_DETAILS";e.FROM_WORKER_STANDALONE_HEARTBEAT="FROM_WORKER_STANDALONE_HEARTBEAT";e.FROM_WORKER_ACTIVE_CALL_CONNECTION_PING="FROM_WORKER_ACTIVE_CALL_CONNECTION_PING"}(be||(be={}));!function(e){e.FROM_WORKER_UPDATED_APPDATA="FROM_WORKER_UPDATED_APPDATA"}(Me||(Me={}));function ve(e){return e&&e.type===be.FROM_WORKER_STANDALONE_HEARTBEAT}function we(e){return e&&e.type===be.FROM_WORKER_ACTIVE_CALL_CONNECTION_PING}function Pe(e){return e.type===be.FROM_WORKER_UPDATED_WIDGET_DETAILS}function We(e,t){return e&&t?e.uuid===t.uuid:e===t}const ye=(e,t)=>{const n=e,s=[];if(!We(e.widgetDetails,t)){n.widgetDetails=t;s.push("widgetDetails")}return{result:n,updates:s}};function Ue(e){return{format:Ee,id:A(e),metadata:{messageRelayType:e},version:Q}}let Le;!function(e){e.UPDATED_APP_DATA="UPDATED_APP_DATA";e.UPDATED_WIDGET_DETAILS="UPDATED_WIDGET_DETAILS"}(Le||(Le={}));const ke=({destinationConnectionId:e,appData:t,updates:n})=>Object.assign({},Ue(de.APP_DATA_UPDATED),{type:Le.UPDATED_WIDGET_DETAILS,destinationConnectionId:e,payload:{appData:t,updates:n}});let Be;!function(e){e.UPDATE_WIDGET_DETAILS="UPDATE_WIDGET_DETAILS";e.WEBWORKER_APPDATA_RESPONSE="WEBWORKER_APPDATA_RESPONSE";e.FROM_WORKER_STANDALONE_HEARTBEAT_RESPONSE="FROM_WORKER_STANDALONE_HEARTBEAT_RESPONSE";e.FROM_WORKER_ACTIVE_CALL_CONNECTION_PING_RESPONSE="FROM_WORKER_ACTIVE_CALL_CONNECTION_PING_RESPONSE"}(Be||(Be={}));const Ve=({widgetDetails:e,originConnectionId:t})=>Object.assign({},Ue(de.APP_DATA_UPDATE),{type:Be.UPDATE_WIDGET_DETAILS,originConnectionId:t,payload:{updatedWidgetDetails:e}}),Ge=e=>Object.assign({},Ue(de.APP_DATA_UPDATE),{type:Be.UPDATE_WIDGET_DETAILS,originConnectionId:e,payload:{updatedWidgetDetails:{activeCallDetails:void 0,callStatus:ne.READY}}}),Fe=e=>Object.assign({},Ue(de.TO_WORKER),{type:Be.FROM_WORKER_STANDALONE_HEARTBEAT_RESPONSE,destinationConnectionId:de.FROM_WORKER,responseRequest:{requestId:e}}),Ke=e=>Object.assign({},Ue(de.TO_WORKER),{type:Be.FROM_WORKER_ACTIVE_CALL_CONNECTION_PING_RESPONSE,destinationConnectionId:de.FROM_WORKER,responseRequest:{requestId:e}});let je;!function(e){e.STANDALONE_CALLING_APP="STANDALONE_CALLING_APP";e.EXTERNAL="EXTERNAL"}(je||(je={}));function $e(){let e=!1;const t=()=>{const{connectionId:e}=P();if(re.getAppData().widgetDetails.activeCallDetails){j("ActiveCallUnloadEventUtil - resetting activeCallDetails");Tt.sendMessage(Ge(e))}};return{addActiveCallUnloadEvent:()=>{if(!e){j("ActiveCallUnloadEventUtil - adding unload event");e=!0;window.addEventListener("unload",t)}},removeActiveCallUnloadEvent:n=>{const{callStatus:s,activeCallDetails:i}=n;if(e&&P().connectionType===je.EXTERNAL&&s===ne.READY&&void 0===i){j("ActiveCallUnloadEventUtil - removing unload event");e=!1;window.removeEventListener("unload",t)}}}}var xe=$e();const qe=e=>{const t=re.getAppData();t.deprecated||t.widgetDetails.standaloneConnectionId!==P().connectionId||Tt.sendMessage(Fe(e.id))},ze=e=>{const{result:t,updates:n}=ye(re.getAppData(),e.payload.widgetDetails);re.setAppData(t);fe.sendFromEmbedMessage(ke({destinationConnectionId:e.destinationConnectionId,appData:t,updates:n}));xe.removeActiveCallUnloadEvent(t.widgetDetails)},He=e=>{if(!e.destinationConnectionId||e.destinationConnectionId===P().connectionId){j("Received BroadcastRelay Message from Shared Worker "+e.type,e);fe.sendFromEmbedMessage(e)}},Ye=e=>{Tt.sendMessage(Ke(e.id));xe.addActiveCallUnloadEvent()},Ze=e=>{re.setAppData(e);const{connectionType:t,connectionId:n}=P();t===je.STANDALONE_CALLING_APP&&window.addEventListener("unload",()=>{if(re.getAppData().widgetDetails.standaloneConnectionId===n){const{standaloneConnectionId:e,activeCallDetails:t,callStatus:s,criticalFailureReason:i}=ae().widgetDetails;Tt.sendMessage(Ve({originConnectionId:n,widgetDetails:{standaloneConnectionId:e,activeCallDetails:t,callStatus:s,criticalFailureReason:i}}))}})};function Je(e){const{data:t}=e;if(u(t))Ze(t.payload);else if(le(e)){t&&t.type&&j("Received Message from Shared Worker "+t.type,t);Pe(t)?ze(t):ve(t)?qe(t):we(t)?Ye(t):ce(t)&&He(t)}}const Xe=w(()=>Boolean(window.SharedWorker)&&Boolean(window.BroadcastChannel));let Qe;!function(e){e.MISSING_SHARED_WORKER_SUPPORT="MISSING_SHARED_WORKER_SUPPORT";e.UNSUPPORTED_USER_AGENT="UNSUPPORTED_USER_AGENT";e.EMBEDDED="EMBEDDED";e.INAPPLICABLE="INAPPLICABLE"}(Qe||(Qe={}));const et=()=>{const e=navigator.userAgent;if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e))return!1;const t=e?navigator.userAgent.toLowerCase():"";return!(t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("edge/"))};let tt;const nt=()=>{void 0===tt&&(tt=Xe()&&et());return tt};var st=n(5);const it=w(()=>Object(st.createMetricsFactory)("calling-cross-tab-embed",{dimensions:{crossTabMessagingSupport:""+nt(),connectionVersion:Q}})),at=w(A),ot=({channelName:e,onMessage:t,onMessageError:n})=>{if("function"!=typeof BroadcastChannel)return null;const s=new BroadcastChannel(e+"-version-deprecation");s.onmessage=t;s.onmessageerror=e=>{const t=e&&e.data?e.data:{};n(new Error("Message Error in Version Broadcast Channel"),{messageData:t})};return s},rt=({name:e,workerVersion:t,portalId:n})=>{let s=e;n&&(s+="#"+n);t&&(s+="@"+t);return s};function dt(){let e=()=>{},t=()=>{};return{promise:new Promise((n,s)=>{e=n;t=s}),resolve:e,reject:t}}var ct=dt;const lt=2e4;let Et;!function(e){e.MESSAGE_RECIEVED="MESSAGE_RECIEVED";e.MESSAGE_TIMEOUT="MESSAGE_TIMEOUT";e.MESSAGE_ERROR="MESSAGE_ERROR"}(Et||(Et={}));function _t(e){return e.status===Et.MESSAGE_RECIEVED}function pt({port:e,message:t,errorAckMessageType:n,timeout:s}){if(!(t.type&&t.originConnectionId&&t.responseRequest&&t.responseRequest.type))return Promise.resolve({status:Et.MESSAGE_ERROR,responseMessageType:t&&t.responseRequest&&t.responseRequest.type||"unknown",errorMessage:`Send Ack requires a type an originConnectionId and responseRequest info, recieved: ${t.type}, ${t.originConnectionId}`});const i=t.responseRequest.type;let a="Never received message type "+i;const o=ct(),r=()=>new Promise(e=>setTimeout(()=>{e({status:Et.MESSAGE_TIMEOUT,responseMessageType:i,errorMessage:a})},"number"==typeof s?s:lt)),d=e=>{if(Boolean(e.data)&&(e.data.type===i||n&&e.data.type===n))if(e.data.responseRequest.requestId!==t.id||e.data.destinationConnectionId!==t.originConnectionId)a=`Recieved Message ${i} with non-matching requestId: ${e.data.responseRequest.requestId===t.id} or connectionId: ${e.data.destinationConnectionId===t.originConnectionId} error`;else{if(e.data.type===i){o.resolve({status:Et.MESSAGE_RECIEVED,responseMessageType:i,messageEvent:e});return}o.resolve({status:Et.MESSAGE_ERROR,responseMessageType:i,messageEvent:e})}else a=`Never received message type ${i}, Last message type is ${e.data&&e.data.type||"unknown"}`};e.addEventListener("message",d);try{e.postMessage(t)}catch(e){return Promise.resolve({status:Et.MESSAGE_ERROR,responseMessageType:i,errorMessage:`Failed to send postMessage for sync message ${t.type} reason: ${e.message}`})}return Promise.race([r(),o.promise]).then(t=>{e.removeEventListener("message",d);return t})}let gt;!function(e){e.VERSION_DEPRECATION="VERSION_DEPRECATION"}(gt||(gt={}));function ut(e,t){return Object.assign({},e,{payload:e.payload||{},originConnectionId:t})}class ht{constructor(e){this._versionBroadcastChannel=null;this._sharedWorker=null;this._sendPortRegistration=()=>{this._debug&&this._debug("Registering connection with SharedWorker");const e=N(Object.assign({name:this._name,originConnectionId:this._connectionId,appDataVersion:this._appDataVersion,portalId:this._portalId},this._getAdditionalRegistrationInformation()));return pt({port:this._sharedWorker.port,errorAckMessageType:E,message:e})};this._handleSharedWorkerInitialized=e=>{if(!(e.messageEvent&&e.messageEvent.data&&_t(e)&&u(e.messageEvent.data))){let t,n=e.errorMessage||`${e.responseMessageType} never recieved for an unknown reason, status ${e.status}.`;const s=e.messageEvent&&e.messageEvent.data;if(s&&h(s)){n=`${e.responseMessageType} never recieved, ${s.payload.message}`;t=s.payload.stack}throw new Error(n,{cause:t})}const{data:t}=e.messageEvent;this._debug&&this._debug("SharedWorker registration succeeded");return t.payload};this._handleWorkerBroadcastChannelMessage=e=>{if(!e.data||e.data.type!==gt.VERSION_DEPRECATION||!e.data.payload||e.data.payload.workerVersion===this._clientVersion)return;const{payload:{workerVersion:t}}=e.data;if(this._clientVersion!==t&&this._sharedWorker&&this._versionBroadcastChannel){this._debug&&this._debug(`Recieved version deprecation message from ${this._versionBroadcastChannel.name},\n        current version is ${this._clientVersion} new version is ${t}`);this.refreshVersionedSharedWorkerClient(t)}};this.sendMessage=e=>{if(this._sharedWorker){const t=ut(e,this._connectionId);try{this._sharedWorker.port.postMessage(t)}catch(e){this._onMessageError(new Error(`SharedWorkerMessagingClient#sendMessage error unable to send ${t.type}, reason: ${e&&e.message}`))}}else this._onMessageError(new Error(`SharedWorkerMessagingClient#sendMessage error unable to send ${e.type}, reason: shared worker does not exist`))};this.connect=()=>new Promise((e,t)=>{try{const t=rt({portalId:this._portalId,name:this._name,workerVersion:this._clientVersion});this._versionBroadcastChannel||(this._versionBroadcastChannel=ot({channelName:this._name,onMessage:this._handleWorkerBroadcastChannelMessage,onMessageError:this._onMessageError}));this._sharedWorker=M({url:`${this._sharedWorkerUrl}?v=${this._clientVersion}`,workerName:t,onMessage:this._onMessage,onMessageError:this._onMessageError,version:this._appDataVersion});this._debug&&this._debug("Opened connection to SharedWorker: "+t);e(void 0)}catch(e){this._debug&&this._debug("Failed to open connection to SharedWorker",e);t(e)}});this.close=()=>{const e=S({originConnectionId:this._connectionId,appDataVersion:this._appDataVersion,name:this._name});this._sharedWorker&&this._sharedWorker.port.postMessage(e)};this.open=()=>this.connect().then(this._sendPortRegistration).then(this._handleSharedWorkerInitialized).catch(e=>{this._versionBroadcastChannel&&this._versionBroadcastChannel.close();throw e});this.refreshVersionedSharedWorkerClient=e=>{this._onVersionWorkerStatusUpdate(d.STARTED);this._clientVersion=e;if(this._sharedWorker){this._sharedWorker.port.postMessage(S({originConnectionId:this._connectionId,name:this._name,appDataVersion:this._appDataVersion}));this._sharedWorker.port.close();this._sharedWorker=null}this._debug&&this._debug("Refreshing version, new version is "+this._clientVersion);return this.connect().then(this._sendPortRegistration).then(this._handleSharedWorkerInitialized).then(e=>{if(!e)throw new Error("WorkerRefresh failed with no data");this._onVersionWorkerStatusUpdate(d.SUCCEEDED,e)}).catch(e=>{this._debug&&this._debug("WorkerRefresh failed",e);this._onVersionWorkerStatusUpdate(d.FAILED);this._versionBroadcastChannel&&this._versionBroadcastChannel.close()})};const{portalId:t,connectionId:n,initialClientVersion:s,name:i,sharedWorkerUrl:a,onMessage:o,onMessageError:r,onVersionWorkerStatusUpdate:c,getAdditionalRegistrationInformation:l,appDataVersion:_,debug:p}=e;this._connectionId=n;this._portalId=t;this._appDataVersion=_;this._debug=p;this._onMessage=o;this._clientVersion=s;this._name=i;this._sharedWorkerUrl=a;this._getAdditionalRegistrationInformation=l;this._onMessageError=r;this._onVersionWorkerStatusUpdate=c}get clientVersion(){return this._clientVersion}get type(){return ht.type}}ht.type="SUPPORTED_CLIENT";const Dt=()=>({isPortalSpecific:!0,getAdditionalRegistrationInformation:()=>({}),onDisconnect:()=>{},onMessage:()=>{},onMessageError:(e,t)=>{}}),Rt="UNSUPPORTED";class At{constructor(e){this._initialized=!1;this.disconnect=e=>{this._clientOptions.debug&&this._clientOptions.debug("Disconnecting from SharedWorker");e||window.removeEventListener("unload",this.disconnect);this._onDisconnect();this._client&&this._client.close()};this.sendMessage=e=>{if(this._client&&this._initialized){this._clientOptions.debug&&this._clientOptions.debug("Sending message to SharedWorker "+e.type,e);this._client.sendMessage(e)}else this._clientOptions.onMessageError(new Error("Message Client does not exist or is not ready"))};this.initialize=(e,t=ht)=>new Promise((n,s)=>{this._initialized=!0;if(Xe()){this._client=new t(Object.assign({},this._clientOptions,{connectionId:e||this._clientOptions.connectionId}));window.addEventListener("unload",this.disconnect);this._client.open().then(n).catch(e=>{this._clientOptions.debug&&this._clientOptions.debug("Failed to setup SharedWorker");s(e)})}else{this._clientOptions.debug&&this._clientOptions.debug("SharedWorkers are unsupported");s(new Error("SharedWorkers are "+Rt))}});const{portalId:t,version:n,name:s,sharedWorkerUrl:i,onMessage:a,onVersionWorkerStatusUpdate:o,onDisconnect:r,onMessageError:d,getAdditionalRegistrationInformation:c,debug:l}=Object.assign({},Dt(),{},e);this._appDataVersion=n;this._clientOptions={portalId:t||"",onMessage:a,onMessageError:d,initialClientVersion:n,appDataVersion:this._appDataVersion,name:s,onVersionWorkerStatusUpdate:o,getAdditionalRegistrationInformation:c,sharedWorkerUrl:i,debug:l,connectionId:at()};this._onDisconnect=r}get appDataVersion(){return this._appDataVersion}get connectionId(){return this._clientOptions.connectionId}get isInitialized(){return this._initialized}get clientVersion(){return this._client&&this._client.clientVersion||void 0}}class It{constructor(){this.messageClientType=$.SHARED_WORKER;this.isInitialized=!1;this.sharedWorkerConnected=!1;this._swDetails={wasConnectionMade:!1,currentPortConnections:0,swSentErrorEvent:!1};this._handleWorkerMessage=e=>{const{data:t}=e;if(D(t)){this._swDetails.wasConnectionMade=!0;this._swDetails.currentPortConnections=t.payload.connectionTotal}else Je(e)};this._handleMessageError=(e,t)=>{if(e&&e.message===b&&!this.sharedWorkerConnected){this._swDetails.swSentErrorEvent=!0;if(!t||!t.message){it().counter("generic-worker-error-received").increment();return}}it().counter("worker-error-received").increment();j(e);J(e,{extra:t})};this.sendMessage=e=>{const t=re.getAppData();t.deprecated?it().counter("deprecated-send-message-attempt",{version:t.version,type:e.type}).increment():this._messageClient.sendMessage(e)};this.handleVersionWorkerStatusUpdate=(e,t)=>{let n=e;if(t)if(t.deprecated){n=d.DEPRECATED;re.updateToDeprecated()}else re.setAppData(t);j("Connection status updated: "+n,t);it().counter("embed-connection-status-update",{appDataVersion:re.getAppData().version,connectionStatus:n}).increment();fe.sendWorkerConnectionStatusUpdateMessage(n,re.getAppData())};this._messageClient=new At({debug:j,portalId:""+q.a.get(),version:Q,name:ee,sharedWorkerUrl:H,onMessage:this._handleWorkerMessage,onVersionWorkerStatusUpdate:this.handleVersionWorkerStatusUpdate,onMessageError:this._handleMessageError,getAdditionalRegistrationInformation:W})}initialize(){if(this.isInitialized)return Promise.resolve();this.isInitialized=!0;return this._messageClient.initialize(P().connectionId).then(e=>{e&&(this.sharedWorkerConnected=!0);return e}).catch(e=>{throw new te({message:"Shared Worker connection failure: "+e.message,details:Object.assign({error:e},this._swDetails)})})}}var Tt=new It,mt=n(6),Ot=n.n(mt);const Ct=15e3;class Nt{constructor(){this.ping=()=>{Ot.a.put("calling-orchestration/v1/calling-tab-presence/heartbeat").catch(e=>{if(e&&[401,403].includes(e.status)){clearInterval(this._interval);this._interval=void 0}})}}start(){this._interval=setInterval(this.ping,Ct);this.ping()}}class St{constructor(){this._presenceManager=new Nt;this._isParentWindowEmbedded=!1;this._isCallingAvailable=!1;this._wasTabDiscarded=void 0;this._isStandaloneTab=!1;this.setCallingLimits=e=>{if(!e)return;const{portal:t,user:n}=e,s=Boolean(t&&t.limits&&t.limits["calling-minutes-per-portal"]&&t.limits["calling-minutes-per-portal"]>0),i=Boolean(n&&n.scopes&&n.scopes.some(e=>["sales-calling-limit-medium","sales-calling-limit-high","super-user"].includes(e)));this._isCallingAvailable=s&&i};this.startCrossTabServices=e=>{this.setCallingLimits(e);if(!nt()){const e=re.getAppData();fe.sendEmbedReadyMessage(e);fe.sendWorkerConnectionStatusUpdateMessage(d.UNSUPPORTED,e);return Promise.resolve()}return Tt.initialize().then(e=>{if(!e)throw new te({message:"AppData not received"});return fe.sendEmbedReadyMessage(re.getAppData())}).then(()=>{performance&&"function"==typeof performance.now&&it().timer("embed-initialized",{isCallingAvailable:""+this._isCallingAvailable,isParentWindowEmbedded:""+this._isParentWindowEmbedded,wasTabDiscarded:""+this._wasTabDiscarded,isStandaloneTab:""+this._isStandaloneTab}).update(performance.now())}).catch(e=>{throw e})};try{this._isParentWindowEmbedded=window.parent!==window.top;const e=window.top||window.parent;this._wasTabDiscarded=e.document.wasDiscarded}catch(e){this._isParentWindowEmbedded=!0}}start(){if(P().connectionType===je.STANDALONE_CALLING_APP){this._presenceManager.start();this._isStandaloneTab=!0}return c().catch(e=>{const t=new te({message:"Calling Cross Tab embed setup failed at User Info, "+e.message});e.stack&&(t.stack=e.stack);J(t,{extra:{isParentWindowEmbedded:this._isParentWindowEmbedded,isCallingAvailable:this._isCallingAvailable}})}).then(e=>{if(e&&e.portal)return this.startCrossTabServices(e);J(new te({message:"userInfo not found"}),{level:"info",extra:{userInfo:e},fingerprint:["userInfo error"]});return fe.sendEmbedInitializationFailedMessage()}).catch(e=>{let t="Calling Cross Tab embed setup failed";e&&e.message&&(t=`${t}, detail: ${e.message}`);const n=new te({message:t});if(e&&!e.xhr&&!e.message.includes("unsupported")){const t=e&&e.details&&e.details.error||void 0;t&&t.stack&&(e.stack=t.stack);const s=[],i=this._isParentWindowEmbedded?"PARENT_IS_EMBEDDED":"PARENT_IS_TOP";s.push(i);let a="CallingCrossTabClientError"===e.name?"CALLING_CROSS_TAB_CLIENT_ERROR":"GENERIC_ERROR";const o=Tt._swDetails.wasConnectionMade?"CONNECTED_TO_SW":"NOT_CONNECTED_TO_SW";s.push(o);Tt._swDetails.swSentErrorEvent&&s.push("SW_ERROR_EVENT_RECIEVED");e.message.includes(l)&&(a=l+"_ERROR");s.push(a);J(n,{extra:{error:e,detailedError:t,isParentWindowEmbedded:this._isParentWindowEmbedded,isCallingAvailable:this._isCallingAvailable},fingerprint:s})}it().counter("embed-failed",{isCallingAvailable:""+this._isCallingAvailable,isParentWindowEmbedded:""+this._isParentWindowEmbedded,wasTabDiscarded:""+this._wasTabDiscarded,isStandaloneTab:""+this._isStandaloneTab}).increment();return fe.sendEmbedInitializationFailedMessage()})}}(new St).start()}]);
//# sourceMappingURL=project.js.map
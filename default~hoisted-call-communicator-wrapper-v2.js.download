(window.webpackJsonp=window.webpackJsonp||[]).push([["default~hoisted-call-communicator-wrapper-v2"],{"/xYP":function(e,t,n){"use strict";n.r(t);var i=n("QgEn"),r=n("Ktcs"),o=n("TvdH"),a=n.n(o),s=n("QYOI"),c=n("c/Td"),l=n.n(c),u=n("bn2T"),d=n("e0QY"),p=n("xA3K"),f=n("66eB"),h=n("VfuR"),m=n.n(h),g=n("9f1P"),v=n.n(g),_=n("FBCs"),b=n("0n1C"),y=n("Ah6I"),S=n("SdFx"),E=n("eu3Z"),T=n("Oc1M"),w=n.n(T);const C=10,I=60,O=w()(({widgetLeft:e,widgetWidth:t,widgetTop:n,widgetHeight:i,targetWidth:r,targetHeight:o})=>{const a=e<C;let s=e;(a||e+t>r-C)&&(s=a?C:r-C-t);const c=n<I;let l=n;(c||n+i>o-C)&&(l=c?I:o-C-i);l<I&&(l=I);s<C&&(s=C);return{left:s,top:l}});class j extends r.PureComponent{constructor(...e){super(...e);this.getDropTargetDimensions=()=>({width:this.dropTarget.offsetWidth,height:this.dropTarget.offsetHeight});this.addResizeListener=()=>{window.addEventListener("resize",this.handleUpdateBoundaries)};this.handleUpdateBoundaries=()=>{const{isWidgetHidden:e}=this.props;e||this.getBoundariedCoordinates()};this.getBoundariedCoordinates=(e={})=>{let t=e.left,n=e.top;t||0===t||(t=this.props.left||0);n||0===n||(n=this.props.top||0);const{height:i,width:r}=this.getDropTargetDimensions(),{updateWidgetCoordinates:o,height:a,width:s,isWidgetMinimized:c}=this.props,l=O({targetHeight:i,targetWidth:r,widgetLeft:t,widgetWidth:s,widgetTop:n,widgetHeight:c?_.b:a}),u=i-l.top,d=r-l.left-C;o(Object.assign({},l,{maxHeight:u,maxWidth:d}))};this.setDropTargetRef=e=>{this.dropTarget=e}}componentDidMount(){const{isWidgetHidden:e,height:t,width:n}=this.props;this.addResizeListener();e||0===t||0===n||e||this.handleUpdateBoundaries()}componentDidUpdate(e){const{height:t,width:n,isWidgetHidden:i}=this.props;if(0===t&&0===n)return;const r=e.height,o=e.width;t===r&&n===o&&i===e.isWidgetHidden||this.handleUpdateBoundaries()}componentWillUnmount(){window.removeEventListener("resize",this.handleUpdateBoundaries)}render(){const{connectDropTarget:e,pointerEvents:t,isWidgetHidden:n}=this.props,r="call-widget__drop-target calling-widget-container"+(n?" hidden":"");return e(Object(i.jsx)("div",{className:r,style:{pointerEvents:t},ref:this.setDropTargetRef}))}}j.propTypes={connectDropTarget:m.a.func.isRequired,isWidgetHidden:m.a.bool.isRequired,isWidgetMinimized:m.a.bool.isRequired,pointerEvents:m.a.string.isRequired,top:m.a.number.isRequired,left:m.a.number.isRequired,height:m.a.number.isRequired,width:m.a.number.isRequired,updateWidgetCoordinates:m.a.func.isRequired};var D=Object(E.DropTarget)("calling-widget",{drop(e,t,n){const i=t.getDifferenceFromInitialOffset(),r=e.left,o=e.top;let a=Math.round(r+i.x),s=Math.round(o+i.y);a<0&&(a=0);s<0&&(s=0);n.getBoundariedCoordinates({top:s,left:a})}},(e,t)=>({connectDropTarget:e.dropTarget(),isOver:t.isOver()}))(j),A=n("mKxs"),P=n("tPYf"),R=n("y3ei");var k=m.a.oneOf(Object.keys(R)),x=n("l0td");var L=m.a.oneOf(Object.keys(x.a)),M=n("KKaK"),N=n.n(M),G=n("foa7"),F=n("/wzi"),W=n("01+O"),U=n("JxOb"),H=n("gYts");function B(e){Object(r.useEffect)(()=>{Object(U.a)("addEventListener",{event:H.SET_SUBJECT_FOR_THIRD_PARTIES,callback:e});return()=>{Object(U.a)("removeEventListener",{event:H.SET_SUBJECT_FOR_THIRD_PARTIES,callback:e})}},[e])}function z(e){Object(r.useEffect)(()=>{Object(U.a)("addEventListener",{event:H.PRELOAD_WIDGET,callback:e});return()=>{Object(U.a)("removeEventListener",{event:H.PRELOAD_WIDGET,callback:e})}},[e])}function q(e){Object(r.useEffect)(()=>{Object(U.a)("addEventListener",{event:H.OPEN_WIDGET,callback:e});return()=>{Object(U.a)("removeEventListener",{event:H.OPEN_WIDGET,callback:e})}},[e])}var V=n("tOiy"),K=n("3Q2O"),Q=n("yYAF"),Y=n("sl/w");const J="CALL_ANSWERED_EMBED_MSG",$="CALL_ENDED_EMBED_MSG",Z="CALL_SAVED_EMBED_MSG",X="CALL_STARTED_EMBED_MSG",ee="CREATE_ZORSE_TICKET_EMBED_MSG",te="CREATED_FOLLOWUP_TASK_EMBED_MSG",ne="NOTIFICATION_EMBED_MSG",ie="REFRESH_CALLEE_OMNIBUS_EMBED_MSG",re="RENDER_DISCARD_FOLLOW_UP_TASK_EMBED_MSG",oe="SET_MINIMUM_DIMENSIONS_EMBED_MSG",ae="SWITCH_TO_THIRD_PARTY_EMBED_MSG",se="RELOAD_EMBED_MSG",ce="INCOMING_CALL_EMBED_MSG",le="SELECTED_CALL_PROVIDER_MSG",ue="SELECTED_FROM_NUMBER_MSG",de="SELECTED_CALL_METHOD_MSG";var pe=n("wM7O"),fe=n("77dM"),he=n("NfVS");const me=v()(pe.a).withConfig({displayName:"VersionDifferenceWarning__StyledUIErrorMessage",componentId:"sc-1pkzboe-0"})(["img{margin-bottom:15px;}"]);function ge(){window.top.location.reload()}function ve(){return Object(i.jsx)("div",{className:"m-top-15 m-x-5",children:Object(i.jsx)(me,{illustration:"errors/general",illustrationProps:{width:80},title:Object(i.jsx)(Y.a,{message:"calling-ui-library.callee-select.versionMisMatchTitle"}),className:"p-x-4 m-y-0",children:Object(i.jsx)(he.a,{message:"calling-ui-library.callee-select.versionMisMatch_jsx",elements:{UILink:fe.a},options:{onClick:ge}})})})}var _e=ve,be=n("JJmA"),ye=n("9ji2"),Se=n("bQHN"),Ee=n.n(Se),Te=n("xEDu"),we=n.n(Te),Ce=n("+KD7"),Ie=n("Xmhe");const Oe=({className:e})=>Object(i.jsx)("div",{className:e,children:Object(i.jsx)(Ie.a,{height:16,width:320})});Oe.propTypes={className:m.a.string};Oe.defaultProps={className:"p-bottom-2"};var je=Object(r.memo)(Oe);const De=({className:e})=>Object(i.jsx)("div",{className:e,children:Object(i.jsx)(Ie.a,{width:120,height:16})});De.propTypes={className:m.a.string};De.defaultProps={className:"p-bottom-2"};var Ae=Object(r.memo)(De),Pe=n("t6nY"),Re=n.n(Pe);function ke({className:e}){return Object(i.jsx)("div",{className:Re()("p-top-4",e),children:Object(i.jsx)(Ie.a,{height:32,width:100})})}ke.propTypes={className:m.a.string};var xe=Object(r.memo)(ke);const Le=v.a.div.withConfig({displayName:"SkeletonRTE__Spacer",componentId:"sc-1rchrsh-0"})(["border-right:1px solid ",";width:0;height:25px;"],Ce.GREAT_WHITE),Me=v.a.div.withConfig({displayName:"SkeletonRTE__Wrapper",componentId:"sc-1rchrsh-1"})(["position:relative;border:1px solid ",";border-width:1px 0;flex:1;"],Ce.GREAT_WHITE),Ne=v.a.div.withConfig({displayName:"SkeletonRTE__Utilities",componentId:"sc-1rchrsh-2"})(["position:sticky;bottom:0;height:26px;"]),Ge=v.a.div.withConfig({displayName:"SkeletonRTE__RTEBody",componentId:"sc-1rchrsh-3"})(["flex:1;"]);function Fe(){return Object(i.jsxs)(Me,{className:"p-top-3 p-bottom-2 flex-column",children:[Object(i.jsx)(Ie.a,{width:40,height:16,className:"m-bottom-2"}),Object(i.jsx)(Ge,{children:Object(i.jsx)(Ie.a,{width:152,height:16})}),Object(i.jsxs)(Ne,{children:[Object(i.jsx)(Ie.a,{width:26,height:25,className:"display-inline-block"}),Object(i.jsx)(Le,{className:"m-x-1 display-inline-block"}),Object(i.jsx)(Ie.a,{width:26,height:25,className:"display-inline-block"})]})]})}var We=Object(r.memo)(Fe);var Ue=v.a.div.withConfig({displayName:"WidgetSettingsWrapper",componentId:"i5c9me-0"})(["display:flex;background-color:",";border-top:1px solid ",";min-height:80px;flex-direction:column;justify-content:center;width:100%;"],Ce.GYPSUM,Ce.OLAF),He=n("H5Pb");function Be(){return Object(i.jsx)("div",{className:"justify-center m-top-3 m-bottom-6",children:Object(i.jsx)(He.a,{size:108})})}const ze=v.a.div.withConfig({displayName:"AppSkeleton__Wrapper",componentId:"sc-6bdmdu-0"})(["position:relative;height:100%;width:100%;"]),qe=v.a.div.withConfig({displayName:"AppSkeleton__Body",componentId:"sc-6bdmdu-1"})(["flex:1;"]),Ve=v.a.div.withConfig({displayName:"AppSkeleton__Footer",componentId:"sc-6bdmdu-2"})(["position:sticky;bottom:0;"]);function Ke({isThirdPartyProvider:e}){return Object(i.jsxs)(ze,{className:"flex-column",children:[Object(i.jsxs)(qe,{className:"p-x-3 p-top-4 flex-column",children:[e&&Object(i.jsx)(Be,{}),Object(i.jsx)(Ae,{}),Object(i.jsx)(je,{}),!e&&Object(i.jsx)(We,{})]}),Object(i.jsxs)(Ve,{children:[Object(i.jsx)("div",{className:"p-bottom-3 p-x-3",children:Object(i.jsx)(xe,{})}),Object(i.jsx)(Ue,{})]})]})}Ke.propTypes={isThirdPartyProvider:h.PropTypes.bool};Ke.defaultProps={isThirdPartyProvider:!1};var Qe=Object(r.memo)(Ke),Ye=n("JEJJ"),Je=n("RP4r"),$e=n("FCtu"),Ze=n("YASu");let Xe,et,tt;!function(e){e.START_CALL_HOST_MSG="START_CALL_HOST_MSG";e.LEARN_MORE_HOST_MSG="LEARN_MORE_HOST_MSG";e.REGISTER_FROM_NUMBER_HOST_MSG="REGISTER_FROM_NUMBER_HOST_MSG";e.ADD_PHONE_NUMBER_HOST_MSG="ADD_PHONE_NUMBER_HOST_MSG";e.SET_THREAD_ID_HOST_MSG="SET_THREAD_ID_HOST_MSG";e.SELECT_TO_NUMBER_HOST_MSG="SELECT_TO_NUMBER_HOST_MSG";e.SET_WIDGET_CAPABILITIES_HOST_MSG="SET_WIDGET_CAPABILITIES_HOST_MSG";e.SHOW_SETTINGS_STATE_HOST_MSG="SHOW_SETTINGS_STATE_HOST_MSG";e.UPDATE_READY_STATE_HOST_MSG="UPDATE_READY_STATE_HOST_MSG";e.SET_IS_QUEUE_TASK_HOST_MSG="SET_IS_QUEUE_TASK_HOST_MSG";e.END_CALL_HOST_MSG="END_CALL_HOST_MSG";e.DISCARD_FOLLOW_UP_TASK_HOST_MSG="DISCARD_FOLLOW_UP_TASK_HOST_MSG";e.CONFIRM_WIDGET_RESET_REQUEST_HOST_MSG="CONFIRM_WIDGET_RESET_REQUEST_HOST_MSG";e.RESET_WIDGET_HOST_MSG="RESET_WIDGET_HOST_MSG";e.SET_DEFAULT_ASSOCIATIONS_THIRD_PARTY_HOST_MSG="SET_DEFAULT_ASSOCIATIONS_THIRD_PARTY_HOST_MSG";e.SET_DEFAULT_ASSOCIATIONS_THIRD_PARTY_EMBED_MSG="SET_DEFAULT_ASSOCIATIONS_THIRD_PARTY_EMBED_MSG";e.INCOMING_CALL_MSG="INCOMING_CALL_MSG"}(Xe||(Xe={}));!function(e){e.CALL_ANSWERED_EMBED_MSG="CALL_ANSWERED_EMBED_MSG";e.CALL_ENDED_EMBED_MSG="CALL_ENDED_EMBED_MSG";e.CALL_SAVED_EMBED_MSG="CALL_SAVED_EMBED_MSG";e.CALL_STARTED_EMBED_MSG="CALL_STARTED_EMBED_MSG";e.INCOMING_CALL_EMBED_MSG="INCOMING_CALL_EMBED_MSG";e.CONFIRM_WIDGET_RESET_RESPONSE_EMBED_MSG=" CONFIRM_WIDGET_RESET_RESPONSE_EMBED_MSG";e.CONFIRM_WIDGET_RESET_REQUEST_HOST_MSG_ACK="CONFIRM_WIDGET_RESET_REQUEST_HOST_MSG_ACK";e.SET_DEFAULT_ASSOCIATIONS_THIRD_PARTY_HOST_MSG_ACK="SET_DEFAULT_ASSOCIATIONS_THIRD_PARTY_HOST_MSG_ACK";e.NOTIFICATION_EMBED_MSG="NOTIFICATION_EMBED_MSG";e.SET_MINIMUM_DIMENSIONS_EMBED_MSG="SET_MINIMUM_DIMENSIONS_EMBED_MSG";e.CREATE_ZORSE_TICKET_EMBED_MSG="CREATE_ZORSE_TICKET_EMBED_MSG";e.SET_ONBOARDING_STATUS_EMBED_MSG="SET_ONBOARDING_STATUS_EMBED_MSG";e.REFRESH_CALLEE_OMNIBUS_EMBED_MSG="REFRESH_CALLEE_OMNIBUS_EMBED_MSG";e.CREATED_FOLLOWUP_TASK_EMBED_MSG="CREATED_FOLLOWUP_TASK_EMBED_MSG";e.RENDER_DISCARD_FOLLOW_UP_TASK_EMBED_MSG="RENDER_DISCARD_FOLLOW_UP_TASK_EMBED_MSG";e.SWITCH_TO_THIRD_PARTY_EMBED_MSG="SWITCH_TO_THIRD_PARTY_EMBED_MSG";e.RELOAD_EMBED_MSG="RELOAD_EMBED_MSG";e.WIDGET_EMBED_HOST_SYNC="WIDGET_EMBED_HOST_SYNC"}(et||(et={}));!function(e){e.UPDATE_CALLEE_NUMBER_MSG="UPDATE_CALLEE_NUMBER_MSG";e.ADD_CALLABLE_ASSOCIATION_MSG="ADD_CALLABLE_ASSOCIATION_MSG";e.REMOVE_CALLABLE_ASSOCIATION_MSG="REMOVE_CALLABLE_ASSOCIATION_MSG";e.SELECTED_CALL_PROVIDER_MSG="SELECTED_CALL_PROVIDER_MSG";e.SELECTED_CALL_PROVIDER_SETTING_MSG="SELECTED_CALL_PROVIDER_SETTING_MSG";e.SELECTED_FROM_NUMBER_MSG="SELECTED_FROM_NUMBER_MSG";e.SELECTED_CALL_METHOD_MSG="SELECTED_CALL_METHOD_MSG"}(tt||(tt={}));Xe.START_CALL_HOST_MSG;const nt=Xe.START_CALL_HOST_MSG,it=Xe.REGISTER_FROM_NUMBER_HOST_MSG,rt=Xe.ADD_PHONE_NUMBER_HOST_MSG,ot=(Xe.SET_THREAD_ID_HOST_MSG,Xe.SET_WIDGET_CAPABILITIES_HOST_MSG,Xe.UPDATE_READY_STATE_HOST_MSG,Xe.SET_IS_QUEUE_TASK_HOST_MSG,Xe.END_CALL_HOST_MSG,Xe.DISCARD_FOLLOW_UP_TASK_HOST_MSG,Xe.CONFIRM_WIDGET_RESET_REQUEST_HOST_MSG,Xe.RESET_WIDGET_HOST_MSG,Xe.SET_DEFAULT_ASSOCIATIONS_THIRD_PARTY_HOST_MSG,tt.UPDATE_CALLEE_NUMBER_MSG,tt.ADD_CALLABLE_ASSOCIATION_MSG,tt.REMOVE_CALLABLE_ASSOCIATION_MSG,et.CONFIRM_WIDGET_RESET_REQUEST_HOST_MSG_ACK,et.SET_DEFAULT_ASSOCIATIONS_THIRD_PARTY_HOST_MSG_ACK,et.NOTIFICATION_EMBED_MSG,et.SET_MINIMUM_DIMENSIONS_EMBED_MSG,et.CREATE_ZORSE_TICKET_EMBED_MSG,et.SET_ONBOARDING_STATUS_EMBED_MSG,et.REFRESH_CALLEE_OMNIBUS_EMBED_MSG,et.CREATED_FOLLOWUP_TASK_EMBED_MSG,et.RENDER_DISCARD_FOLLOW_UP_TASK_EMBED_MSG,et.SWITCH_TO_THIRD_PARTY_EMBED_MSG,et.RELOAD_EMBED_MSG,e=>({id:Object(Ze.a)(),type:Xe.START_CALL_HOST_MSG,data:Object.assign({},e,{startCallTime:(new Date).getTime()})})),at=({isQueueTask:e,destinationConnectionId:t})=>({id:Object(Ze.a)(),type:Xe.END_CALL_HOST_MSG,destinationConnectionId:t,data:{isQueueTask:e}}),st=()=>({id:Object(Ze.a)(),type:Xe.DISCARD_FOLLOW_UP_TASK_HOST_MSG}),ct=()=>({id:Object(Ze.a)(),type:Xe.RESET_WIDGET_HOST_MSG}),lt=()=>({id:Object(Ze.a)(),type:Xe.CONFIRM_WIDGET_RESET_REQUEST_HOST_MSG,responseRequest:{type:et.CONFIRM_WIDGET_RESET_REQUEST_HOST_MSG_ACK}}),ut=e=>({id:Object(Ze.a)(),type:Xe.SELECT_TO_NUMBER_HOST_MSG,data:{toSubject:e}}),dt=e=>({id:Object(Ze.a)(),type:Xe.SET_WIDGET_CAPABILITIES_HOST_MSG,data:{capabilities:e}}),pt=({toSubject:e,isQueueTask:t})=>({id:Object(Ze.a)(),type:Xe.UPDATE_READY_STATE_HOST_MSG,data:{toSubject:e,isQueueTask:t}}),ft=({registerFromNumber:e,learnMore:t,addPhoneNumber:n,toSubject:i})=>({id:Object(Ze.a)(),type:Xe.SHOW_SETTINGS_STATE_HOST_MSG,data:{registerFromNumber:e,learnMore:t,addPhoneNumber:n,toSubject:i}}),ht=e=>({id:Object(Ze.a)(),type:Xe.SET_THREAD_ID_HOST_MSG,data:{threadId:e}}),mt=e=>({id:Object(Ze.a)(),type:Xe.SET_DEFAULT_ASSOCIATIONS_THIRD_PARTY_HOST_MSG,data:e,responseRequest:{type:et.SET_DEFAULT_ASSOCIATIONS_THIRD_PARTY_HOST_MSG_ACK}}),gt=({objectId:e,objectTypeId:t,rawValue:n,property:i})=>({id:Object(Ze.a)(),type:tt.UPDATE_CALLEE_NUMBER_MSG,data:{objectId:e,objectTypeId:t,rawValue:n,property:i}}),vt=({appId:e,height:t,isReady:n,name:i,supportsCustomObjects:r,url:o,width:a})=>({id:Object(Ze.a)(),type:tt.SELECTED_CALL_PROVIDER_MSG,data:{appId:e,height:t,isReady:n,name:i,supportsCustomObjects:r,url:o,width:a}}),_t=({callingProvider:e,fromNumber:t})=>({id:Object(Ze.a)(),type:tt.SELECTED_CALL_PROVIDER_SETTING_MSG,data:{callingProvider:e,fromNumber:t||null}}),bt=e=>({id:Object(Ze.a)(),type:tt.SELECTED_CALL_METHOD_MSG,data:{callMethod:e}}),yt=e=>({id:Object(Ze.a)(),type:Xe.SET_IS_QUEUE_TASK_HOST_MSG,data:{isQueueTask:e}}),St=e=>({id:Object(Ze.a)(),type:tt.REMOVE_CALLABLE_ASSOCIATION_MSG,data:e}),Et=e=>({id:Object(Ze.a)(),type:tt.ADD_CALLABLE_ASSOCIATION_MSG,data:e}),Tt=e=>({id:Object(Ze.a)(),data:e,type:Xe.START_CALL_HOST_MSG});var wt=n("dzoN"),Ct=n("WRZ8");const It="DIAL_NUMBER",Ot="VISIBILITY_CHANGED",jt="ENGAGEMENT_CREATED",Dt="CREATE_ENGAGEMENT_SUCCEEDED",At="CREATE_ENGAGEMENT_FAILED",Pt="SYNC_ACK_FAILED",Rt="READY",kt="INITIALIZED",xt="LOGGED_IN",Lt="LOGGED_OUT",Mt="INCOMING_CALL",Nt=({payload:e,selectedProviderName:t})=>({id:Object(Ze.a)(),type:kt,data:Object.assign({},e,{provider:t})}),Gt=e=>({id:Object(Ze.a)(),type:xt,data:{provider:e}}),Ft=e=>({id:Object(Ze.a)(),type:Lt,data:{provider:e}}),Wt=e=>({id:Object(Ze.a)(),type:Pt,data:{provider:e}}),Ut=e=>({id:Object(Ze.a)(),type:Rt,data:{provider:e}}),Ht=({payload:e,selectedProviderName:t})=>({id:Object(Ze.a)(),type:Mt,data:Object.assign({provider:t},e)});var Bt=n("1z6Q");const zt="CALL_WIDGET_TIMEOUT",qt="CALL_WIDGET_READY",Vt="START_CALL";var Kt=n("g+dq"),Qt=n.n(Kt),Yt=n("eUxV"),Jt=n("mEYk"),$t=n.n(Jt);const Zt={extra:{},tags:{},fingerprint:[],level:"error"},Xt=(e,t={})=>{const n=Object.assign({},Zt,{},t),i=window.newrelic;i&&i.noticeError&&i.noticeError(e,n.tags);$t.a.captureException(e,n);const{actualError:r,callProvider:o}=e;console.debug(`Error reported with '${e.message}'`,Object.assign({actualError:r,callProvider:o},n.extra))};class en extends Error{constructor({message:e,callProvider:t,actualError:n}){super("[Calling Extensions]: "+e);this.name="CallingExtensionsError";this.callProvider="unknown";this.actualError={};"captureStackTrace"in Error&&Error.captureStackTrace(this,this.constructor);this.callProvider=t||"unknown";this.actualError=n||{}}}const tn={hs_timestamp:"hs_timestamp",hs_call_title:"hs_call_title",hubspot_owner_id:"hubspot_owner_id",hs_call_body:"hs_call_body",hs_call_duration:"hs_call_duration",hs_call_from_number:"hs_call_from_number",hs_call_to_number:"hs_call_to_number",hs_call_recording_url:"hs_call_recording_url",hs_call_status:"hs_call_status"},nn="engagements/v1/engagements",rn="engagements/v2/engagements",on=e=>e in tn,an=e=>Object.entries(e).reduce((e,t)=>{const[n,i]=t;return on(n)?[...e,{name:n,value:i}]:e},[]),sn=({engagementId:e,selectedProviderName:t,properties:n})=>{const i=an(n);if(!i||!i.length)throw new Error("Invalid engagement properties");return Qt.a.put(`${rn}/${e}`,{data:{properties:i},headers:{"X-Source":"CRM_UI","X-Properties-Source":"CRM_UI"}}).catch(e=>{throw new en({message:"Failed to save engagement for third party provider",callProvider:t,actualError:e})})};function cn({engagementId:e,callEndStatus:t,selectedProviderName:n}){return sn({engagementId:e,selectedProviderName:n,properties:{[tn.hs_call_status]:t}}).catch(e=>{Xt(e,{extra:{callProvider:n,callEndStatus:t}})})}function ln(e){return Boolean(e.direction)&&e.direction===x.a.INBOUND}const un=e=>{const{ownerId:t,selectedProviderName:n,toNumber:i,associations:r,direction:o}=e,a={status:"IN_PROGRESS",toNumber:i,direction:o};ln(e)&&(a.fromNumber=e.fromNumber);return Qt.a.post(nn,{data:{engagement:{source:"INTEGRATION",type:"CALL",ownerId:t},metadata:a,associations:r}}).catch(e=>{throw new en({message:"Failed to create an engagement for third party provider",callProvider:n,actualError:e})})};function dn(e){const{objectTypeId:t,ownerId:n,selectedProviderName:i,toNumber:r,fromNumber:o}=e;if(!t||!n||!r)return Promise.reject(new Error("Argument exception"));return un({ownerId:n,selectedProviderName:i,toNumber:r,fromNumber:o,associations:{},direction:x.a.INBOUND}).catch(e=>{Xt(e,{extra:{callProvider:i,level:"info"}})})}function pn(e){const{objectTypeId:t,subjectId:n,ownerId:i,toNumber:r,selectedProviderName:o}=e;if(!(t&&n&&i&&r))return Promise.reject(new Error("Argument exception"));const a={},s=Yt.ObjectTypeFromIds[t];s&&(a[s.toLowerCase()+"Ids"]=[n]);return un({ownerId:i,toNumber:r,selectedProviderName:o,associations:a,direction:x.a.OUTBOUND}).catch(e=>{Xt(e,{extra:{callProvider:o,level:"info"}})})}function fn(e){const{objectTypeId:t,subjectId:n,ownerId:i,toNumber:r,selectedProviderName:o,isUngatedForExtensionsCallDirection:a}=e;if(!(t&&n&&i&&r))return Promise.reject(new Error("Argument exception"));const s={},c=Yt.ObjectTypeFromIds[t];c&&(s[c.toLowerCase()+"Ids"]=[n]);return(()=>{const e={status:"IN_PROGRESS",toNumber:r};a&&(e.direction=x.a.OUTBOUND);return Qt.a.post(nn,{data:{engagement:{source:"INTEGRATION",type:"CALL",ownerId:i},metadata:e,associations:s}}).catch(e=>{throw new en({message:"Failed to create an engagement for third party provider",callProvider:o,actualError:e})})})().catch(e=>{Xt(e,{extra:{callProvider:o,level:"info"}})})}var hn=n("Fo70");const mn=({action:e,provider_name:t,application_id:n,extraData:i={},source:r="communicator"})=>{Bt.a.log("callingExtensions_interaction",Object.assign({action:e,provider_name:t,application_id:n||0,source:r},i))};let gn;!function(e){e.INITIALIZED="INITIALIZED";e.LOGGED_IN="LOGGED_IN";e.LOGGED_OUT="LOGGED_OUT";e.SYNC="SYNC";e.SYNC_ACK="SYNC_ACK";e.SYNC_ACK_FAILED="SYNC_ACK_FAILED";e.READY="READY";e.DIAL_NUMBER="DIAL_NUMBER";e.VISIBILITY_CHANGED="VISIBILITY_CHANGED";e.ENGAGEMENT_CREATED="ENGAGEMENT_CREATED";e.INCOMING_CALL="INCOMING_CALL";e.OUTGOING_CALL_STARTED="OUTGOING_CALL_STARTED";e.CALL_ANSWERED="CALL_ANSWERED";e.CALL_ENDED="CALL_ENDED";e.CALL_COMPLETED="CALL_COMPLETED";e.RESIZE_WIDGET="RESIZE_WIDGET";e.CALL_DATA="CALL_DATA";e.ERROR="ERROR"}(gn||(gn={}));const vn=3e4,_n=100;function bn({postMessageToIframe:e,onPingTimeout:t,providerName:n}){const i=Object(r.useRef)(void 0),o=Object(r.useRef)(void 0),a=Object(r.useRef)(void 0),s=Object(r.useCallback)(()=>{clearInterval(i.current)},[]),c=Object(r.useCallback)(()=>{const n=Date.now();if(o.current&&n-o.current>vn){t();clearInterval(i.current)}else{e({type:gn.SYNC,hostUrl:window.location.origin},s);o.current||(o.current=n)}},[t,e,s]);Object(r.useEffect)(()=>{if(n!==a.current){clearInterval(i.current);o.current=void 0;i.current=setInterval(c,_n);a.current=n}},[n,c]);Object(r.useEffect)(()=>()=>{clearInterval(i.current)},[])}var yn=bn;function Sn({dataSeleniumTest:e,renderIframe:t,postMessageToIframe:n,providerName:i,onTimeout:r,style:o={},onLoad:a=f.a}){yn({onPingTimeout:r,postMessageToIframe:n,providerName:i});return t({"data-selenium-test":e,allow:"microphone; autoplay",style:o,onLoad:a})}Sn.propTypes={dataSeleniumTest:m.a.string,postMessageToIframe:m.a.func,onTimeout:m.a.func,renderIframe:m.a.func,style:m.a.object,onLoad:m.a.func,providerName:m.a.string};var En=Sn;const Tn="CALLING_POST_MESSAGE_DEBUG",wn=v.a.iframe.withConfig({displayName:"useIframe__StyledIframe",componentId:"sc-111frsl-0"})(["width:100%;height:100%;"]),Cn=1e4;function In({src:e,onMessage:t,debugMode:n,isAirCall:o=!1}){const a=Object(r.useRef)({}),s=Object(r.useRef)(Date.now()),c=Object(r.useRef)(null),l=Object(r.useRef)([]),u=Object(r.useRef)(!1),d=Object(r.useMemo)(()=>{const t=document.createElement("a");t.setAttribute("href",e);return t.origin},[e]);n&&!window[Tn]&&(window[Tn]=[]);const p=Object(r.useCallback)(()=>`${s.current}_${Date.now()}`,[]),f=Object(r.useCallback)((e,t)=>{const i=p();e.messageId=i;c.current&&c.current.contentWindow&&d&&c.current.contentWindow.postMessage(e,d);if(t){a.current[i]=t;setTimeout(()=>{delete a.current[i]},Cn)}n&&window[Tn].push(e)},[d,p,n]),h=Object(r.useCallback)((e,t)=>{e.type===gn.SYNC||u.current?f(e,t):l.current.push([e,t])},[u,f]),m=Object(r.useCallback)(()=>{l.current.forEach(([e,t])=>{f(e,t)});l.current=[];u.current=!0},[f]),g=Object(r.useCallback)(e=>{const{source:i,data:r}=e;if(!c.current||i!==c.current.contentWindow)return;const{messageId:o,type:s}=r;"function"==typeof a.current[o]&&a.current[o](r);t(e);s===gn.SYNC_ACK&&m();n&&window[Tn].push(r)},[t,n,m]);Object(r.useEffect)(()=>{o||window.addEventListener("message",g);return()=>{window.removeEventListener("message",g)}},[g,o]);const v=Object(r.useCallback)((t={})=>Object(i.jsx)(wn,Object.assign({ref:c,src:e},t)),[e]);return Object(r.useMemo)(()=>({renderIframe:v,postMessageToIframe:h}),[v,h])}var On=In;function jn({hide:e,selectedCallProvider:t,onReady:n,onInitialized:o,onCallStarted:a,onCallSaved:s,onTimeout:c,onCallEnded:l,onError:u,onData:d,onLoggedIn:p,onLoggedOut:f,onIframeLoad:h,isAirCall:m,onResize:g,onCallAnswered:v,onIncomingCall:_,onSyncTimedOut:b}){const y=t.get("url")||"",S=t.get("name"),E=t.get("appId"),T=Object(r.useMemo)(()=>Object(hn.a)(n),[n]),w=Object(r.useRef)(null),C=Object(r.useCallback)(e=>mn({action:e,provider_name:S.toString(),application_id:E}),[E,S]),I=Object(r.useCallback)(e=>{const{data:t}=e,{type:i,data:r}=t;switch(i){case gn.OUTGOING_CALL_STARTED:a(r);break;case gn.CALL_ANSWERED:v();C("call answered");break;case gn.CALL_ENDED:l(r);break;case gn.CALL_COMPLETED:s(r);C("call has been completed");break;case gn.ERROR:u(r);C("there is an error");break;case gn.SYNC_ACK:T();C("widget has loaded");break;case gn.INITIALIZED:o(r);C("call widget initialized");break;case gn.RESIZE_WIDGET:{const{width:e,height:t}=r;g({width:e,height:t});C("widget has been resized");break}case gn.LOGGED_IN:p();C("logged in");break;case gn.LOGGED_OUT:f();C("logged out");break;case gn.CALL_DATA:if("function"==typeof d){d(r);C("on data")}break;case gn.INCOMING_CALL:_(r);C("incoming call");break;case gn.READY:n();C("call widget ready");break;case gn.SYNC_ACK_FAILED:b();C("did not load")}},[T,C,o,a,v,l,s,u,g,p,f,d,_,n,b]),{renderIframe:O,postMessageToIframe:j}=On({src:y,onMessage:I,isAirCall:m});w.current=j;const D=Object(r.useCallback)(()=>Object(i.jsx)(En,{dataSeleniumTest:"third-party-widget-iframe",renderIframe:O,postMessageToIframe:j,onTimeout:c,style:{display:e?"none":void 0},onLoad:h,providerName:S}),[O,j,c,e,h,S]);return Object(r.useMemo)(()=>({renderIframe:D,postMessageToIframe:j}),[D,j])}class Dn{constructor(e={debug:!0}){this.phoneWindow=null;this.integrationSettings={};this.userSettings={};this.eventsRegistered={};this.phoneLoginState=!1;const t=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi;this.phoneUrl=void 0!==e.phoneUrl&&!0===t.test(e.phoneUrl)?e.phoneUrl:"https://phone.aircall.io";this.domToLoadPhone=e.domToLoadPhone;this.integrationToLoad=e.integrationToLoad;this.debug=e.debug;this.size=e.size||"big";this.onLogin=()=>{if("function"==typeof e.onLogin&&!1===this.phoneLoginState){this.phoneLoginState=!0;const t={user:this.userSettings};Object.keys(this.integrationSettings).length>0&&(t.settings=this.integrationSettings);e.onLogin(t)}};this.onLogout=()=>{"function"==typeof e.onLogout&&e.onLogout()};this.w=e.window||window;this._messageListener();this.domToLoadPhone&&this._createPhoneIframe()}_resetData(){this.phoneWindow=null;this.integrationSettings={};this.userSettings={};this.phoneLoginState=!1}_createPhoneIframe(){let e="";switch(this.size){case"big":e="height:666px; width:376px;";break;case"small":e="height:600px; width:376px;";break;case"auto":e="height:100%; width:100%;"}try{document.querySelector(this.domToLoadPhone).innerHTML=`<iframe allow="microphone; autoplay; clipboard-read; clipboard-write" src="${this.getUrlToLoad()}" style="${e}"></iframe>`}catch(e){this._log("error",`[AircallEverywhere] [iframe creation] ${this.domToLoadPhone} not be found. Error:`,e)}}_messageListener(){this.w.addEventListener("message",e=>{this._log("info","[AircallEverywhere] [event listener] received event",e);const t=/^apm_phone_/;if(!e.data||!e.data.name||!t.test(e.data.name))return!1;if("apm_phone_loaded"!==e.data.name)if("apm_phone_integration_settings"===e.data.name&&e.data.value){this.integrationSettings=e.data.value;this.onLogin()}else if("apm_phone_logout"!==e.data.name)for(const t in this.eventsRegistered)e.data.name==="apm_phone_"+t&&this.eventsRegistered[t](e.data.value);else{this._resetData();this.onLogout()}else this._handleInitMessage(e)},!1)}_handleInitMessage(e){this.phoneWindow={source:e.source,origin:e.origin};e.data.value&&(this.userSettings=e.data.value);this.phoneWindow.source.postMessage({name:"apm_app_isready"},this.phoneWindow.origin);this.integrationToLoad?this.phoneWindow.source.postMessage({name:"apm_app_get_settings",value:this.integrationToLoad},this.phoneWindow.origin):this.onLogin()}_log(e,...t){if("string"!=typeof e)throw new Error("[AircallEverywhere] [_log] Must provide valid console action");this.debug&&(console[e]?console[e](...t):console.info(...t))}getUrlToLoad(){return this.phoneUrl+"?integration=generic"}on(e,t){if(!e||"function"!=typeof t)throw new Error("[AircallEverywhere] [on function] Invalid parameters format. Expected non empty string and function");this.eventsRegistered[e]=t}_handleSendError(e,t){e&&e.code||(e={code:"unknown_error"});if(e&&!e.message)switch(e.code){case"unknown_error":e.message="Unknown error. Contact aircall developers dev@aircall.io";break;case"no_event_name":e.message="Invalid parameter eventName. Expected an non empty string";break;case"not_ready":e.message='Aircall Phone has not been identified yet or is not ready. Wait for "onLogin" callback';break;case"no_answer":e.message="No answer from the phone. Check if the phone is logged in";break;case"invalid_response":e.message="Invalid response from the phone. Contact aircall developers dev@aircall.io";break;default:e.message="Generic error message"}this._log("error","[AircallEverywhere] [send function] "+e.message);"function"==typeof t&&t(!1,e)}send(e,t,n){if("function"==typeof t&&!n){n=t;t=void 0}if(!e){this._handleSendError({code:"no_event_name"},n);return!1}if(!this.phoneWindow||!this.phoneWindow.source){this._handleSendError({code:"not_ready"},n);return!1}{let i=null,r=2e3;this.phoneWindow.source.postMessage({name:"apm_app_"+e,value:t},this.phoneWindow.origin);this.on(e+"_response",t=>{this.removeListener(e+"_response");clearTimeout(i);t&&!1===t.success?this._handleSendError({code:t.errorCode,message:t.errorMessage},n):t&&!0===t.success?"function"==typeof n&&n(!0,t.data):this._handleSendError({code:"invalid_response"},n)});i=setTimeout(()=>{this.removeListener(e+"_response");this._handleSendError({code:"no_answer"},n)},r)}}removeListener(e){if(!this.eventsRegistered[e])return!1;Object.keys(this.eventsRegistered).filter(t=>t===e).forEach(e=>delete this.eventsRegistered[e]);return!0}isLoggedIn(e){this.send("is_logged_in",t=>{e(t)})}}var An=Dn;const Pn="aircall-container",Rn="no_answer",kn="not_ready";function xn({hide:e,onReady:t,onInitialized:n,isAirCall:o}){const a=Object(r.useRef)(null),s=Object(r.useRef)(null),c=Object(r.useRef)([]),l=Object(r.useCallback)(e=>{a.current&&a.current.isLoggedIn(t=>{t?a.current.send("dial_number",e,(t,n)=>{if(!t&&n&&n.code){const{code:t}=n;[kn,Rn].includes(t)&&(s.current=e)}}):s.current=e})},[]);Object(r.useEffect)(()=>{if(!o&&a.current){c.current.forEach(({type:e,callback:t})=>{window.removeEventListener(e,t)});c.current=[];a.current=null}},[o]);const u=Object(r.useCallback)(()=>{s.current&&l(s.current)},[l]),d=Object(r.useCallback)(e=>{if(!e)return;a.current=new An({domToLoadPhone:"#"+Pn,integrationToLoad:"hubspot",window:{addEventListener:(e,t)=>{c.current.push({type:e,callback:t});window.addEventListener(e,t)}},onLogin:u});const i=e.getElementsByTagName("iframe")[0];i&&(i.onload=()=>{a.current.isLoggedIn(()=>{n({isLoggedIn:!0});t()})})},[u,n,t]),p=Object(r.useCallback)(()=>Object(i.jsx)("div",{style:{display:e?"none":void 0},ref:d,id:Pn}),[e,d]),f=Object(r.useCallback)(({phoneNumber:e})=>{l({phone_number:e})},[l]);return Object(r.useMemo)(()=>({renderAirCallWidget:p,dialAircall:f}),[p,f])}var Ln=n("xc7I"),Mn=n("h6RT"),Nn=n("I5zW");const Gn=Object(Nn.createMetricsFactory)("calling-integration-sdk-support",{library:"calling-integration-sdk-support"});var Fn=n("a1QO");function Wn(e){return"string"==typeof e||"number"==typeof e}function Un({subject:e,hide:t,selectedCallProvider:n,onReady:i,onInitialized:o,onResize:a,onTimeout:s,onCallStarted:c,onCallEnded:l,onCallSaved:u,selectedPhoneNumber:d,ownerId:p,onError:f,onLoggedIn:h,onLoggedOut:m,onCallAnswered:g,onIncomingCall:v,onSyncTimedOut:_,onIframeLoad:b,isUngatedForExtensionsCallDirection:y,isUngatedForExtensionsInboundCalling:S}){const E=n.get("name"),T=n.get("appId"),w=Object(Ln.b)(E),C=Object(r.useRef)(null),I=Object(r.useRef)(null),O=Object(r.useRef)(0),j=Object(r.useRef)(null),D=e?e.get("objectTypeId"):"",A=e?e.get("objectId"):"",P=Object(r.useRef)(x.a.OUTBOUND),R=Object(r.useCallback)((e,t,n)=>{(()=>e===x.a.INBOUND?dn({objectTypeId:D,ownerId:p,toNumber:t,fromNumber:n||"",selectedProviderName:E}):pn({objectTypeId:D,subjectId:A,ownerId:p,toNumber:t,selectedProviderName:E}))().then(t=>{const n=Object(Fn.a)(["engagement","id"],t);if(!n)throw new Error("Unable to retrieve engagement ID");if(!Wn(n))throw new Error("engagementId is "+typeof n);I.current=t;if(C.current){e===x.a.OUTBOUND&&C.current({type:jt,data:{engagementId:n}});C.current({type:Dt,data:{engagementId:n,callDirection:e}})}Gn.counter("CREATE_THIRD_PARTY_ENGAGEMENT_SUCCEEDED",{provider:E,callDirection:e}).increment()}).catch(t=>{Object(Ye.d)({error:t,extraData:{selectedProviderName:E,callDirection:e}});Gn.counter("CREATE_THIRD_PARTY_ENGAGEMENT_FAILED",{provider:E,callDirection:e}).increment();C.current&&C.current({type:At,data:{error:t}})})},[D,p,E,A]),k=Object(r.useCallback)(e=>{P.current=x.a.INBOUND;v(e);if(e&&e.createEngagement){const t=e.toNumber||d;I.current=null;R(x.a.INBOUND,t,e.fromNumber)}mn({action:"incoming call started",provider_name:E,application_id:T,extraData:{callToCountry:j.current}})},[T,R,v,d,E]),L=Object(r.useCallback)(e=>{P.current=x.a.OUTBOUND;c({callStartTime:e&&e.callStartTime||0});O.current=Date.now();if(e&&e.createEngagement){const t=e.phoneNumber||d;I.current=null;R(x.a.OUTBOUND,t)}mn({action:"call started",provider_name:E,application_id:T,extraData:{callToCountry:j.current}})},[T,R,c,d,E]),M=Object(r.useCallback)(e=>{P.current=x.a.OUTBOUND;c({callStartTime:e&&e.callStartTime||0});O.current=Date.now();if(e&&e.createEngagement){const t=e.phoneNumber||d;I.current=null;fn({objectTypeId:D,subjectId:A,ownerId:p,toNumber:t,selectedProviderName:E,isUngatedForExtensionsCallDirection:y}).then(e=>{const t=Object(Fn.a)(["engagement","id"],e);if(!t)throw new Error("Unable to retrieve engagement ID");if(!Wn(t))throw new Error("engagementId is "+typeof t);I.current=e;C.current&&C.current({type:jt,data:{engagementId:t}});Gn.counter("CREATE_THIRD_PARTY_ENGAGEMENT_SUCCEEDED",{provider:E}).increment()}).catch(e=>{Object(Ye.d)({error:e,extraData:{selectedProviderName:E}});Gn.counter("CREATE_THIRD_PARTY_ENGAGEMENT_FAILED",{provider:E}).increment()})}mn({action:"call started",provider_name:E,application_id:T,extraData:{callToCountry:j.current}})},[T,y,D,c,p,d,E,A]),N=Object(r.useCallback)(e=>{const{callEndStatus:t}=e||{};mn({action:"call ended",provider_name:E,application_id:T,extraData:{callDuration:Date.now()-O.current,callToCountry:j.current}});if(I.current&&t){const e=Object(Fn.a)(["engagement","id"],I.current);if(!e)return;cn({engagementId:e,callEndStatus:t,selectedProviderName:E})}l(e)},[T,l,E]),G=e=>{u(e);if(!e||!e.engagementId||!I.current)return;const t=e.engagementId,n=Object(Fn.a)(["engagement","id"],I.current);String(n)===String(t)||Object(Ye.d)({error:new Error("createEngagement and updateEngagement IDs do not match"),extraData:{selectedProviderName:E,createEngagementId:n,updateEngagementId:t}})},{renderIframe:F,postMessageToIframe:W}=jn({selectedCallProvider:n,onReady:i,onInitialized:o,onResize:a,onCallStarted:S?L:M,onCallEnded:N,onCallSaved:G,onTimeout:s,hide:t,onError:f,onLoggedIn:h,onLoggedOut:m,onIframeLoad:b,isAirCall:w,onCallAnswered:g,onIncomingCall:S?k:v,onSyncTimedOut:_});C.current=W;const{renderAirCallWidget:U,dialAircall:H}=xn({hide:t,onReady:i,onInitialized:o,isAirCall:w}),B=Object(r.useCallback)(()=>w?U():F(),[w,U,F]),z=Object(r.useCallback)(e=>{j.current=e.countryCode;if(w){const{phoneNumber:t}=e;H({phoneNumber:t});Object(Ye.c)({key:Vt,tags:{provider:Mn.a}});Gn.counter(Vt,{provider:Mn.a}).increment();Bt.a.log("callUsage_startCall",{action:"start call",callMedium:"na",provider:Mn.a})}else W({type:It,data:e})},[w,H,W]),q=Object(r.useCallback)(e=>{W({type:Ot,data:e})},[W]);return Object(r.useMemo)(()=>({renderThirdParty:B,dialThirdParty:z,onVisibilityChange:q}),[B,z,q])}const Hn=v.a.div.withConfig({displayName:"ThirdPartySubheader__Subheader",componentId:"t4fv6d-0"})(["background-color:",";"],Ce.CALYPSO_LIGHT);function Bn({onClick:e,disabled:t}){return Object(i.jsx)(Hn,{className:"p-y-1 p-x-2",children:Object(i.jsx)(fe.a,{"data-test-id":"third-party-subheader-back",onClick:e,disabled:t,children:Object(i.jsx)(Y.a,{message:"thirdPartyProviderViewport.backLink"})})})}Bn.propTypes={onClick:m.a.func.isRequired,disabled:m.a.bool.isRequired};var zn=Bn;function qn(){if("hsFeedback"in window)return window.hsFeedback;Xt(new en({message:"HS Feedback not found."}));return{loadSurvey:f.a}}function Vn(e){qn().loadSurvey("CSAT",e)}var Kn=n("LZPL"),Qn=n.n(Kn);const Yn=907,Jn=297,$n=()=>Qn.a.isProd()?Yn:Jn,Zn=e=>{Ct.a.addAlert({message:e.message,type:"danger"})},Xn=v.a.div.withConfig({displayName:"ThirdPartyProviderViewport__StyledThirdPartyWrapper",componentId:"sc-1jkji6e-0"})(["display:",";flex:1;flex-direction:column;height:100%;"],({active:e})=>e?"flex":"none");function ei({callStatus:e,isQueueTask:t=!1,isThirdPartyActive:n,isWidgetHidden:o,isWidgetMinimized:a,onAddThirdPartyEvents:s,onCallEnded:c,onCallSaved:l,onCallStarted:u,onClearThirdPartyEvents:d,onSetCallStatus:p,onSetIsWidgetHidden:f,onThirdPartyActive:h,onThirdPartyWidgetResize:m,ownerId:g,postMessageToHubSpotIframe:v,selectedCallProvider:_,subject:b,isUngatedForExtensionsCallDirection:y,isUngatedForExtensionsInboundCalling:S}){const[E,T]=Object(r.useState)(!1),[w,C]=Object(r.useState)(!1),[I,O]=Object(r.useState)(!1),[j,D]=Object(r.useState)(!1),A=Object(r.useRef)(null),P=Object(r.useRef)(""),k=Object(r.useRef)(!0),x=Object(r.useRef)(!1),L=Object(r.useRef)(null),M=Object(r.useRef)(null),N=Object(r.useRef)(0),G=_.get("name"),F=_.get("appId"),W=Object(r.useRef)(a),U=Object(r.useRef)(o),H=Object(wt.a)(n),B=Object(r.useCallback)(e=>{u(e||{});Bt.a.log("callUsage_startCall",{action:"start call",callMedium:"na",provider:G});Object(Ye.c)({key:Vt,tags:{provider:G}});Gn.counter(Vt,{provider:G}).increment()},[u,G]),z=Object(r.useCallback)(()=>{p(R.ANSWERED)},[p]),q=Object(r.useCallback)(e=>{G.toLowerCase()===Mn.d.toLowerCase()&&Vn($n());const n=e&&!1!==e.hideWidget;(t||n)&&f(!0);p(R.READY);l(e,!0)},[t,l,p,f,G]),V=Object(r.useCallback)(e=>{h(!0);P.current=e.phoneNumber;A.current&&A.current(e)},[h]),K=Object(r.useCallback)(e=>{I||e.forced?V(e):M.current=e},[V,I]);Object(r.useEffect)(()=>{s({[ae]:K})},[K,s]);L.current=d;Object(r.useEffect)(()=>()=>{L.current&&L.current()},[]);const Q=Object(r.useCallback)(()=>{x.current=!0},[]),Y=Object(r.useCallback)(e=>{C(!0);const t=Nt({payload:e,selectedProviderName:G});v(t);e.sizeInfo&&m(e.sizeInfo);if(M.current){V(M.current);M.current=null}},[m,v,G,V]),J=Object(r.useCallback)(()=>{const e=Gt(G);v(e)},[v,G]),$=Object(r.useCallback)(()=>{f(!1);h(!0)},[f,h]),Z=Object(r.useCallback)(e=>{f(!1);h(!0);p(R.RINGING);const t=Ht({payload:e,selectedProviderName:G});v(t)},[p,f,h,v,G]),X=Object(r.useCallback)(()=>{const e=Ft(G);v(e)},[v,G]),ee=Object(r.useCallback)(()=>{const e=Wt(G);v(e)},[v,G]),te=Object(r.useCallback)(()=>{const e=Ut(G);v(e);O(!0);p(R.READY);Object(Ye.c)({key:qt,tags:{provider:G}});Gn.counter(qt,{provider:G}).increment();Bt.a.log("callingExtensions_initialLoadTime",{action:"third party load duration",source:"communicator",duration:Date.now()-N.current,provider_name:G,application_id:F||0,version:"2"})},[v,G,p,F]),ne=Object(r.useCallback)(()=>{if(E){C(!1);O(!1);T(!1);D(!0);x.current=!1;M.current=null}h(!1)},[h,E]),ie=Object(r.useCallback)(()=>{T(!0);Object(Ye.c)({key:zt,tags:{provider:G,isIframeSrcLoaded:x.current}});Gn.counter(zt,{provider:G,isIframeSrcLoaded:x.current.toString()}).increment();x.current&&te()},[te,G]),{renderThirdParty:re,dialThirdParty:oe,onVisibilityChange:se}=Un({subject:b,selectedCallProvider:_,onReady:te,onInitialized:Y,onResize:m,onTimeout:ie,onCallStarted:B,onCallEnded:c,onCallSaved:q,hide:!n,ownerId:g,selectedPhoneNumber:P.current,onError:Zn,onLoggedIn:J,onLoggedOut:X,onCallAnswered:z,onIncomingCall:S?Z:$,onSyncTimedOut:ee,onIframeLoad:Q,isUngatedForExtensionsCallDirection:y,isUngatedForExtensionsInboundCalling:S});Object(r.useEffect)(()=>{const e=n&&(W.current!==a||U.current!==o),t=H&&!n;if(!k.current&&(t||e)){W.current=a;U.current=t||o;se({isMinimized:W.current,isHidden:U.current})}},[o,a,se,n,H]);Object(r.useEffect)(()=>{k.current=!1},[]);Object(r.useEffect)(()=>{j&&D(!1)},[j]);A.current=oe;const ce=Object(r.useMemo)(()=>{N.current=Date.now();return!j&&re()},[re,j]);return Object(i.jsxs)(Xn,{active:!a&&n,children:[n&&Object(i.jsx)(zn,{onClick:ne,disabled:[R.ENDING,R.RINGING,R.ANSWERED].includes(e),providerName:G,isInitialized:w}),ce]})}var ti=Object(r.memo)(ei),ni=n("LsyS");const ii="CALL_WIDGET_TIMEOUT",ri="CALL_WIDGET_READY",oi="UNHANDLED_EMBED_EVENT_TYPE",ai="VIEWED_VERSION_WARNING";var si=n("nDpY"),ci=n.n(si);const li=e=>{Ct.a.addAlert(e)},ui=N()(()=>ci.a.get());var di=n("7y3D"),pi=n("D2Y9");const fi=({subjectId:e,objectTypeId:t,ownerId:n,portalId:i,selectedCallProvider:r,isQueueTask:o,appIdentifier:a})=>{if(!n)return null;const s=Object(di.b)(window.location.search),c=Object(pi.parse)(window.location.search.substring(1)),l={objectTypeId:t,subjectId:e,ownerId:n,isQueueTask:o,appIdentifier:a};c&&"true"===c["is-selenium-test"]&&(l["is-selenium-test"]=!0);Object.keys(s).forEach(e=>{const t=s[e];l[t?"ungated":"gated"]=e});const u=Object.keys(l).filter(e=>!!l[e]),d=`/calling/${i}/twilio?${u.reduce((e,t,n)=>{const i=n<u.length-1?"&":"";return e+=`${t}=${l[t]}${i}`},"")}`;return r.set("url",d)},hi=w()(fi,({subjectId:e,objectTypeId:t})=>`${e}__${Yt.ObjectTypeFromIds[t]}__${t}`),mi="CallWidgetDimensions",gi=({selectedCallProvider:e,callStatus:t})=>{const n=Object(F.b)(e),i=Object(b.b)(n);let r=i.height,o=i.width;r+=Object(b.e)(t);const a=o,s=r,c=e.height,l=e.width;n&&({height:r,width:o}=Object(S.a)(mi,{height:r,width:o}));return{height:r,width:o,minWidth:a,minHeight:s,thirdPartyWidth:l,thirdPartyHeight:c}};var vi=n("L+kM");function _i({selectedCallee:e,phoneNumber:t,countryCode:n,selectedToNumberPropertyName:i,ownerId:r,portalId:o,subjectId:a,objectTypeId:s}){if(!e||!t)return null;return{phoneNumber:t,phone_number:t,countryCode:n,calleeInfo:{calleeId:Object(vi.o)(e),calleeObjectTypeId:Object(vi.r)(e)},ownerId:r,subjectId:a,objectId:a,objectType:Yt.ObjectTypeFromIds[s],startTimestamp:Date.now(),portalId:o,toPhoneNumberSrc:i}}var bi=n("oBxR");const yi={},Si=({objectId:e,objectTypeId:t})=>`${e}${t}`;function Ei({objectId:e,objectTypeId:t,numberPropertyName:n}){const i=Si({objectId:e,objectTypeId:t});return yi[i]?Promise.resolve(yi[i]):Object(bi.b)({objectId:e,objectTypeId:t}).then(e=>{if("OK"!==e["@result"])return null;const t=e.phoneNumberProperties.find(e=>e.propertyName===n);if(t&&t.validatedPhoneNumber){const e=new Je.e(t.validatedPhoneNumber);yi[i]=e}return yi[i]||null})}function Ti({toSubject:e,callStatus:t,ownerId:n,subject:i}){let r=Ei;if(e.phoneNumberProperties){const t=Object(vi.u)({callableObject:e,propertyName:e.numberPropertyName}),n=t&&Object(vi.n)(t);r=()=>Promise.resolve(n)}return r(e).then(r=>Object(b.a)(t)&&r&&r.toNumberString?_i({selectedCallee:e,phoneNumber:r.toNumberString,countryCode:r.regionCode,selectedToNumberPropertyName:e.numberPropertyName,subjectId:Ee()("objectId",i),objectTypeId:Ee()("objectTypeId",i),ownerId:n,portalId:ui()}):null)}var wi=n("qDTw");const Ci=e=>Boolean(H[e]);function Ii({event:e,callback:t}){if(!Ci(e))return;if(!window[wi.a].updateQueueByEventType||!window[wi.a].updateQueueByEventType[e])return;const n=window[wi.a].updateQueueByEventType[e].indexOf(t);n>=0&&window[wi.a].updateQueueByEventType[e].splice(n,1)}function Oi({event:e,data:t}){Ci(e)&&window[wi.a].updateQueueByEventType&&window[wi.a].updateQueueByEventType[e]&&window[wi.a].updateQueueByEventType[e].forEach(e=>e(t))}function ji({event:e,callback:t}){if(Ci(e)){window[wi.a].updateQueueByEventType||(window[wi.a].updateQueueByEventType={});window[wi.a].updateQueueByEventType[e]||(window[wi.a].updateQueueByEventType[e]=[]);window[wi.a].updateQueueByEventType[e].push(t)}}var Di=n("23d6");function Ai(){return window[wi.a].capabilities}function Pi({subjectId:e,objectTypeId:t}){window.hsCalling&&window.hsCalling.triggerEvent&&window.hsCalling.triggerEvent({event:H.PAGE_NAVIGATION,data:{subjectId:e,objectTypeId:t}})}function Ri(e){window.hsCalling&&window.hsCalling.triggerEvent&&window.hsCalling.triggerEvent({event:H.SET_BROWSER_HISTORY,data:{history:e}})}function ki(e){const t=dt(e);fr(t);window[wi.a].capabilities=e}function xi(e){window.hsCalling.triggerEvent&&window.hsCalling.triggerEvent({event:H.HIDE_CALLING_WIDGET,data:e})}function Li(e){xi(e)}function Mi(e){const t=window[wi.a].lastSentReadyState;return!t||t.objectId!==e.objectId||t.objectTypeId!==e.objectTypeId}function Ni(e){window[wi.a].triggerEvent&&window.hsCalling.triggerEvent({event:H.SET_SUBJECT_FOR_THIRD_PARTIES,data:e})}function Gi({subjectId:e,objectTypeId:t,isQueueTask:n}){const i={objectId:Number(e),objectTypeId:t};if(Mi(i)){window[wi.a].lastSentReadyState=i;const e=pt({toSubject:i,isQueueTask:n});fr(e);Ni(i)}}function Fi(e){window.hsCalling.triggerEvent&&window.hsCalling.triggerEvent({event:H.PRELOAD_WIDGET,data:e})}function Wi(){Fi(!0)}function Ui(e){window.hsCalling.triggerEvent&&window.hsCalling.triggerEvent({event:H.SET_CALLING_PROVIDER_SETTING,data:e})}function Hi(e){const t=_t({callingProvider:e.callingProvider&&e.callingProvider.toJS(),fromNumber:e.fromNumber&&e.fromNumber.toJS()});fr(t);Ui(e)}function Bi(e){window.hsCalling.triggerEvent&&window.hsCalling.triggerEvent({event:H.SET_CALL_METHOD,data:e})}function zi({callMethod:e}){Bi(e);const t=bt(e);fr(t)}function qi({threadId:e}){const t=ht(e);fr(t)}function Vi(e){window.hsCalling.triggerEvent&&window.hsCalling.triggerEvent({event:H.ADD_CALLABLE_ASSOCIATION,data:e})}function Ki(e){const t=Et(e);fr(t);Vi(e)}function Qi(e){window.hsCalling.triggerEvent&&window.hsCalling.triggerEvent({event:H.REMOVE_CALLABLE_ASSOCIATION,data:e})}function Yi(e){const t=St(e);fr(t);Qi(e)}function Ji(e){window.hsCalling.triggerEvent&&window.hsCalling.triggerEvent({event:H.MINIMIZE_CALLING_WIDGET,data:e})}function $i(e){Ji(e)}function Zi(e){window[wi.a].triggerEvent&&window.hsCalling.triggerEvent({event:H.UPDATE_CALLEE_PHONE_NUMBER,data:e})}function Xi({objectId:e,objectTypeId:t,rawValue:n,property:i}){const r=gt({objectId:e,objectTypeId:t,rawValue:n,property:i});fr(r);Zi({objectId:e,objectTypeId:t,rawValue:n,property:i})}function er({isQueueTask:e}){const t=yt(e);fr(t)}function tr(e){const t=Tt(e);fr(t)}function nr(e){return{data:e,type:rt}}function ir(e){const t=nr(e);fr(t)}function rr(){return{type:nt}}function or(){fr(rr())}function ar(){return{type:it}}function sr(){fr(ar())}var cr=n("CG5N");function lr(e){window.hsCalling.triggerEvent&&window.hsCalling.triggerEvent({event:H.OPEN_WIDGET,data:e})}function ur(e){const{toSubject:t,startCall:n=!1,addPhoneNumber:i=!1,registerFromNumber:r=!1,learnMore:o=!1,callingProvider:a}=e||{};lr(e);const s=t&&t.objectTypeId,c=t&&t.objectId;if(s&&c&&t.numberPropertyName){if(!n){const e=ut(t);fr(e)}}else if(e&&a){const e=Object(cr.a)(a),t=vt(e);fr(t)}else if(r||o||i){const e=ft({registerFromNumber:r,learnMore:o,addPhoneNumber:i,toSubject:t});fr(e)}}var dr=n("cJIv");(()=>{window[wi.a]||(window[wi.a]={});window[wi.a].initialized||(window[wi.a]=Object.assign(window[wi.a],{capabilities:{customAssociations:!0,callOutcomes:!0,callTypes:!0,callingProviders:!0,fontStyles:!0,followupTasks:!0},lastSentReadyState:{},updateQueueByEventType:{},isReady:!1,initialized:!0,[Di.b]:ji,[Di.m]:Ii,[Di.s]:Oi,[Di.d]:Ai,[Di.i]:Pi,[Di.n]:Ri,[Di.v]:Gi,[Di.e]:Li,[Di.j]:Wi,[Di.q]:ki,[Di.p]:zi,[Di.a]:Ki,[Di.l]:Yi,[Di.u]:er,[Di.g]:$i,[Di.w]:qi,[Di.t]:Xi,[Di.o]:Hi,[Di.r]:tr,[Di.f]:or,[Di.c]:ir,[Di.k]:sr,[Di.h]:ur}))})();function pr(e){window[wi.a].postMessageToHubSpotIframe||(window[wi.a].postMessageToHubSpotIframe=e);hr()}let fr=(e,t=(()=>{}))=>{if(window[wi.a].postMessageToHubSpotIframe)if("function"==typeof t)window[wi.a].postMessageToHubSpotIframe(e,t);else{Object(dr.a)(new Error("[Calling Global API Error] expected postInternalMessage callback to be a function"),{extra:{message:e,callback:t}});window[wi.a].postMessageToHubSpotIframe(e,null)}else{window[wi.a].postMessageQueue||(window[wi.a].postMessageQueue=[]);window[wi.a].postMessageQueue.push(e)}};function hr(){if(window[wi.a].postMessageQueue&&window[wi.a].postMessageQueue.length>0){window[wi.a].postMessageQueue.forEach(e=>{fr(e)});window[wi.a].postMessageQueue=[]}}function mr(){window[wi.a].isReady=!0;if(window.hsCallingOnReady&&window.hsCallingOnReady.length){window.hsCallingOnReady.forEach(e=>{e()});window.hsCallingOnReady=[]}}let gr=()=>{Object(r.useEffect)(()=>{mr()},[])};function vr(){gr();return null}var _r=Object(r.memo)(vr),br=n("MO2O");function yr({onConfirm:e,onReject:t}){return Object(i.jsx)(br.a,{message:Object(i.jsx)(Y.a,{message:"callHostWidget.closeWithoutSave.message"}),description:Object(i.jsx)(Y.a,{message:"callHostWidget.closeWithoutSave.description"}),confirmLabel:Object(i.jsx)(Y.a,{message:"callHostWidget.closeWithoutSave.confirmLabel"}),rejectLabel:Object(i.jsx)(Y.a,{message:"callHostWidget.closeWithoutSave.rejectLabel"}),onConfirm:e,onReject:t,"data-test-id":"calling-confirm-close-modal"})}var Sr=yr;function Er({onConfirm:e,onReject:t}){return Object(i.jsx)(br.a,{message:Object(i.jsx)(Y.a,{message:"follow-up-task.confirmClose.title"}),description:Object(i.jsx)(Y.a,{message:"follow-up-task.confirmClose.message"}),confirmLabel:Object(i.jsx)(Y.a,{message:"follow-up-task.confirmClose.confirmLabel"}),rejectLabel:Object(i.jsx)(Y.a,{message:"follow-up-task.confirmClose.rejectLabel"}),onConfirm:e,onReject:t})}var Tr=Er;function wr({confirmHide:e,onConfirmHide:t,onRejectHide:n,showDiscardFollowupTask:r,onConfirmDiscardFollowupTask:o,onHideConfirmDiscardFollowupTask:a}){return Object(i.jsxs)(i.Fragment,{children:[e?Object(i.jsx)(Sr,{onConfirm:t,onReject:n}):null,r?Object(i.jsx)(Tr,{onConfirm:o,onReject:a}):null]})}var Cr=Object(r.memo)(wr),Ir=n("QvWB"),Or=n("DqRu");const jr=e=>{const t=e/1e3,n=Math.floor(t/60),i=Math.floor(n/60);let r=""+Math.floor(n%60),o=""+Math.floor(t%60);1===o.length&&(o=0+o);i>0&&1===r.length&&(r=0+r);const a=[r,o];i>0&&a.unshift(i.toString());return a.join(":")};class Dr extends r.Component{constructor(){super();this.tick=()=>{const e=jr(Date.now()-this.props.callStartTime);return this.setState({callDurationString:e})};this.state={callDurationString:jr(0)}}componentDidMount(){this.props.callStartTime&&(this.timer=setInterval(this.tick,1e3))}componentDidUpdate(e){!e.callStartTime&&this.props.callStartTime&&(this.timer=setInterval(this.tick,1e3))}componentWillUnmount(){this.timer&&clearInterval(this.timer)}render(){return Object(i.jsx)("span",{"data-test-id":"call-duration-timer",children:this.state.callDurationString})}}Dr.propTypes={callStartTime:m.a.number};var Ar=Dr,Pr=n("NLVp"),Rr=n("EIJv");function kr({formattedName:e,className:t}){return e?Object(i.jsx)(Rr.a,{className:t,children:e}):null}kr.propTypes={formattedName:m.a.string,className:m.a.string};var xr=kr,Lr=n("oHcW");const Mr=v()(Pr.a).withConfig({displayName:"ActiveCallTitleBar__HangupButton",componentId:"sc-5nfxsd-0"})(["width:110px !important;margin-left:16px;background-color:"," !important;color:"," !important;border:none !important;"],Ce.CANDY_APPLE_DARK,Ce.OLAF);class Nr extends r.PureComponent{renderTwilioCalleeTitle(){const{selectedCallMethod:e,selectedFromNumber:t,isRinging:n,selectedPhoneNumberMetadata:r,formattedName:o}=this.props,a=r?Object(vi.s)(r):"",s=r?Object(vi.h)(r):"";return e===$e.b&&n?Object(i.jsxs)("div",{className:"flex-column",children:[Object(i.jsx)(Y.a,{message:"header.callingYourPhone"}),Object(i.jsx)("div",{children:Object(i.jsx)("small",{children:t||null})})]}):Object(i.jsxs)("div",{className:"flex-column",children:[Object(i.jsx)("div",{children:Object(i.jsx)(xr,{formattedName:o})}),Object(i.jsx)("div",{children:Object(i.jsx)("small",{children:Object(i.jsx)(Lr.a,{value:a,extension:s})})})]})}render(){const{isTwilioBasedCallProvider:e,callStartTime:t,onEndCall:n,title:r}=this.props;return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{className:"flex-grow-1 p-right-3","data-selenium-test":"active-call-title-bar",tabIndex:0,children:e?this.renderTwilioCalleeTitle():r}),Object(i.jsxs)("div",{className:"flex-grow-0 flex-shrink-0 row-xs-center",children:[t&&Object(i.jsx)(Ar,{callStartTime:t}),e&&Object(i.jsx)(Mr,{"aria-label":"Hang up this call",onClick:n,"data-selenium-test":"calling-widget-end-call-button",children:Object(i.jsx)(Ir.a,{name:"callingHangup"})})]})]})}}Nr.propTypes={callStartTime:m.a.number,onEndCall:m.a.func.isRequired,isTwilioBasedCallProvider:m.a.bool.isRequired,title:m.a.node.isRequired,selectedFromNumber:m.a.string,selectedCallMethod:m.a.oneOf([$e.b,$e.a]),isRinging:m.a.bool.isRequired,selectedPhoneNumberMetadata:Object(A.a)("PhoneNumberPropertyMetadata"),formattedName:m.a.string};var Gr=n("5mtX");const Fr=v()(Gr.a).withConfig({displayName:"InactiveCallTitleBar__CloseButton",componentId:"sc-1ci0zs1-0"})(["position:relative;margin-right:5px;top:0;left:0;"]);class Wr extends r.PureComponent{render(){return Object(i.jsxs)(r.Fragment,{children:[Object(i.jsx)("div",{className:"flex-grow-1","data-selenium-test":"inactive-title-bar",children:this.props.title}),Object(i.jsx)("div",{className:"flex-grow-0 flex-shrink-0",children:this.props.onHide&&Object(i.jsx)(Fr,{size:"medium",onClick:this.props.onHide,"data-selenium-test":"calling-widget-close-button"})})]})}}Wr.propTypes={onHide:m.a.func,title:m.a.node.isRequired};var Ur=Wr,Hr=n("13qF");const Br="CANCELED",zr="FAILED",qr="BUSY",Vr="NO_ANSWER",Kr="COMPLETED",Qr=v()(Gr.a).withConfig({displayName:"PostCallTitleBar__CloseButton",componentId:"wi8odf-0"})(["position:relative;margin-right:5px;top:0;left:0;"]),Yr=[zr,Br,qr];class Jr extends r.PureComponent{getMessage(){const{endCallStatus:e,callDurationMs:t}=this.props,n=jr(t);switch(e){case Kr:return Object(i.jsx)(Y.a,{message:"header.callDuration",options:{callDuration:n}});case zr:return Object(i.jsx)(Y.a,{message:"header.status.callFailedTitle"});case qr:return Object(i.jsx)(Y.a,{message:"header.status.busyTitle"});case Vr:return Object(i.jsx)(Y.a,{message:"header.status.noAnswerTitle"});case Br:return Object(i.jsx)(Y.a,{message:"header.status.canceledTitle"});default:return Object(i.jsx)(Y.a,{message:"header.callEnded"})}}renderIcon(){const{endCallStatus:e}=this.props,t=Yr.includes(e),n=t?"remove":"success",r=t?Ce.CANDY_APPLE:Ce.OZ;return Object(i.jsx)("div",{children:Object(i.jsx)(Hr.a,{name:n,size:8,borderWidth:0,backgroundColor:r,color:Ce.OLAF,verticalAlign:"top",innerStyles:{transform:"scale(1.7)",transformOrigin:"center"}})})}render(){const{onHide:e,isEnding:t}=this.props;return t?Object(i.jsx)(Y.a,{message:"header.endingCall"}):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("div",{className:"flex-grow-1","data-selenium-test":"post-call-title-bar",children:[this.renderIcon(),Object(i.jsx)("div",{className:"p-left-2",children:this.getMessage()})]}),Object(i.jsx)("div",{className:"flex-grow-0 flex-shrink-0",children:e&&Object(i.jsx)(Qr,{size:"medium",onClick:e,"data-selenium-test":"calling-widget-close-button"})})]})}}Jr.propTypes={onHide:m.a.func,callDurationMs:m.a.number,isEnding:m.a.bool.isRequired,endCallStatus:m.a.string};const $r=e=>e===R.CallWidgetStates.RINGING,Zr=e=>e===R.CallWidgetStates.ANSWERED,Xr=e=>e===R.CallWidgetStates.ENDING,eo=e=>e===R.CallWidgetStates.INCOMING_INBOUND_CALL;var to=n("nMFT");const no=we()((e,t,n,r,o)=>{if(e||!t)return Object(i.jsx)(Y.a,{message:"header.defaultWidgetName"});if(t===to.a)return Object(i.jsx)(Y.a,{message:"callWidgetProviders.HubSpot.widgetTitle"});const a=eo(r)&&o===x.a.INBOUND,s=$r(r)&&o===x.a.OUTBOUND,c=Zr(r)&&o===x.a.INBOUND;if(n){let e="header.outboundCall";a&&(e="header.incomingInboundCall");s&&(e="header.initializingOutgoingCall");c&&(e="header.inboundCall");return Object(i.jsx)(Y.a,{message:e,options:{callProvider:t}})}return t}),io=we()(e=>Ee()("name",e,null)),ro=we()(e=>Object(F.b)(e)),oo=({onEndCall:e,callStartTime:t,endCallStatus:n,onHide:r,callStatus:o,thirdPartyCallDirection:a,selectedCallProvider:s,selectedFromNumber:c,selectedCallMethod:l,callDurationMs:u,selectedPhoneNumberMetadata:d,formattedName:p,shouldBlockCalling:f,isUngatedForExtensionsInboundCalling:h})=>{const m=Object(b.c)(o),g=Object(F.a)(s)&&Object(b.d)(o),v=ro(s),_=io(s),y=h&&!v&&(eo(o)||$r(o)||Zr(o));return m||y?Object(i.jsx)(Nr,{onEndCall:e,title:no(f,_,y,o,a),callStartTime:t,isTwilioBasedCallProvider:v,selectedCallMethod:l,selectedFromNumber:c,selectedPhoneNumberMetadata:d,isRinging:$r(o),formattedName:p}):g?Object(i.jsx)(Jr,{isEnding:Xr(o),onHide:r,endCallStatus:n,callDurationMs:u}):Object(i.jsx)(Ur,{title:no(f,_),onHide:r})};oo.propTypes={onEndCall:m.a.func,endCallStatus:m.a.string,callStartTime:m.a.number,callStatus:k.isRequired,thirdPartyCallDirection:L.isRequired,callDurationMs:m.a.number,onHide:m.a.func,selectedCallProvider:Object(A.a)("CallingProvider"),selectedFromNumber:m.a.string,selectedCallMethod:m.a.oneOf([$e.b,$e.a]),shouldBlockCalling:m.a.bool.isRequired,selectedPhoneNumberMetadata:Object(A.a)("PhoneNumberPropertyMetadata"),formattedName:m.a.string,isUngatedForExtensionsInboundCalling:m.a.bool};var ao=oo,so=n("xS1L");const co=v.a.div.withConfig({displayName:"DndCallWidgetTitleBar__TitleBarDragContainer",componentId:"sc-1w4av7-0"})(["background-color:",";color:",";height:",";cursor:move;align-items:center;"],e=>e.isCallActive?Ce.OZ:Ce.SLINKY,Ce.OLAF,e=>e.height+"px"),lo=v.a.div.withConfig({displayName:"DndCallWidgetTitleBar__TitleBarContainer",componentId:"sc-1w4av7-1"})(["position:relative;width:100%;margin:0 auto;z-index:99;"]);class uo extends r.PureComponent{constructor(...e){super(...e);this.titleBarEl=Object(r.createRef)();this.handleToggleMinimize=()=>{Ji(!this.props.isWidgetMinimized)};this.getShouldBlockCalling=we()(e=>Object(so.f)(e));this.getWidgetTitle=we()((e,t)=>e||!t?Object(i.jsx)(Y.a,{message:"header.defaultWidgetName"}):t===to.a?Object(i.jsx)(Y.a,{message:"callWidgetProviders.HubSpot.widgetTitle"}):t)}componentDidUpdate(e){e.isWidgetHidden&&!this.props.isWidgetHidden&&this.titleBarEl.current.focus()}render(){const{isWidgetMinimized:e,callStatus:t,thirdPartyCallDirection:n,connectDragSource:r,onEndCall:o,callStartTime:a,endCallStatus:s,callDurationMs:c,onHide:l,selectedCallProvider:u,selectedFromNumber:d,selectedCallMethod:p,callingAccess:f,selectedPhoneNumberMetadata:h,formattedName:m,isUngatedForExtensionsInboundCalling:g}=this.props,v=Object(so.f)(f),y=!v,S=Object(b.c)(t)?_.a:_.b;return Object(i.jsx)(lo,{className:"flex-column",height:S,children:Object(i.jsx)("div",{tabIndex:-1,ref:this.titleBarEl,children:r(Object(i.jsx)("div",{children:Object(i.jsxs)(co,{className:"p-all-3 flex-row",height:S,children:[y?Object(i.jsx)("div",{className:"flex-grow-0 flex-shrink-0",children:Object(i.jsx)(Or.a,{tabIndex:-1,use:"unstyled",onClick:this.handleToggleMinimize,"data-selenium-test":"calling-widget-minimize-button",children:Object(i.jsx)(Ir.a,{name:e?"right":"down",className:"m-right-3 flex-shrink-0 flex-grow-0",size:"xxs"})})}):null,Object(i.jsx)(ao,{onEndCall:o,callStartTime:a,endCallStatus:s,callStatus:t,thirdPartyCallDirection:n,callDurationMs:c,onHide:l,selectedCallProvider:u,selectedFromNumber:d,selectedCallMethod:p,shouldBlockCalling:v,selectedPhoneNumberMetadata:h,formattedName:m,isUngatedForExtensionsInboundCalling:g})]})}))})})}}uo.propTypes={onEndCall:m.a.func,endCallStatus:m.a.string,callStartTime:m.a.number,callingAccess:Object(A.a)("CallingAccess").isRequired,callDurationMs:m.a.number,onHide:m.a.func.isRequired,selectedCallProvider:Object(A.a)("CallingProvider"),isWidgetMinimized:m.a.bool.isRequired,callStatus:k.isRequired,thirdPartyCallDirection:L.isRequired,connectDragSource:m.a.func.isRequired,selectedFromNumber:m.a.string,selectedCallMethod:m.a.oneOf([$e.b,$e.a]),selectedPhoneNumberMetadata:Object(A.a)("PhoneNumberPropertyMetadata"),formattedName:m.a.string,isWidgetHidden:m.a.bool.isRequired,isUngatedForExtensionsInboundCalling:m.a.bool};var po=n("UM/G"),fo=n("LqZr"),ho=n("LMWw");const mo=()=>ho.Device.isSupported,go=v.a.strong.withConfig({displayName:"BrowserSupportCheck__StrongHeadingWrapper",componentId:"vpj5wp-0"})(["text-align:center;width:50%;"]),vo=v.a.div.withConfig({displayName:"BrowserSupportCheck__DescriptionWrapper",componentId:"vpj5wp-1"})(["text-align:center;width:75%;"]);function _o({children:e}){if(!mo()){const e={name:"errors/general",size:"25%"};return Object(i.jsxs)("div",{className:"width-100 height-100 p-top-4 p-bottom-8 flex-column align-center",children:[Object(i.jsx)(fo.a,Object.assign({},e)),Object(i.jsx)(go,{className:"m-top-4 m-bottom-2",children:Object(i.jsx)(Y.a,{message:"call-widget-addon.browser-support.not-supported.header"})}),Object(i.jsx)(vo,{children:Object(i.jsx)(he.a,{message:"call-widget-addon.browser-support.not-supported.description_jsx",options:{external:!0,href:"https://knowledge.hubspot.com/calling/what-are-the-technical-requirements-to-use-the-calling-tool#web-browser"},elements:{UILink:fe.a}})})]})}return e}_o.propTypes={children:m.a.node.isRequired};var bo=_o,yo=n("0Fpj"),So=n("Q3/U");function Eo(e){Object(U.a)("addEventListener",{event:H.OPEN_WIDGET,callback:e})}function To(e){Object(U.a)("removeEventListener",{event:H.OPEN_WIDGET,callback:e})}var wo=n("oL2g"),Co=n("mPa/");let Io,Oo;!function(e){e.FROM_WORKER_UPDATED_WIDGET_DETAILS="FROM_WORKER_UPDATED_WIDGET_DETAILS";e.FROM_WORKER_STANDALONE_HEARTBEAT="FROM_WORKER_STANDALONE_HEARTBEAT";e.FROM_WORKER_ACTIVE_CALL_CONNECTION_PING="FROM_WORKER_ACTIVE_CALL_CONNECTION_PING"}(Io||(Io={}));!function(e){e.FROM_WORKER_UPDATED_APPDATA="FROM_WORKER_UPDATED_APPDATA"}(Oo||(Oo={}));var jo=n("vmYA");n("TWm9");const Do=({appData:e})=>Object.assign({},Object(Co.a)(jo.a.APP_DATA_UPDATED),{type:Oo.FROM_WORKER_UPDATED_APPDATA,payload:{appData:e}});var Ao=n("iUMT"),Po=n("dVaA");const Ro="CALLING_CROSS_TAB_MESSAGING_READY",ko="CALLING_CROSS_TAB_MESSAGING_UNSUPPORTED";var xo=n("4/Qf"),Lo=n("sRa6");const Mo=(e=window)=>new Promise(t=>{const n=setTimeout(()=>{Object(Lo.a)().counter("instance-availability-timeout").increment();t(void 0)},6e4);Object(xo.a)().then(i=>{if(i)if(i.isReady){clearTimeout(n);t(i)}else{e.addEventListener(ko,()=>{clearTimeout(n);t(i)});e.addEventListener(Ro,()=>{clearTimeout(n);if(i.isReady)t(i);else{Object(Lo.a)().counter("ready-event-fired-before-isReady").increment();t(void 0)}})}else{clearTimeout(n);t(void 0)}}).catch(e=>{clearTimeout(n);Object(Lo.a)().counter("instance-ready-failed").increment();Object(Po.a)(new Ao.a({message:"Error waiting for Calling Cross Tab Singleton",details:{error:e}}));t(void 0)})});var No=n("EN8f"),Go=n("gwL2"),Fo=n("cMNk");const Wo="CALLING_WIDGET_IFRAME_ENV";let Uo=()=>document.cookie||"";const Ho=N()(()=>console.info("Set `localStorage.CALLING_WIDGET_IFRAME_ENV='local'` to debug Calling Widget UI locally.")),Bo=e=>{try{const t=window.localStorage.getItem(Wo),n="app"===t||"local"===t?t:null;Qn.a.deployed()||"local"===n||Ho();return n||("call-integration"===e||Uo().includes("hs_selenium")?Qn.a.deployed()?"app":"local":"app")}catch(e){return"app"}},zo=v.a.div.withConfig({displayName:"CallProviderViewport__StyledViewportContainer",componentId:"sc-5kz8i9-0"})(["width:100%;height:100%;visibility:",";& > iframe{display:",";flex:1;}"],({isWidgetMinimized:e})=>e?"hidden":"",({active:e})=>e?"flex":"none"),qo=v.a.div.withConfig({displayName:"CallProviderViewport__CallWidgetContentsWrapper",componentId:"sc-5kz8i9-1"})(["background-color:",";flex:1;"],Ce.OLAF);class Vo extends r.PureComponent{constructor(e){super(e);this.state={endCallStatus:null,callStartTime:null,selectedFromNumber:null,selectedPhoneNumberMetadata:null,selectedCallMethod:Object(S.a)("selectedCallMethod",$e.a),callDurationMs:0,formattedName:null,confirmHide:!1,showDiscardFollowupTask:!1,internalWidgetTimeout:!1,showVersionDifferenceWarning:!1};this._thirdPartyEvents={};this.handleAddThirdPartyEvents=e=>{this._thirdPartyEvents=e};this.handleClearThirdPartyEvents=()=>{this._thirdPartyEvents={}};this.handleThirdPartyIncomingCall=e=>{if(this.isUngatedForExtensionsInboundCalling){const t=e&&e.callStartTime||Date.now();this.setState({callStartTime:t})}this.props.onThirdPartyCallDirection(x.a.INBOUND);this.props.onSetCallStatus(R.INCOMING_INBOUND_CALL)};this.iframeMessageCallbacks={[oe]:e=>this.props.onUpdateMinimumDimensions(e),[ce]:e=>this.handleThirdPartyIncomingCall(e),[X]:e=>this.handleCallStarted(e),[J]:()=>this.handleCallAnswered(),[$]:e=>this.handleCallEnded(e),[Z]:e=>this.handleCallSaved(e),[te]:e=>this.handleCreatedFollowupTask(e),[le]:e=>{Object(So.b)(new be.a(e))},[ue]:({fromNumber:e})=>{Object(So.c)(new yo.a(e))},[de]:({callMethod:e})=>{Bi(e)},[ne]:e=>{li(Object.assign({type:e.notificationType},e))},[ee]:ye.a,[re]:()=>this.setState({showDiscardFollowupTask:!0}),[ie]:e=>this.props.refreshCalleeOmnibus(e),[se]:()=>this.handleReloadIframe()};this.internalWidgetContext=null;this._queuedMessages=[];this.getIsTwilioBasedCallProvider=we()(e=>Object(F.b)(e));this.getSelectedProviderName=we()(e=>Ee()("name",e,null));this.getInternalIframeSrc=()=>{const{appIdentifier:e,subjectId:t,ownerId:n,selectedCallProvider:i,isQueueTask:r,objectTypeId:o,isWidgetHidden:a}=this.props,s=hi({appIdentifier:e,subjectId:t,ownerId:n,selectedCallProvider:i,isQueueTask:r,portalId:ui(),objectTypeId:o,isWidgetHidden:a}),c=Bo(e);return`${Object(Q.getFullUrl)(c)}${Ee()("url",s)}`};this.sendInternalIframeMessage=(e,t=f.a)=>{this.internalWidgetContext?this.internalWidgetContext.sendMessage(e.type,{data:e.data||e.payload},t):this._queuedMessages.push(e)};this.handleInternalIFrameReady=(e,t)=>{if(!t||t.version!==_.e){this.setState({showVersionDifferenceWarning:!0});Object(Ye.c)({key:ai,tags:{crm:_.e,widget:t.version}});return}this.internalWidgetContext=e;this.props.onSetCallStatus(R.READY);this._queuedMessages.forEach(this.sendInternalIframeMessage);this._queuedMessages=[];const{selectedCallProvider:n}=this.props,i=this.getIsTwilioBasedCallProvider(n)?this.getSelectedProviderName(n):"INTERNAL";Object(Ye.c)({key:ri,tags:{provider:i}});Fo.a.counter("call-widget-ready",{provider:i}).increment()};this.handleWidgetIFrameError=e=>{this.setState({internalWidgetTimeout:!0});const{selectedCallProvider:t}=this.props,n=this.getIsTwilioBasedCallProvider(t)?this.getSelectedProviderName(t):"INTERNAL";Object(Ye.c)({key:ii,tags:{type:e,provider:n}});Fo.a.counter("call-widget-timeout",{type:e,provider:n}).increment()};this.handleReloadIframe=()=>{this.handleResetCallStatus();this.setState({internalWidgetTimeout:!1});this.props.setShouldLoadWidgetIframe(!1)};this.handleCreatedFollowupTask=e=>{this.props.onCreatedFollowUpTask(e.engagementId);window.hsCalling.triggerEvent({event:H.ON_CREATED_FOLLOWUP_TASK,data:e.engagementId})};this.handleCallStarted=e=>{Object(No.a)();const{formattedName:t=null,selectedCallMethod:n=null,selectedFromNumber:i=null,selectedPhoneNumberMetadata:r=null}=e||{},{selectedCallProvider:o}=this.props,a=!this.getIsTwilioBasedCallProvider(o);let s=Date.now();if(a){s=e&&e.callStartTime||s;this.props.onThirdPartyCallDirection(x.a.OUTBOUND)}this.setState({formattedName:t,selectedCallMethod:n,selectedFromNumber:i,selectedPhoneNumberMetadata:r&&new Je.e(r),callStartTime:s,endCallStatus:null,callDurationMs:0});Object(No.b)({callStatus:R.RINGING,activeCallDetails:{direction:x.a.OUTBOUND}});this.props.onSetCallStatus(R.RINGING);this.props.onCallStarted();window.hsCalling.triggerEvent({event:H.ON_CALL_STARTED,data:e})};this.handleCallAnswered=()=>{this.props.onSetCallStatus(R.ANSWERED);Object(No.b)({callStatus:R.ANSWERED})};this.handleEndCall=()=>{const{onSetCallStatus:e,isQueueTask:t}=this.props,n=at({isQueueTask:t});fr(n);e(R.ENDING)};this.handleCallEnded=e=>{const t={callStartTime:null};if(e&&e.twilioCallStatus){t.endCallStatus=e.twilioCallStatus;t.callDurationMs=e.twilioCallDurationMs}this.setState(t);this.props.onSetCallStatus(R.ENDED);this.props.onCallEnded();Object(No.a)()};this.handleCallSaved=e=>{this.props.onSetIsWidgetHidden(!0);this.props.onSetCallStatus(R.READY);this.props.onCallSaved(e,!1);window.hsCalling.triggerEvent({event:H.ON_CALL_SAVED,data:e})};this.handleCallSavedThirdParty=e=>{const{subject:t}=this.props,n=e&&e.engagementId;if(!n)return;const i={engagementId:n,objectId:Ee()("objectId",t),subjectId:Ee()("objectId",t),objectTypeId:Ee()("objectTypeId",t)},r=mt(i);fr(r,()=>{this.props.onCallSaved(i)})};this._queuedStartCall=null;this.handleStartCallFromHost=e=>{const{selectedCallProvider:t,callStatus:n,ownerId:i,subject:r}=this.props;n!==R.UNINITIALIZED?t&&Ti({toSubject:e,callStatus:n,ownerId:i,subject:r}).then(e=>{if(e)if(this.getIsTwilioBasedCallProvider(t)){const t=ot(e);fr(t)}else this._thirdPartyEvents[ae]&&this._thirdPartyEvents[ae](e);else n===R.ENDED&&this.handleResetCallStatus()}):this._queuedStartCall=e};this.connectionStatusUpdate=e=>{if(e.type===wo.a&&e.detail&&e.detail.appData&&e.detail.updates.length>0){const{detail:{updates:t,appData:n}}=e;if(t.includes("widgetDetails")){const e=Do({appData:n});this.sendInternalIframeMessage(e)}}};this.handleSelectToNumber=e=>{const{callStatus:t,onSetCallStatus:n,selectedCallProvider:i}=this.props,{startCall:r,toSubject:o,callingProvider:a}=e,s=Object(vi.r)(o),c=Object(vi.o)(o);if(s&&c&&o.numberPropertyName){const e=this.getIsTwilioBasedCallProvider(i);t===R.ENDED&&n(R.READY);!r&&e||this.handleStartCallFromHost(o)}else e&&a&&Object(So.b)(a)};this.handleWorkerMessage=e=>{this.handleInternalIframeMessage({payload:Object.assign({type:e.type},e.data)})};this.handleInternalIframeMessage=e=>{const t=e.payload,{type:n}=t,i=Object(p.a)(t,["type"]),{selectedCallProvider:r}=this.props,o=this.getIsTwilioBasedCallProvider(r)?this.iframeMessageCallbacks[n]:this._thirdPartyEvents[n]||this.iframeMessageCallbacks[n];if(o&&"function"==typeof o)o(i);else{Object(Ye.c)({key:oi,tags:{type:n}});Fo.a.counter("unhandled_embed_event_type",{type:n}).increment()}};this.handleHideWidget=()=>{const e=lt();fr(e,({shouldConfirm:e})=>{e?this.setState({confirmHide:e}):this.handleConfirmHide()})};this.handleResetCallStatus=()=>{this.setState({endCallStatus:null,confirmHide:!1,showDiscardFollowupTask:!1});this.props.onThirdPartyActive(!1);this.props.onSetCallStatus(R.READY)};this.handleResetCallStatusAndHide=()=>{this.handleResetCallStatus();this.props.onSetIsWidgetHidden(!0)};this.handleConfirmHide=()=>{const e=ct();fr(e);this.handleResetCallStatusAndHide()};this.handleRejectHide=()=>this.setState({confirmHide:!1});this.handleConfirmDiscardFollowupTask=()=>{this.setState({showDiscardFollowupTask:!1});const e=st();fr(e)};this.handleHideConfirmDiscardFollowupTask=()=>this.setState({showDiscardFollowupTask:!1});pr(this.sendInternalIframeMessage);this.isUngatedForExtensionsInboundCalling=this.props.gates&&this.props.gates.includes(Go.b);this.isUngatedForExtensionsCallDirection=this.props.gates&&this.props.gates.includes(Go.a)}componentDidMount(){Mo().then(e=>{if(!e)return;const t=e.appData,n=Do({appData:t});this.sendInternalIframeMessage(n)}).catch(e=>{Object(Ye.b)(e)});Object(wo.b)(this.connectionStatusUpdate);Eo(this.handleSelectToNumber)}componentDidUpdate(e){if(this._queuedStartCall&&e.callStatus===R.UNINITIALIZED&&this.props.callStatus===R.READY){this.handleStartCallFromHost(this._queuedStartCall);this._queuedStartCall=null}e.shouldLoadWidgetIframe&&!this.props.shouldLoadWidgetIframe&&this.props.setShouldLoadWidgetIframe(!0)}componentWillUnmount(){Object(wo.c)(this.connectionStatusUpdate);To(this.handleSelectToNumber)}renderPublicCallingAPI(){return Object(i.jsx)(_r,{})}renderTitleBar(){const e=this.props,t=this.state,{selectedCallProvider:n}=e;return Object(i.jsx)(uo,{isWidgetHidden:e.isWidgetHidden,callStatus:e.callStatus,thirdPartyCallDirection:e.thirdPartyCallDirection,connectDragSource:e.connectDragSource,isWidgetMinimized:e.isWidgetMinimized,endCallStatus:t.endCallStatus,callStartTime:t.callStartTime,selectedCallMethod:t.selectedCallMethod,selectedFromNumber:t.selectedFromNumber,callDurationMs:t.callDurationMs,selectedPhoneNumberMetadata:t.selectedPhoneNumberMetadata,formattedName:t.formattedName,selectedCallProvider:n,onEndCall:this.handleEndCall,onHide:this.handleHideWidget,callingAccess:e.callingAccess,isUngatedForExtensionsInboundCalling:this.isUngatedForExtensionsInboundCalling})}renderIframe(){const e=this.props,{showVersionDifferenceWarning:t}=this.state,n=!this.getIsTwilioBasedCallProvider(e.selectedCallProvider);if(!e.shouldLoadWidgetIframe)return Object(i.jsx)(Qe,{isThirdPartyProvider:n});if(this.state.internalWidgetTimeout){const e=Object(i.jsx)(Y.a,{message:"callHostWidget.syncTimeout.title"});return Object(i.jsx)("div",{className:"height-100 flex-column justify-center align-center",children:Object(i.jsx)(po.a,{title:e,onClick:this.handleReloadIframe})})}return t?Object(i.jsx)(_e,{}):Object(i.jsxs)(zo,{isWidgetMinimized:e.isWidgetMinimized,"data-selenium-test":"call-widget-contents",active:!e.isThirdPartyActive,children:[Object(i.jsx)(K.a,{appName:"calling-communicator-ui",name:"calling-communicator-ui",scrolling:!1,initTimeout:3e4,readyTimeout:3e4,width:"100%",height:"100%",src:this.getInternalIframeSrc(),onReady:this.handleInternalIFrameReady,onMessage:this.handleInternalIframeMessage,onReadyError:this.handleWidgetIFrameError,onInitError:this.handleWidgetIFrameError,active:!e.isThirdPartyActive,className:"hubspot-calling-iframe"}),n&&Object(i.jsx)(ti,{callStatus:e.callStatus,isQueueTask:e.isQueueTask,isThirdPartyActive:e.isThirdPartyActive,isWidgetHidden:e.isWidgetHidden,isWidgetMinimized:e.isWidgetMinimized,onAddThirdPartyEvents:this.handleAddThirdPartyEvents,onCallEnded:this.handleCallEnded,onCallSaved:this.handleCallSavedThirdParty,onCallStarted:this.handleCallStarted,onClearThirdPartyEvents:this.handleClearThirdPartyEvents,onSetCallStatus:e.onSetCallStatus,onSetIsWidgetHidden:e.onSetIsWidgetHidden,onThirdPartyActive:e.onThirdPartyActive,onThirdPartyWidgetResize:e.onThirdPartyWidgetResize,ownerId:e.ownerId,postMessageToHubSpotIframe:fr,selectedCallProvider:e.selectedCallProvider,subject:e.subject,isUngatedForExtensionsCallDirection:this.isUngatedForExtensionsCallDirection,isUngatedForExtensionsInboundCalling:this.isUngatedForExtensionsInboundCalling})]})}render(){const e=this.props,t=!this.getIsTwilioBasedCallProvider(e.selectedCallProvider);return Object(i.jsxs)(i.Fragment,{children:[this.renderPublicCallingAPI(),this.renderTitleBar(),Object(i.jsx)(bo,{children:Object(i.jsx)(qo,{className:"flex-column","data-test-id":"call-widget-contents-wrapper","data-minimized":e.isWidgetMinimized,children:Object(i.jsx)(ni.a,{appIdentifier:e.appIdentifier,scopes:e.scopes,callingAccess:e.callingAccess,isWidgetMinimized:e.isWidgetMinimized,LoadingComponent:Qe,isThirdPartyProvider:t,children:this.renderIframe()})})}),Object(i.jsx)(Cr,{confirmHide:this.state.confirmHide,showDiscardFollowupTask:this.state.showDiscardFollowupTask,onConfirmHide:this.handleConfirmHide,onRejectHide:this.handleRejectHide,onConfirmDiscardFollowupTask:this.handleConfirmDiscardFollowupTask,onHideConfirmDiscardFollowupTask:this.handleHideConfirmDiscardFollowupTask})]})}}Vo.propTypes={appIdentifier:m.a.string.isRequired,connectDragSource:m.a.func.isRequired,onCreatedFollowUpTask:m.a.func.isRequired,onCallStarted:m.a.func.isRequired,onCallEnded:m.a.func.isRequired,onCallSaved:m.a.func.isRequired,ownerId:m.a.oneOfType([m.a.string,m.a.number]),onThirdPartyActive:m.a.func.isRequired,isThirdPartyActive:m.a.bool.isRequired,onThirdPartyCallDirection:m.a.func.isRequired,thirdPartyCallDirection:L.isRequired,onThirdPartyWidgetResize:m.a.func.isRequired,onUpdateMinimumDimensions:m.a.func.isRequired,refreshCalleeOmnibus:m.a.func.isRequired,onSetCallStatus:m.a.func.isRequired,callStatus:k.isRequired,scopes:m.a.object.isRequired,callingAccess:Object(A.a)("CallingAccess").isRequired,isQueueTask:m.a.bool.isRequired,subjectId:m.a.oneOfType([m.a.string,m.a.number]),objectTypeId:P.b,selectedCallProvider:Object(A.a)("CallingProvider").isRequired,isWidgetHidden:m.a.bool.isRequired,isWidgetMinimized:m.a.bool.isRequired,onSetIsWidgetHidden:m.a.func.isRequired,shouldLoadWidgetIframe:m.a.bool.isRequired,setShouldLoadWidgetIframe:m.a.func.isRequired,subject:l.a.map.isRequired,gates:m.a.array};var Ko=Vo;const Qo=N()(e=>{window.requestIdleCallback&&window.requestIdleCallback(()=>{e()})}),Yo=e=>{window.cancelIdleCallback&&window.cancelIdleCallback(e)};function Jo(e){const{defaultHidden:t,asyncSettingsOmnibus:n,selectedCallProvider:o,onSetIsWidgetHidden:a,subjectId:c,objectTypeId:l,gates:u}=e,[d,p]=Object(r.useState)(!1),[f,h]=Object(r.useState)(!1);q(Object(r.useCallback)(()=>{h(!0)},[]));const[m,g]=Object(r.useState)(Object(s.Map)({objectId:c,objectTypeId:l})),v=Object(r.useCallback)(e=>{g(Object(s.Map)(e))},[]);B(v);Object(r.useEffect)(()=>{if(t||d||!Object(G.c)(n))return;p(!0);let e=!1;const i=Object(G.a)(n);if(Object(F.b)(o)){const t=Object(W.i)(i);if(t){const n=Object(F.a)(o)?Object(W.f)(t).concat(Object(W.e)(t)):Object(W.c)(t);e=n&&n.size>0}}else e=!0;if(e){a(!1);h(!0)}},[n,t,a,o,d]);const _=Object(r.useCallback)(()=>{h(!0)},[]);z(h);Object(r.useEffect)(()=>{f?Yo(_):Qo(_)},[_,f]);return Object(i.jsx)(Ko,Object.assign({},e,{subject:m,setSubject:v,setShouldLoadWidgetIframe:h,shouldLoadWidgetIframe:f,gates:u}))}var $o=Object(V.a)(Jo),Zo=n("+yfp"),Xo=n.n(Zo);const ea=v.a.div.withConfig({displayName:"CallWidgetResizeContainer__CallWidgetContainer",componentId:"sc-1ac9o16-0"})(["position:relative;background-color:",";box-shadow:0 0 10px 1px rgba(0,0,0,0.3);overflow:hidden;resize:",";iframe{border:none;}.call-widget-host{overflow:hidden;}"],Ce.OLAF,({resize:e})=>e?"both":"none"),ta=v.a.div.withConfig({displayName:"CallWidgetResizeContainer__ResizeHandle",componentId:"sc-1ac9o16-1"})(["position:absolute;bottom:-2px;right:-2px;height:12px;width:12px;transform:rotate(45deg);background:transparent;border-left:1px solid ",";&::before{content:' ';display:block;background:",";height:6px;width:1px;margin:3px 0 0 3px;}"],Ce.FLINT,Ce.FLINT);class na extends r.PureComponent{constructor(e){super(e);this.callWidgetResizeContainer=null;this.debouncedResize=Xo()(250,e=>{const{isThirdPartyActive:t,isWidgetMinimized:n,isWidgetHidden:i,isDragging:r}=this.props;for(const o of e){const{height:e,width:a}=o.target.getBoundingClientRect();if(t||n||i||r)return;this.props.onTwilioWidgetResize({height:e,width:a})}});this.setCallWidgetContainerRef=e=>{this.callWidgetResizeContainer&&this.resizeObserver.unobserve(this.callWidgetResizeContainer);this.callWidgetResizeContainer=e;this.callWidgetResizeContainer&&this.resizeObserver.observe(this.callWidgetResizeContainer)};this.resizeObserver=new ResizeObserver(this.debouncedResize)}render(){const{children:e,height:t,width:n,maxHeight:r,maxWidth:o,minHeight:a,minWidth:s,selectedCallProvider:c,isWidgetMinimized:l,callStatus:u}=this.props,d=Object(b.e)(u);if(!Object(F.b)(c))return Object(i.jsx)(ea,{resize:!1,className:"flex-column",style:{width:n,height:l?d:t},children:e});const p={width:n,height:t,maxHeight:r,maxWidth:o,minWidth:s,minHeight:a};if(l){p.height=d;p.minHeight=0}return Object(i.jsxs)(ea,{ref:this.setCallWidgetContainerRef,className:"flex-column",style:p,resize:!l,children:[e,l?null:Object(i.jsx)(ta,{})]})}}const ia=m.a.oneOfType([m.a.string,m.a.number]);class ra extends r.PureComponent{constructor(...e){super(...e);this.handleTwilioWidgetResize=({height:e,width:t})=>{this.props.isDragging||this.props.onTwilioWidgetResize({height:e,width:t})}}render(){const{isWidgetHidden:e,isDragging:t,connectDragPreview:n,appIdentifier:r,ownerId:o,connectDragSource:a,onCreatedFollowUpTask:s,onCallStarted:c,onCallEnded:l,onCallSaved:u,objectTypeId:d,subjectId:p,isThirdPartyActive:f,onThirdPartyActive:h,thirdPartyCallDirection:m,onThirdPartyCallDirection:g,width:v,height:_,maxWidth:b,maxHeight:y,minWidth:S,minHeight:E,onUpdateMinimumDimensions:T,onThirdPartyWidgetResize:w,isWidgetMinimized:C,onSetCallStatus:I,callStatus:O,selectedCallProvider:j,didDrop:D,scopes:A,isQueueTask:P,onSetIsWidgetHidden:k,defaultHidden:x,asyncSettingsOmnibus:L,refreshCalleeOmnibus:M,gates:N}=this.props,G=e?"hidden":"";return n(Object(i.jsx)("div",{className:G,style:{height:t&&!D?0:void 0,overflow:t&&!D?"hidden":void 0},"data-test-id":"call-provider-ui-container","data-selenium-test":"call-provider-ui-container","data-widget-status":O||R.LOADING,children:Object(i.jsx)(na,{height:_,width:v,onTwilioWidgetResize:this.handleTwilioWidgetResize,isWidgetMinimized:C,isWidgetHidden:e,maxHeight:y,maxWidth:b,minHeight:E,minWidth:S,selectedCallProvider:j,isDragging:t,callStatus:O,children:Object(i.jsx)($o,{defaultHidden:x,scopes:A,gates:N,appIdentifier:r,connectDragSource:a,onUpdateMinimumDimensions:T,onThirdPartyWidgetResize:w,onCreatedFollowUpTask:s,onCallStarted:c,onCallEnded:l,onCallSaved:u,ownerId:o,onThirdPartyActive:h,isThirdPartyActive:f,thirdPartyCallDirection:m,onThirdPartyCallDirection:g,isWidgetHidden:e,subjectId:p,objectTypeId:d,isWidgetMinimized:C,callStatus:O,onSetCallStatus:I,isQueueTask:P,selectedCallProvider:j,onSetIsWidgetHidden:k,asyncSettingsOmnibus:L,refreshCalleeOmnibus:M})})}))}}ra.propTypes={appIdentifier:m.a.string.isRequired,connectDragSource:m.a.func.isRequired,connectDragPreview:m.a.func.isRequired,isWidgetHidden:m.a.bool.isRequired,isDragging:m.a.bool.isRequired,isWidgetMinimized:m.a.bool.isRequired,ownerId:ia,onCreatedFollowUpTask:m.a.func.isRequired,onCallStarted:m.a.func.isRequired,onCallEnded:m.a.func.isRequired,onCallSaved:m.a.func.isRequired,onSetCallStatus:m.a.func.isRequired,subjectId:m.a.oneOfType([m.a.string,m.a.number]),callStatus:k.isRequired,objectTypeId:P.b,isThirdPartyActive:m.a.bool.isRequired,onThirdPartyCallDirection:m.a.func.isRequired,thirdPartyCallDirection:L.isRequired,onTwilioWidgetResize:m.a.func.isRequired,onUpdateMinimumDimensions:m.a.func.isRequired,onThirdPartyWidgetResize:m.a.func.isRequired,onThirdPartyActive:m.a.func.isRequired,maxHeight:m.a.number.isRequired,maxWidth:m.a.number.isRequired,width:m.a.number.isRequired,height:m.a.number.isRequired,minWidth:m.a.number.isRequired,minHeight:m.a.number.isRequired,selectedCallProvider:Object(A.a)("CallingProvider").isRequired,didDrop:m.a.bool.isRequired,scopes:m.a.object.isRequired,isQueueTask:m.a.bool.isRequired,onSetIsWidgetHidden:m.a.func.isRequired,defaultHidden:m.a.bool.isRequired,asyncSettingsOmnibus:Object(A.a)("AsyncSettingsOmnibusResult").isRequired,refreshCalleeOmnibus:m.a.func.isRequired,gates:m.a.array};const oa=Object(E.DragSource)("calling-widget",{beginDrag(e,t){e.setPointerEvents("all");return{name:e.selectedCallProvider.name}},endDrag(e){e.setPointerEvents("none")}},(e,t)=>({connectDragSource:e.dragSource(),connectDragPreview:e.dragPreview(),didDrop:t.didDrop(),isDragging:t.isDragging()}))(ra);var aa=Object(r.forwardRef)((e,t)=>Object(i.jsx)(oa,Object.assign({},e,{innerRef:t}))),sa=n("zqaE"),ca=n("Lt3g"),la=n.n(ca),ua=n("mLCl");const da=v.a.div.withConfig({displayName:"CallWidgetDndProvider__CallingWidgetWrapper",componentId:"sc-169tl3z-0"})([".call-widget__drop-target{position:fixed;z-index:100;top:0;left:0;height:100vh;width:100vw;}.call-widget__drag-target{position:fixed;z-index:100;}"]),pa="CallWidgetCoordinates";class fa extends r.PureComponent{static getDerivedStateFromProps(e,t){const{widgetState:n,selectedCallProvider:i}=e,{height:r,width:o,currentSelectedCallProvider:a}=t;if(i===a)return t;const s=gi({selectedCallProvider:i,callStatus:n.get("callStatus")}),c=t;c.currentSelectedCallProvider=i;return r!==s.height||o!==s.width?Object.assign({},c,{},s):c}constructor(e){super(e);this.setPointerEvents=e=>{this.setState({pointerEvents:e})};this.onUpdateWidgetCoordinates=({top:e,left:t,maxHeight:n,maxWidth:i})=>{Object(S.b)(pa,{top:e,left:t});this.setState({left:t,top:e,maxWidth:i,maxHeight:n})};this.handleUpdateMinimumDimensions=e=>{const{minWidth:t,minHeight:n}=this.state;let{height:i,width:r}=this.state;const o=e.minHeight||n,a=e.minWidth||t;if(o!==n||a!==t){i=i===n?o:i;r=r===t?a:r;this.setState({minHeight:o,minWidth:a,height:i,width:r})}};this.handleTwilioWidgetResize=({height:e,width:t})=>{const{height:n,width:i}=this.state;if(e!==n||t!==i){Object(S.b)(mi,{height:e,width:t});this.setState({height:e,width:t})}};this.handleThirdPartyWidgetResize=({width:e,height:t})=>{this.setState({thirdPartyWidth:parseInt(e,10),thirdPartyHeight:parseInt(t,10)})};this.handleSetCallStatus=e=>{this.props.onSetCallStatus(e)};this.handleSetThirdPartyCallDirection=e=>{this.props.onSetThirdPartyCallDirection(e)};const t=e.selectedCallProvider,{height:n,width:i,minHeight:r,minWidth:o,thirdPartyHeight:a,thirdPartyWidth:s}=gi({selectedCallProvider:t,callStatus:e.widgetState.get("callStatus")}),{left:c,top:l}=Object(S.a)(pa,{top:0,left:0});this.state={height:n,width:i,minHeight:r,minWidth:o,maxHeight:0,maxWidth:0,thirdPartyHeight:a,thirdPartyWidth:s,left:c,top:l,pointerEvents:"none",currentSelectedCallProvider:t}}render(){const{left:e,top:t,pointerEvents:n,thirdPartyHeight:r,thirdPartyWidth:o,maxWidth:a,maxHeight:s,currentSelectedCallProvider:c}=this.state;let{height:l,width:u}=this.state;const{minHeight:d,minWidth:p}=this.state,{isWidgetHidden:f,isWidgetMinimized:h,widgetState:m,onSetThirdPartyActive:g,gates:v}=this.props,y=m.get("callStatus"),S=m.get("thirdPartyCallDirection"),E=m.get("isThirdPartyActive");if(E){u=o;l=r+Object(b.e)(y)+_.c}return Object(i.jsxs)(da,{children:[Object(i.jsx)(D,Object.assign({},{isWidgetHidden:f,isWidgetMinimized:h,updateWidgetCoordinates:this.onUpdateWidgetCoordinates,height:l,width:u,left:e,top:t,pointerEvents:n})),Object(i.jsx)("div",{style:{top:t,left:e},className:"call-widget__drag-target calling-widget-container",children:Object(i.jsx)(aa,Object.assign({},{setPointerEvents:this.setPointerEvents,isThirdPartyActive:E,onUpdateMinimumDimensions:this.handleUpdateMinimumDimensions,onTwilioWidgetResize:this.handleTwilioWidgetResize,onThirdPartyWidgetResize:this.handleThirdPartyWidgetResize,onThirdPartyActive:g,onSetCallStatus:this.handleSetCallStatus,callStatus:y,onThirdPartyCallDirection:this.handleSetThirdPartyCallDirection,thirdPartyCallDirection:S,height:l,width:u,minHeight:d,minWidth:p,maxWidth:a,maxHeight:s,selectedCallProvider:c,gates:v},{},this.props))})]})}}var ha=Object(y.a)()(la()(ua.a,sa.a)(fa));function ma(e){Object(r.useEffect)(()=>{Object(U.a)("addEventListener",{event:H.MINIMIZE_CALLING_WIDGET,callback:e});return()=>{Object(U.a)("removeEventListener",{event:H.MINIMIZE_CALLING_WIDGET,callback:e})}},[e])}function ga(e){const t=Object(r.useRef)(!0),[n,o]=Object(r.useState)(!1),{onVisibilityChange:a,isWidgetHidden:s,onSetIsWidgetHidden:c,gates:l}=e;Object(r.useEffect)(()=>{t.current?t.current=!1:a({isVisible:!s})},[s,a]);ma(o);return Object(i.jsx)(ha,Object.assign({},e,{isWidgetHidden:s,onSetIsWidgetHidden:c,isWidgetMinimized:n,gates:l}))}ga.propTypes={appIdentifier:m.a.string.isRequired,onCreatedFollowUpTask:m.a.func.isRequired,onCallStarted:m.a.func.isRequired,onCallEnded:m.a.func.isRequired,onCallSaved:m.a.func.isRequired,onVisibilityChange:m.a.func.isRequired,ownerId:m.a.oneOfType([m.a.string,m.a.number]),defaultHidden:m.a.bool,isWidgetHidden:m.a.bool.isRequired,onSetIsWidgetHidden:m.a.func.isRequired,gates:m.a.array};ga.defaultProps={defaultHidden:!0};var va=ga,_a=n("avof");class ba extends r.PureComponent{constructor(...e){super(...e);this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){const{appName:n}=this.props;Object(Ye.a)({errorMessage:"Error caught in CallWidget",extraData:{error:e,errorInfo:t,appName:n},tags:{component:"CallWidget"}})}render(){return this.state.hasError?Object(i.jsx)(_a.a,{appName:this.props.appName,isWidgetHidden:this.props.isWidgetHidden,onSetIsWidgetHidden:this.props.onSetIsWidgetHidden}):this.props.children}}var ya=n("Qx6s");class Sa extends(Object(s.Record)({customAssociations:!0,callOutcomes:!0,callTypes:!0,callingProviders:!0,fontStyles:!0,followupTasks:!0},"CapabilitiesRecord")){}var Ea=n("xo1h"),Ta=n("EnU0");function wa(e){Object(U.a)("addEventListener",{event:H.HIDE_CALLING_WIDGET,callback:e})}function Ca(e){Object(U.a)("removeEventListener",{event:H.HIDE_CALLING_WIDGET,callback:e})}var Ia=e=>{let{appIdentifier:t,subjectId:n,objectTypeId:o,ownerId:a,onCreatedFollowUpTask:s=f.a,onCallStarted:c=f.a,onCallEnded:l=f.a,onCallSaved:u=f.a,onVisibilityChange:d=f.a,defaultHidden:h=!0,capabilities:m=new Sa,scopes:g,gates:v}=e,_=Object(p.a)(e,["appIdentifier","subjectId","objectTypeId","ownerId","onCreatedFollowUpTask","onCallStarted","onCallEnded","onCallSaved","onVisibilityChange","defaultHidden","capabilities","scopes","gates"]);const[b,y]=Object(r.useState)(!0),S=Object(r.useCallback)(e=>{y(e)},[]),E=Object(r.useCallback)(()=>{S(!1);const e=document.getElementsByClassName("hubspot-calling-iframe")[0];e&&e.contentWindow&&e.contentWindow.focus()},[S]);Object(r.useEffect)(()=>{!1===m.callingProviders&&Object(Ea.g)(Object(Ta.a)());Object(ya.default)(Object.assign({},m.toJS()));Eo(E);wa(S);return()=>{Ca(S);To(E)}},[m,E,S]);return Object(i.jsx)(ba,{appName:"CALLING",isWidgetHidden:b,onSetIsWidgetHidden:S,children:Object(i.jsx)(va,Object.assign({},_,{appIdentifier:t,onCreatedFollowUpTask:s,onCallStarted:c,onCallEnded:l,onCallSaved:u,onVisibilityChange:d,onSetIsWidgetHidden:S,isWidgetHidden:b,scopes:g,subjectId:n,objectTypeId:o,ownerId:a,defaultHidden:h,gates:v}))})},Oa=n("5RMz"),ja=n("ubYp"),Da=n("wamM"),Aa=n("kuuX"),Pa=n("ge5o"),Ra=n("llmf"),ka=n("P4dz"),xa=n("fBvv"),La=n("0xjy"),Ma=n("muUi"),Na=n("1V8t"),Ga=n("t+2z"),Fa=n("ON69"),Wa=n("lOuL");const Ua={descriptor:m.a.instanceOf(Pa.a),engagementType:ja.K,objectType:P.b,queues:l.a.map,subjectId:m.a.oneOfType([m.a.string,m.a.number])},Ha={activeTaskId:m.a.number,objectType:P.b,subjectId:m.a.oneOfType([m.a.string,m.a.number])};var Ba=e=>{function t(t){let{activeTaskId:n,objectType:o,subjectId:a}=t,c=Object(p.a)(t,["activeTaskId","objectType","subjectId"]);const l=Object(Na.useStoreDependency)(Wa.a,{taskId:n}),u=l&&!Object(Fa.a)(l),d=Object(r.useCallback)(()=>{n||La.a.logError(o,{action:"taskId does not exist",activeTaskId:n});La.a.logRecordInteraction(o,{action:"Use task queues",subAction:"Clicks send/save and complete task"});const{queueType:e}=Da.d.getState({force:!0});Object(Ga.f)({queueType:e,source:"call",taskType:Object(ka.g)(l,xa.y)});Object(Aa.b)(parseInt(n,10),Object(s.fromJS)({[xa.w]:{name:xa.w,value:Ra.a}}),Object(s.Map)({objectType:o,objectId:a,taskId:parseInt(n,10)}));Object(Oa.default)(!1)},[l,o,n,a]);Object(r.useEffect)(()=>{Object(Oa.default)(u)},[u]);return u?Object(i.jsx)(e,Object.assign({},c,{objectType:o,subjectId:a,handleCompleteTask:d,isQueueTask:!0})):Object(i.jsx)(e,Object.assign({},c,{objectType:o,subjectId:a}))}t.propTypes=Ha;class n extends Ma.a{constructor(e){super(e);this.handleUpdateCurrentPage=({subjectId:e,objectTypeId:t})=>{this.setState({subjectId:e,objectType:Yt.ObjectTypeFromIds[t],queueState:Da.d.getState({force:!0})})};this.getActiveTaskId=()=>{const{queueState:e}=this.state;return Ee()("currentTaskId",e)};this.state={subjectId:e.subjectId,objectType:e.objectType,queueState:Da.d.getState({force:!0})}}componentDidMount(){Object(U.a)("addEventListener",{event:H.PAGE_NAVIGATION,callback:this.handleUpdateCurrentPage})}componentWillUnmount(){Object(U.a)("removeEventListener",{event:H.PAGE_NAVIGATION,callback:this.handleUpdateCurrentPage})}render(){const{objectType:e,subjectId:n}=this.state,r=this.getActiveTaskId();return Object(i.jsx)(t,Object.assign({},this.props,{activeTaskId:r,objectType:e,subjectId:n}))}}n.propTypes=Ua;return n},za=n("Zdl3"),qa=n("ncUP"),Va=n("BXQ+"),Ka=n("hoUB"),Qa=n("zTpe"),Ya=n("wcGk"),Ja=n("R3K/"),$a=n("Q2XP"),Za=n("yTm7"),Xa=n("xgMe"),es=n("ARIx"),ts=n("ITmG");const ns=Object(ts.a)(),is=e=>ns.query(e);function rs({data:e,currentPageObjectTypeId:t,currentPageSubjectId:n}){return!(!e||!e.engagement)&&!!e.engagement.allAssociations.find(e=>{if(!e||!e.associationDefinition||!e.associatedObjects)return!1;if(e.associationDefinition.toObjectTypeId!==t)return!1;const{associatedObjects:i}=e;if(i.edges&&i.edges.length>0){return!!e.associatedObjects.edges.find(e=>e&&e.node&&""+e.node.id==""+n)}return!1})}var os=n("fw9B");const as=Object(Za.a)(Xa.a);function ss(e,t,n){return`${Object(Q.getFullUrl)("app")}${Ja.a.timelineEngagement(t,n,e)}`}const cs=(e,t,n)=>{n&&t&&as({objectType:n,subjectId:t}).then(r=>{const o=r?"calling.savedCallMessageWithName_jsx":"calling.savedCallMessage_jsx";Ct.a.addAlert({timeout:6e3,message:Object(i.jsx)(he.a,{options:{href:ss(e,n,t),subjectName:r},message:o,elements:{UILink:fe.a}}),type:"info"})}).catch(e=>{setTimeout(()=>{throw e})})},ls=({engagementId:e,callStartPageSubjectId:t,callStartPageObjectTypeId:n,currentPageObjectTypeId:i,currentPageSubjectId:r})=>is({query:$a.Q,variables:{engagementExists:!0,engagementObjectId:e,engagementObjectTypeId:"0-"+$a.N[u.CALL],isTicket:!1,subjectObjectId:t,subjectObjectTypeId:n}}).then(e=>rs({data:e.data,currentPageObjectTypeId:i,currentPageSubjectId:r}));function us({currentPageObjectTypeId:e,currentPageSubjectId:t,callStartPageObjectTypeId:n,callStartPageSubjectId:i,handleCompleteTask:o,isQueueTask:a,currentCallStatus:s}){const c=Object(r.useRef)(null);c.current=!1;const l=Object(r.useCallback)(r=>{const{engagementId:l,shouldCompleteTask:u}=r;c.current=!0;l&&ls({engagementId:l,callStartPageSubjectId:i,callStartPageObjectTypeId:n,currentPageObjectTypeId:e,currentPageSubjectId:t}).then(r=>{if(!0===c.current){r&&Object(os.e)(l);e===n&&t===i||cs(l,i,Yt.ObjectTypeFromIds[n])}a&&u&&o();c.current=!1}).catch(e=>{const t="Failed to check page associations for engagement";Object(Ye.a)({errorMessage:t,extraData:{error:e},tags:{errorMessage:e.message}})});s===R.READY&&Object(es.default)({subjectId:t,objectTypeId:e})},[n,i,s,e,t,o,a]),u=Object(r.useCallback)(r=>{r&&ls({engagementId:r,callStartPageSubjectId:i,callStartPageObjectTypeId:n,currentPageObjectTypeId:e,currentPageSubjectId:t}).then(e=>{e&&Object(os.e)(r)}).catch(o=>{const a="Failed to check page associations for follow up task";Object(Ye.a)({errorMessage:a,extraData:{error:o,engagementId:r,callStartPageSubjectId:i,callStartPageObjectTypeId:n,currentPageObjectTypeId:e,currentPageSubjectId:t},tags:{errorMessage:o.message}})})},[n,i,e,t]);return{shouldRenderCallSavedRef:c,handleEngagementSaved:l,handleFollowUpTaskSave:u}}var ds=n("STrd");n.d(t,"HoistedCallCommunicatorWrapper",(function(){return hs}));const ps=["/contact/:subjectId","/contacts/:subjectId","/deal/:subjectId","/deals/:subjectId","/ticket/:subjectId","/tickets/:subjectId","/company/:subjectId","/companies/:subjectId","/record/:objectTypeId/:subjectId"];function fs(e){const{pathname:t}=e;return Boolean(Object(Va.e)(t,{path:ps}))}const hs=({subjectId:e,objectType:t,objectTypeId:n,ownerId:o,activeInteraction:c,handleCompleteTask:l,isQueueTask:p,widgetState:f})=>{const h=(()=>(c||"").toLowerCase()!==u.CALL.toLowerCase())(),[m,g]=Object(r.useState)(!1),[v,_]=Object(r.useState)(Object(s.Map)({objectTypeId:n,subjectId:e})),[b,y]=Object(r.useState)(Object(s.Map)({objectTypeId:n,subjectId:e})),[S,E]=Object(r.useState)(null),[T,w]=Object(r.useState)(h),C=Object(r.useMemo)(()=>a()(["callStatus"],f),[f]),I=Object(r.useRef)(C),O=Object(s.Map)(za.a.get()),j=Object(Na.useStoreDependency)(ds.f),D=Object(r.useMemo)(()=>a()(["objectTypeId"],v),[v]),A=Object(r.useMemo)(()=>a()(["subjectId"],v),[v]),P=Object(r.useMemo)(()=>a()(["objectTypeId"],b),[b]),R=Object(r.useMemo)(()=>a()(["subjectId"],b),[b]),{shouldRenderCallSavedRef:k,handleEngagementSaved:x,handleFollowUpTaskSave:L}=us({currentPageObjectTypeId:D,currentPageSubjectId:A,callStartPageObjectTypeId:P,callStartPageSubjectId:R,handleCompleteTask:l,isQueueTask:p,currentCallStatus:C}),M=Object(r.useCallback)(e=>{if(Object(Ya.a)(C)&&!m){e.preventDefault();e.returnValue=""}},[C,m]),N=Object(r.useCallback)(({subjectId:e,objectTypeId:t})=>{_(Object(s.Map)({subjectId:e,objectTypeId:t}));k.current=!1},[k]);Object(r.useEffect)(()=>{Object(U.a)("addEventListener",{event:H.PAGE_NAVIGATION,callback:N});window.addEventListener("beforeunload",M);return()=>{Object(U.a)("removeEventListener",{event:H.PAGE_NAVIGATION,callback:N});window.removeEventListener("beforeunload",M)}},[M,N]);Object(r.useEffect)(()=>{I.current=C},[C]);const G=e=>{const t=fs(e),n=Object(Ya.a)(I.current);if(!t&&n){g(!0);E(e);return!1}t||Object(Ka.default)();return null},F=Object(r.useRef)(null);F.current||(F.current=qa.a.block(e=>G(e)));const W=Object(r.useCallback)(()=>{y(v)},[v]),B=e=>{w(e)},z=()=>{Object(Ka.default)();F.current();qa.a.push(S)},q=()=>{g(!1);E(null)};return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(ba,{appName:"callCommunicator",isWidgetHidden:T,onSetIsWidgetHidden:B,children:Object(i.jsx)(Ia,{gates:j,eventLogger:d,subjectId:e,objectType:t,objectTypeId:n,ownerId:o,onCreatedFollowUpTask:L,onCallSaved:x,onCallStarted:W,defaultHidden:h,appIdentifier:"profile",scopes:O,isQueueTask:p})}),m&&Object(i.jsx)(Qa.a,{handleConfirm:z,handleReject:q,isQueueTask:p})]})};hs.propTypes={subjectId:m.a.string,objectType:m.a.string,objectTypeId:m.a.string,ownerId:m.a.number,activeInteraction:m.a.string,handleCompleteTask:m.a.func,isQueueTask:m.a.bool,widgetState:l.a.map.isRequired};hs.defaultProps={isQueueTask:!1};t.default=Ba(Object(sa.a)(hs))},LMWw:function(e,t,n){(function(i){var r,o,a,s;"undefined"!=typeof window&&window,s=function(){function e(t,n,i){function o(s,c){if(!n[s]){if(!t[s]){if(!c&&"function"==typeof r&&r)return r(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[s]={exports:{}};t[s][0].call(u.exports,(function(e){return o(t[s][1][e]||e)}),u,u.exports,e,t,n,i)}return n[s].exports}for(var a="function"==typeof r&&r,s=0;s<i.length;s++)o(i[s]);return o}return e}()({1:[function(e,t,n){"use strict";t.exports=WebSocket},{}],2:[function(e,t,n){"use strict";t.exports={XMLHttpRequest:XMLHttpRequest}},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("events"),r=e("./twilio/connection");n.Connection=r.default;var o=e("./twilio/device");n.Device=o.default;var a,s=e("./twilio/pstream");n.PStream=s;Object.defineProperty(o.default,"instance",{get:function(){return a},set:function(e){null===e&&(a=null)}});o.default.destroy=function(){a&&a.destroy();c()};function c(){a=new o.default;Object.getOwnPropertyNames(o.default.prototype).concat(Object.getOwnPropertyNames(i.EventEmitter.prototype)).filter((function(e){return"function"==typeof o.default.prototype[e]})).filter((function(e){return"destroy"!==e})).forEach((function(e){o.default[e]=o.default.prototype[e].bind(a)}))}c();Object.getOwnPropertyNames(a).filter((function(e){return"function"!=typeof o.default.prototype[e]})).forEach((function(e){Object.defineProperty(o.default,e,{get:function(){if(a)return a[e]},set:function(t){a&&(a[e]=t)}})}))},{"./twilio/connection":6,"./twilio/device":9,"./twilio/pstream":16,events:46}],4:[function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):r(e.value).then(a,s)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return c([e,t])}}function c(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;(i=0,r)&&(o=[2&o[0],r.value]);switch(o[0]){case 0:case 1:r=o;break;case 4:a.label++;return{value:o[1],done:!1};case 5:a.label++;i=o[1];o=[0];continue;case 7:o=a.ops.pop();a.trys.pop();continue;default:if(!(r=a.trys,r=r.length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1];r=o;break}if(r&&a.label<r[2]){a.label=r[2];a.ops.push(o);break}r[2]&&a.ops.pop();a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e];i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./deferred"),a=function(){function e(){this._operations=[]}e.prototype.enqueue=function(e){var t=!!this._operations.length,n=new o.default;this._operations.push({deferred:n,callback:e});t||this._processQueue();return n.promise};e.prototype._processQueue=function(){return i(this,void 0,void 0,(function(){var e,t,n,i,o,a,s;return r(this,(function(r){switch(r.label){case 0:if(!this._operations.length)return[3,5];e=this._operations[0],t=e.deferred,n=e.callback;i=void 0;o=void 0;a=void 0;r.label=1;case 1:r.trys.push([1,3,,4]);return[4,n()];case 2:i=r.sent();a=!0;return[3,4];case 3:s=r.sent();o=s;return[3,4];case 4:this._operations.shift();a?t.resolve(i):t.reject(o);return[3,0];case 5:return[2]}}))}))};return e}();n.AsyncQueue=a},{"./deferred":8}],5:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){i(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("events"),a=e("./errors"),s=e("./log"),c=e("./outputdevicecollection"),l=e("./shims/mediadevices"),u=e("./util"),d=e("./shims/mediadeviceinfo"),p={audioinput:"Audio Input",audiooutput:"Audio Output"},f=function(e){r(t,e);function t(t,n,i,r){var o=e.call(this)||this;o.availableInputDevices=new Map;o.availableOutputDevices=new Map;o._audioConstraints=null;o._inputDevice=null;o._inputStream=null;o._isPollingInputVolume=!1;o._log=s.default.getInstance();o._unknownDeviceIndexes={audioinput:{},audiooutput:{}};o._removeLostInput=function(e){if(!o.inputDevice||o.inputDevice.deviceId!==e.deviceId)return!1;o._replaceStream(null);o._inputDevice=null;o._maybeStopPollingVolume();var t=o.availableInputDevices.get("default")||Array.from(o.availableInputDevices.values())[0];t&&o.setInputDevice(t.deviceId);return!0};o._removeLostOutput=function(e){var t=o.speakerDevices.delete(e),n=o.ringtoneDevices.delete(e);return t||n};o._updateAvailableDevices=function(){return o._mediaDevices?o._mediaDevices.enumerateDevices().then((function(e){o._updateDevices(e.filter((function(e){return"audiooutput"===e.kind})),o.availableOutputDevices,o._removeLostOutput);o._updateDevices(e.filter((function(e){return"audioinput"===e.kind})),o.availableInputDevices,o._removeLostInput);var t=o.availableOutputDevices.get("default")||Array.from(o.availableOutputDevices.values())[0];[o.speakerDevices,o.ringtoneDevices].forEach((function(e){!e.get().size&&o.availableOutputDevices.size&&o.isOutputSelectionSupported&&e.set(t.deviceId).catch((function(e){o._log.warn("Unable to set audio output devices. "+e)}))}))})):Promise.reject("Enumeration not supported")};r=Object.assign({AudioContext:"undefined"!=typeof AudioContext&&AudioContext,setSinkId:"undefined"!=typeof HTMLAudioElement&&HTMLAudioElement.prototype.setSinkId},r);o._getUserMedia=i;o._mediaDevices=r.mediaDevices||l;o._onActiveInputChanged=n;var a=!(!r.AudioContext&&!r.audioContext),u=!(!o._mediaDevices||!o._mediaDevices.enumerateDevices),d="function"==typeof r.setSinkId;o.isOutputSelectionSupported=u&&d;o.isVolumeSupported=a;r.enabledSounds&&o._addEnabledSounds(r.enabledSounds);if(o.isVolumeSupported){o._audioContext=r.audioContext||r.AudioContext&&new r.AudioContext;if(o._audioContext){o._inputVolumeAnalyser=o._audioContext.createAnalyser();o._inputVolumeAnalyser.fftSize=32;o._inputVolumeAnalyser.smoothingTimeConstant=.3}}o.ringtoneDevices=new c.default("ringtone",o.availableOutputDevices,t,o.isOutputSelectionSupported);o.speakerDevices=new c.default("speaker",o.availableOutputDevices,t,o.isOutputSelectionSupported);o.addListener("newListener",(function(e){"inputVolume"===e&&o._maybeStartPollingVolume()}));o.addListener("removeListener",(function(e){"inputVolume"===e&&o._maybeStopPollingVolume()}));o.once("newListener",(function(){o.isOutputSelectionSupported||o._log.warn("Warning: This browser does not support audio output selection.");o.isVolumeSupported||o._log.warn("Warning: This browser does not support Twilio's volume indicator feature.")}));u&&o._initializeEnumeration();return o}Object.defineProperty(t.prototype,"audioConstraints",{get:function(){return this._audioConstraints},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"inputDevice",{get:function(){return this._inputDevice},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"inputStream",{get:function(){return this._inputStream},enumerable:!0,configurable:!0});t.prototype._maybeStartPollingVolume=function(){var e=this;if(this.isVolumeSupported&&this._inputStream){this._updateVolumeSource();if(!this._isPollingInputVolume&&this._inputVolumeAnalyser){var t=this._inputVolumeAnalyser.frequencyBinCount,n=new Uint8Array(t);this._isPollingInputVolume=!0;var i=function(){if(e._isPollingInputVolume){if(e._inputVolumeAnalyser){e._inputVolumeAnalyser.getByteFrequencyData(n);var t=u.average(n);e.emit("inputVolume",t/255)}requestAnimationFrame(i)}};requestAnimationFrame(i)}}};t.prototype._maybeStopPollingVolume=function(){if(this.isVolumeSupported&&!(!this._isPollingInputVolume||this._inputStream&&this.listenerCount("inputVolume"))){if(this._inputVolumeSource){this._inputVolumeSource.disconnect();delete this._inputVolumeSource}this._isPollingInputVolume=!1}};t.prototype._unbind=function(){if(!this._mediaDevices)throw new a.NotSupportedError("Enumeration is not supported");if(this._mediaDevices.removeEventListener){this._mediaDevices.removeEventListener("devicechange",this._updateAvailableDevices);this._mediaDevices.removeEventListener("deviceinfochange",this._updateAvailableDevices)}};t.prototype.setAudioConstraints=function(e){this._audioConstraints=Object.assign({},e);delete this._audioConstraints.deviceId;return this.inputDevice?this._setInputDevice(this.inputDevice.deviceId,!0):Promise.resolve()};t.prototype.setInputDevice=function(e){return u.isFirefox()?Promise.reject(new a.NotSupportedError("Firefox does not currently support opening multiple audio input tracks simultaneously, even across different tabs. As a result, Device.audio.setInputDevice is disabled on Firefox until support is added.\nRelated BugZilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324")):this._setInputDevice(e,!1)};t.prototype.unsetAudioConstraints=function(){this._audioConstraints=null;return this.inputDevice?this._setInputDevice(this.inputDevice.deviceId,!0):Promise.resolve()};t.prototype.unsetInputDevice=function(){var e=this;return this.inputDevice?this._onActiveInputChanged(null).then((function(){e._replaceStream(null);e._inputDevice=null;e._maybeStopPollingVolume()})):Promise.resolve()};t.prototype._addEnabledSounds=function(e){var t=this;function n(t,n){void 0!==n&&(e[t]=n);return e[t]}Object.keys(e).forEach((function(e){t[e]=n.bind(null,e)}))};t.prototype._getUnknownDeviceIndex=function(e){var t=e.deviceId,n=e.kind,i=this._unknownDeviceIndexes[n][t];if(!i){i=Object.keys(this._unknownDeviceIndexes[n]).length+1;this._unknownDeviceIndexes[n][t]=i}return i};t.prototype._initializeEnumeration=function(){var e=this;if(!this._mediaDevices)throw new a.NotSupportedError("Enumeration is not supported");if(this._mediaDevices.addEventListener){this._mediaDevices.addEventListener("devicechange",this._updateAvailableDevices);this._mediaDevices.addEventListener("deviceinfochange",this._updateAvailableDevices)}this._updateAvailableDevices().then((function(){e.isOutputSelectionSupported&&Promise.all([e.speakerDevices.set("default"),e.ringtoneDevices.set("default")]).catch((function(t){e._log.warn("Warning: Unable to set audio output devices. "+t)}))}))};t.prototype._replaceStream=function(e){this._inputStream&&this._inputStream.getTracks().forEach((function(e){e.stop()}));this._inputStream=e};t.prototype._setInputDevice=function(e,t){var n=this;if("string"!=typeof e)return Promise.reject(new a.InvalidArgumentError("Must specify the device to set"));var i=this.availableInputDevices.get(e);if(!i)return Promise.reject(new a.InvalidArgumentError("Device not found: "+e));if(this._inputDevice&&this._inputDevice.deviceId===e&&this._inputStream){if(!t)return Promise.resolve();this._inputStream.getTracks().forEach((function(e){e.stop()}))}var r={audio:Object.assign({deviceId:{exact:e}},this.audioConstraints)};return this._getUserMedia(r).then((function(e){return n._onActiveInputChanged(e).then((function(){n._replaceStream(e);n._inputDevice=i;n._maybeStartPollingVolume()}))}))};t.prototype._updateDevices=function(e,t,n){var i=this,r=e.map((function(e){return e.deviceId})),o=Array.from(t.values()).map((function(e){return e.deviceId})),a=[],s=u.difference(o,r);s.forEach((function(e){var i=t.get(e);if(i){t.delete(e);n(i)&&a.push(i)}}));var c=!1;e.forEach((function(e){var n=t.get(e.deviceId),r=i._wrapMediaDeviceInfo(e);if(!n||n.label!==r.label){t.set(e.deviceId,r);c=!0}}));if(c||s.length){if(null!==this.inputDevice&&"default"===this.inputDevice.deviceId){this._log.warn("Calling getUserMedia after device change to ensure that the           tracks of the active device (default) have not gone stale.");this._setInputDevice(this.inputDevice.deviceId,!0)}this.emit("deviceChange",a)}};t.prototype._updateVolumeSource=function(){if(this._inputStream&&this._audioContext&&this._inputVolumeAnalyser){this._inputVolumeSource&&this._inputVolumeSource.disconnect();this._inputVolumeSource=this._audioContext.createMediaStreamSource(this._inputStream);this._inputVolumeSource.connect(this._inputVolumeAnalyser)}};t.prototype._wrapMediaDeviceInfo=function(e){var t={deviceId:e.deviceId,groupId:e.groupId,kind:e.kind,label:e.label};if(!t.label)if("default"===t.deviceId)t.label="Default";else{var n=this._getUnknownDeviceIndex(e);t.label="Unknown "+p[t.kind]+" Device "+n}return new d(t)};return t}(o.EventEmitter);f||(f={});n.default=f},{"./errors":12,"./log":14,"./outputdevicecollection":15,"./shims/mediadeviceinfo":29,"./shims/mediadevices":30,"./util":33,events:46}],6:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){i(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)};Object.defineProperty(n,"__esModule",{value:!0});var a=e("events"),s=e("./device"),c=e("./errors"),l=e("./log"),u=e("./rtc/icecandidate"),d=e("./statsMonitor"),p=e("./util"),f=e("backoff"),h=e("./constants"),m=e("./rtc").PeerConnection,g=e("./rtc/sdp").getPreferredCodecInfo,v={factor:1.1,initialDelay:1,maxDelay:3e4,randomisationFactor:.5},_=70,b=500,y=160,S=10,E=5e3,T={disconnect:!0,info:{code:31003,message:"Connection with Twilio was interrupted.",twilioError:new c.MediaErrors.ConnectionError}},w={audioInputLevel:"audio-input-level",audioOutputLevel:"audio-output-level",bytesReceived:"bytes-received",bytesSent:"bytes-sent",jitter:"jitter",mos:"mos",packetsLostFraction:"packet-loss",rtt:"rtt"},C={max:"high-",maxDuration:"constant-",min:"low-"},I=!1,O=function(e){r(t,e);function t(n,i){var r=e.call(this)||this;r.parameters={};r._inputVolumeStreak=0;r._isAnswered=!1;r._isCancelled=!1;r._latestInputVolume=0;r._latestOutputVolume=0;r._log=l.default.getInstance();r._metricsSamples=[];r._outputVolumeStreak=0;r._soundcache=new Map;r._status=t.State.Pending;r.options={enableRingingState:!1,mediaStreamFactory:m,offerSdp:null,shouldPlayDisconnect:function(){return!0}};r.sendHangup=!0;r.toString=function(){return"[Twilio.Connection instance]"};r._emitWarning=function(e,t,n,i,o){var a=e+"warning"+(o?"-cleared":"-raised");if("constant-audio-input-level"!==t||!r.isMuted()){var s=o?"info":"warning";"constant-audio-output-level"===t&&(s="info");var c={threshold:n};i&&(i instanceof Array?c.values=i.map((function(e){return"number"==typeof e?Math.round(100*e)/100:i})):c.value=i);r._publisher.post(s,a,t,{data:c},r);if("constant-audio-output-level"!==t){var l=o?"warning-cleared":"warning";r.emit(l,t)}}};r._onAnswer=function(e){if(!r._isAnswered){r._setCallSid(e);r._isAnswered=!0;r._maybeTransitionToOpen()}};r._onCancel=function(e){var n=e.callsid;if(r.parameters.CallSid===n){r._isCancelled=!0;r._publisher.info("connection","cancel",null,r);r._cleanupEventListeners();r.mediaStream.close();r._status=t.State.Closed;r.emit("cancel");r.pstream.removeListener("cancel",r._onCancel)}};r._onHangup=function(e){if(e.callsid&&(r.parameters.CallSid||r.outboundConnectionId)){if(e.callsid!==r.parameters.CallSid&&e.callsid!==r.outboundConnectionId)return}else if(e.callsid)return;r._log.info("Received HANGUP from gateway");if(e.error){var t={code:e.error.code||31e3,connection:r,message:e.error.message||"Error sent from gateway in HANGUP",twilioError:new c.GeneralErrors.ConnectionError};r._log.error("Received an error from the gateway:",t);r.emit("error",t)}r.sendHangup=!1;r._publisher.info("connection","disconnected-by-remote",null,r);r._disconnect(null,!0);r._cleanupEventListeners()};r._onMediaFailure=function(e){var n=t.MediaFailure,i=n.ConnectionDisconnected,o=n.ConnectionFailed,a=n.IceGatheringFailed,s=n.LowBytes,l=e===o||e===a;if(!r.options.enableIceRestart&&l||!p.isChrome(window,window.navigator)&&e===o)return r.mediaStream.onerror(T);if(r.options.enableIceRestart)if(r._status!==t.State.Reconnecting){var u=r.mediaStream.version.pc,d=u&&"disconnected"===u.iceConnectionState,f=r._monitor.hasActiveWarning("bytesSent","min")||r._monitor.hasActiveWarning("bytesReceived","min");if(e===s&&d||e===i&&f||l){var h={code:53405,message:"Media connection failed.",twilioError:new c.MediaErrors.ConnectionError};r._log.warn("ICE Connection disconnected.");r._publisher.warn("connection","error",h,r);r._publisher.info("connection","reconnecting",null,r);r._mediaReconnectStartTime=Date.now();r._status=t.State.Reconnecting;r._mediaReconnectBackoff.reset();r._mediaReconnectBackoff.backoff();r.emit("reconnecting",h)}}else if(l){if(Date.now()-r._mediaReconnectStartTime>v.maxDelay){r._log.info("Exceeded max ICE retries");return r.mediaStream.onerror(T)}r._mediaReconnectBackoff.backoff()}};r._onMediaReconnected=function(){if(r._status===t.State.Reconnecting){r._log.info("ICE Connection reestablished.");r._publisher.info("connection","reconnected",null,r);r._status=t.State.Open;r.emit("reconnected")}};r._onRinging=function(e){r._setCallSid(e);if(r._status===t.State.Connecting||r._status===t.State.Ringing){var n=!!e.sdp;if(r.options.enableRingingState){r._status=t.State.Ringing;r._publisher.info("connection","outgoing-ringing",{hasEarlyMedia:n},r);r.emit("ringing",n)}else n&&r._onAnswer(e)}};r._onRTCSample=function(e){var t=o(o({},e),{inputVolume:r._latestInputVolume,outputVolume:r._latestOutputVolume});r._codec=t.codecName;r._metricsSamples.push(t);r._metricsSamples.length>=S&&r._publishMetrics();r.emit("sample",e)};r._onTransportClose=function(){r._log.error("Received transportClose from pstream");r.emit("transportClose")};r._reemitWarning=function(e,t){var n=/^audio/.test(e.name)?"audio-level-":"network-quality-",i=C[e.threshold.name]+w[e.name];r._emitWarning(n,i,e.threshold.value,e.values||e.value,t)};r._reemitWarningCleared=function(e){r._reemitWarning(e,!0)};r._isUnifiedPlanDefault=n.isUnifiedPlanDefault;r._soundcache=n.soundcache;r.message=i&&i.twimlParams||{};r.customParameters=new Map(Object.entries(r.message).map((function(e){var t=e[0],n=e[1];return[t,String(n)]})));Object.assign(r.options,i);r.options.callParameters&&(r.parameters=r.options.callParameters);r._direction=r.parameters.CallSid?t.CallDirection.Incoming:t.CallDirection.Outgoing;r._direction===t.CallDirection.Incoming&&r.parameters?r.callerInfo=r.parameters.StirStatus?{isVerified:"TN-Validation-Passed-A"===r.parameters.StirStatus}:null:r.callerInfo=null;r._mediaReconnectBackoff=f.exponential(v);r._mediaReconnectBackoff.on("ready",(function(){return r.mediaStream.iceRestart()}));var a=r._publisher=n.publisher;r._direction===t.CallDirection.Incoming&&a.info("connection","incoming",null,r);var h=r._monitor=new(r.options.StatsMonitor||d.default);h.on("sample",r._onRTCSample);h.disableWarnings();setTimeout((function(){return h.enableWarnings()}),E);h.on("warning",(function(e,n){"bytesSent"!==e.name&&"bytesReceived"!==e.name||r._onMediaFailure(t.MediaFailure.LowBytes);r._reemitWarning(e,n)}));h.on("warning-cleared",(function(e){r._reemitWarningCleared(e)}));r.mediaStream=new(r.options.MediaStream||r.options.mediaStreamFactory)(n.audioHelper,n.pstream,n.getUserMedia,{codecPreferences:r.options.codecPreferences,dscp:r.options.dscp,enableIceRestart:r.options.enableIceRestart,forceAggressiveIceNomination:r.options.forceAggressiveIceNomination,isUnifiedPlan:r._isUnifiedPlanDefault,maxAverageBitrate:r.options.maxAverageBitrate});r.on("volume",(function(e,t){r._inputVolumeStreak=r._checkVolume(e,r._inputVolumeStreak,r._latestInputVolume,"input");r._outputVolumeStreak=r._checkVolume(t,r._outputVolumeStreak,r._latestOutputVolume,"output");r._latestInputVolume=e;r._latestOutputVolume=t}));r.mediaStream.onvolume=function(e,t,n,i){h.addVolumes(n/255*32767,i/255*32767);r.emit("volume",e,t)};r.mediaStream.ondtlstransportstatechange=function(e){var t="failed"===e?"error":"debug";r._publisher.post(t,"dtls-transport-state",e,null,r)};r.mediaStream.onpcconnectionstatechange=function(e){var t="debug",n=r.mediaStream.getRTCDtlsTransport();"failed"===e&&(t=n&&"failed"===n.state?"error":"warning");r._publisher.post(t,"pc-connection-state",e,null,r)};r.mediaStream.onicecandidate=function(e){var t=new u.IceCandidate(e).toPayload();r._publisher.debug("ice-candidate","ice-candidate",t,r)};r.mediaStream.onselectedcandidatepairchange=function(e){var t=new u.IceCandidate(e.local).toPayload(),n=new u.IceCandidate(e.remote,!0).toPayload();r._publisher.debug("ice-candidate","selected-ice-candidate-pair",{local_candidate:t,remote_candidate:n},r)};r.mediaStream.oniceconnectionstatechange=function(e){var t="failed"===e?"error":"debug";r._publisher.post(t,"ice-connection-state",e,null,r)};r.mediaStream.onicegatheringfailure=function(e){r._publisher.warn("ice-gathering-state",e,null,r);r._onMediaFailure(t.MediaFailure.IceGatheringFailed)};r.mediaStream.onicegatheringstatechange=function(e){r._publisher.debug("ice-gathering-state",e,null,r)};r.mediaStream.onsignalingstatechange=function(e){r._publisher.debug("signaling-state",e,null,r)};r.mediaStream.ondisconnected=function(e){r._log.info(e);r._publisher.warn("network-quality-warning-raised","ice-connectivity-lost",{message:e},r);r.emit("warning","ice-connectivity-lost");r._onMediaFailure(t.MediaFailure.ConnectionDisconnected)};r.mediaStream.onfailed=function(e){r._onMediaFailure(t.MediaFailure.ConnectionFailed)};r.mediaStream.onconnected=function(){r._status===t.State.Reconnecting&&r._onMediaReconnected()};r.mediaStream.onreconnected=function(e){r._log.info(e);r._publisher.info("network-quality-warning-cleared","ice-connectivity-lost",{message:e},r);r.emit("warning-cleared","ice-connectivity-lost");r._onMediaReconnected()};r.mediaStream.onerror=function(e){!0===e.disconnect&&r._disconnect(e.info&&e.info.message);var t={code:e.info.code,connection:r,info:e.info,message:e.info.message||"Error with mediastream",twilioError:e.info.twilioError};r._log.error("Received an error from MediaStream:",e);r.emit("error",t)};r.mediaStream.onopen=function(){if(r._status!==t.State.Open&&r._status!==t.State.Reconnecting)if(r._status===t.State.Ringing||r._status===t.State.Connecting){r.mute(!1);r._maybeTransitionToOpen()}else r.mediaStream.close()};r.mediaStream.onclose=function(){r._status=t.State.Closed;r.options.shouldPlayDisconnect&&r.options.shouldPlayDisconnect()&&r._soundcache.get(s.default.SoundName.Disconnect).play();h.disable();r._publishMetrics();r._isCancelled||r.emit("disconnect",r)};r.outboundConnectionId=j();r.pstream=n.pstream;r.pstream.on("cancel",r._onCancel);r.pstream.on("ringing",r._onRinging);r.pstream.on("transportClose",r._onTransportClose);r.on("error",(function(e){r._publisher.error("connection","error",{code:e.code,message:e.message},r);r.pstream&&"disconnected"===r.pstream.status&&r._cleanupEventListeners()}));r.on("disconnect",(function(){r._cleanupEventListeners()}));return r}Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"codec",{get:function(){return this._codec},enumerable:!0,configurable:!0});t.prototype._getRealCallSid=function(){this._log.warn("_getRealCallSid is deprecated and will be removed in 2.0.");return/^TJ/.test(this.parameters.CallSid)?null:this.parameters.CallSid};t.prototype._getTempCallSid=function(){this._log.warn("_getTempCallSid is deprecated and will be removed in 2.0.                     Please use outboundConnectionId instead.");return this.outboundConnectionId};t.prototype._setInputTracksFromStream=function(e){return this.mediaStream.setInputTracksFromStream(e)};t.prototype._setSinkIds=function(e){return this.mediaStream._setSinkIds(e)};t.prototype.accept=function(e){var n=this;if("function"!=typeof e){if(this._status===t.State.Pending){var i=e||this.options.audioConstraints;this._status=t.State.Connecting;var r=function(){if(n._status===t.State.Connecting){var e=function(e){var i=n._direction===t.CallDirection.Incoming?"accepted-by-local":"accepted-by-remote";n._publisher.info("connection",i,null,n);var r=g(n.mediaStream.version.getSDP()),o=r.codecName,a=r.codecParams;n._publisher.info("settings","codec",{codec_params:a,selected_codec:o},n);n._monitor.enable(e)},i="function"==typeof n.options.getSinkIds&&n.options.getSinkIds();Array.isArray(i)&&n.mediaStream._setSinkIds(i).catch((function(){}));n.pstream.addListener("hangup",n._onHangup);if(n._direction===t.CallDirection.Incoming){n._isAnswered=!0;n.mediaStream.answerIncomingCall(n.parameters.CallSid,n.options.offerSdp,n.options.rtcConstraints,n.options.rtcConfiguration,e)}else{var r=Array.from(n.customParameters.entries()).map((function(e){return encodeURIComponent(e[0])+"="+encodeURIComponent(e[1])})).join("&");n.pstream.once("answer",n._onAnswer.bind(n));n.mediaStream.makeOutgoingCall(n.pstream.token,r,n.outboundConnectionId,n.options.rtcConstraints,n.options.rtcConfiguration,e)}}else{n._cleanupEventListeners();n.mediaStream.close()}};this.options.beforeAccept&&this.options.beforeAccept(this);var o="function"==typeof this.options.getInputStream&&this.options.getInputStream();(o?this.mediaStream.setInputTracksFromStream(o):this.mediaStream.openWithConstraints(i)).then((function(){n._publisher.info("get-user-media","succeeded",{data:{audioConstraints:i}},n);r()}),(function(e){var t,r;if(31208===e.code||-1!==["PermissionDeniedError","NotAllowedError"].indexOf(e.name)){r=31208;t="User denied access to microphone, or the web browser did not allow microphone access at this address.";n._publisher.error("get-user-media","denied",{data:{audioConstraints:i,error:e}},n)}else{r=31201;t="Error occurred while accessing microphone: "+e.name+(e.message?" ("+e.message+")":"");n._publisher.error("get-user-media","failed",{data:{audioConstraints:i,error:e}},n)}n._disconnect();n.emit("error",{message:t,code:r})}))}}else this._addHandler("accept",e)};t.prototype.cancel=function(e){this._log.warn(".cancel() is deprecated. Please use .ignore() instead.");e?this.ignore(e):this.ignore()};t.prototype.disconnect=function(e){"function"!=typeof e?this._disconnect():this._addHandler("disconnect",e)};t.prototype.error=function(e){"function"==typeof e&&this._addHandler("error",e)};t.prototype.getLocalStream=function(){return this.mediaStream&&this.mediaStream.stream};t.prototype.getRemoteStream=function(){return this.mediaStream&&this.mediaStream._remoteStream};t.prototype.ignore=function(e){if("function"!=typeof e){if(this._status===t.State.Pending){this._status=t.State.Closed;this.emit("cancel");this.mediaStream.ignore(this.parameters.CallSid);this._publisher.info("connection","ignored-by-local",null,this)}}else this._addHandler("cancel",e)};t.prototype.isMuted=function(){return this.mediaStream.isMuted};t.prototype.mute=function(e){void 0===e&&(e=!0);if("function"!=typeof e){var t=this.mediaStream.isMuted;this.mediaStream.mute(e);var n=this.mediaStream.isMuted;if(t!==n){this._publisher.info("connection",n?"muted":"unmuted",null,this);this.emit("mute",n,this)}}else this._addHandler("mute",e)};t.prototype.postFeedback=function(e,n){if(null==e)return this._postFeedbackDeclined();if(!Object.values(t.FeedbackScore).includes(e))throw new c.InvalidArgumentError("Feedback score must be one of: "+Object.values(t.FeedbackScore));if(null!=n&&!Object.values(t.FeedbackIssue).includes(n))throw new c.InvalidArgumentError("Feedback issue must be one of: "+Object.values(t.FeedbackIssue));return this._publisher.info("feedback","received",{issue_name:n,quality_score:e},this,!0)};t.prototype.reject=function(e){if("function"!=typeof e){if(this._status===t.State.Pending){this.pstream.reject(this.parameters.CallSid);this._status=t.State.Closed;this.emit("reject");this.mediaStream.reject(this.parameters.CallSid);this._publisher.info("connection","rejected-by-local",null,this)}}else this._addHandler("reject",e)};t.prototype.sendDigits=function(e){if(e.match(/[^0-9*#w]/))throw new c.InvalidArgumentError("Illegal character passed into sendDigits");var t=[];e.split("").forEach((function(e){var n="w"!==e?"dtmf"+e:"";"dtmf*"===n&&(n="dtmfs");"dtmf#"===n&&(n="dtmfh");t.push(n)}));!function e(n,i){var r=t.shift();r&&(i?i.play(r):n.get(r).play());t.length&&setTimeout(e.bind(null,n),200)}(this._soundcache,this.options.dialtonePlayer);var n=this.mediaStream.getOrCreateDTMFSender();function i(e){if(e.length){var t=e.shift();t&&t.length&&n.insertDTMF(t,y,_);setTimeout(i.bind(null,e),b)}}if(n){if(!("canInsertDTMF"in n)||n.canInsertDTMF){this._log.info("Sending digits using RTCDTMFSender");i(e.split("w"));return}this._log.info("RTCDTMFSender cannot insert DTMF")}this._log.info("Sending digits over PStream");if(null!==this.pstream&&"disconnected"!==this.pstream.status)this.pstream.dtmf(this.parameters.CallSid,e);else{var r={code:31e3,connection:this,message:"Could not send DTMF: Signaling channel is disconnected"};this.emit("error",r)}};t.prototype.status=function(){return this._status};t.prototype.unmute=function(){this._log.warn(".unmute() is deprecated. Please use .mute(false) to unmute a call instead.");this.mute(!1)};t.prototype.volume=function(e){window&&(window.AudioContext||window.webkitAudioContext)||this._log.warn("This browser does not support Connection.volume");this._addHandler("volume",e)};t.prototype._addHandler=function(e,t){if(!I){this._log.warn("Connection callback handlers (accept, cancel, disconnect, error, ignore, mute, reject,\n        volume) have been deprecated and will be removed in the next breaking release. Instead, the EventEmitter         interface can be used to set event listeners. Example: connection.on('"+e+"', handler)");I=!0}this.addListener(e,t);return this};t.prototype._checkVolume=function(e,t,n,i){var r=t>=10,o=0;n===e&&(o=t);o>=10?this._emitWarning("audio-level-","constant-audio-"+i+"-level",10,o,!1):r&&this._emitWarning("audio-level-","constant-audio-"+i+"-level",10,o,!0);return o};t.prototype._cleanupEventListeners=function(){var e=this,t=function(){if(e.pstream){e.pstream.removeListener("answer",e._onAnswer);e.pstream.removeListener("cancel",e._onCancel);e.pstream.removeListener("hangup",e._onHangup);e.pstream.removeListener("ringing",e._onRinging);e.pstream.removeListener("transportClose",e._onTransportClose)}};t();setTimeout(t,0)};t.prototype._createMetricPayload=function(){var e={call_sid:this.parameters.CallSid,dscp:!!this.options.dscp,sdk_version:h.RELEASE_VERSION,selected_region:this.options.selectedRegion};this.options.gateway&&(e.gateway=this.options.gateway);this.options.region&&(e.region=this.options.region);e.direction=this._direction;return e};t.prototype._disconnect=function(e,n){e="string"==typeof e?e:null;if(this._status===t.State.Open||this._status===t.State.Connecting||this._status===t.State.Reconnecting||this._status===t.State.Ringing){this._log.info("Disconnecting...");if(null!==this.pstream&&"disconnected"!==this.pstream.status&&this.sendHangup){var i=this.parameters.CallSid||this.outboundConnectionId;i&&this.pstream.hangup(i,e)}this._cleanupEventListeners();this.mediaStream.close();n||this._publisher.info("connection","disconnected-by-local",null,this)}};t.prototype._maybeTransitionToOpen=function(){if(this.mediaStream&&"open"===this.mediaStream.status&&this._isAnswered){this._status=t.State.Open;this.emit("accept",this)}};t.prototype._postFeedbackDeclined=function(){return this._publisher.info("feedback","received-none",null,this,!0)};t.prototype._publishMetrics=function(){var e=this;0!==this._metricsSamples.length&&this._publisher.postMetrics("quality-metrics-samples","metrics-sample",this._metricsSamples.splice(0),this._createMetricPayload(),this).catch((function(t){e._log.warn("Unable to post metrics to Insights. Received error:",t)}))};t.prototype._setCallSid=function(e){var t=e.callsid;if(t){this.parameters.CallSid=t;this.mediaStream.callSid=t}};t.toString=function(){return"[Twilio.Connection class]"};return t}(a.EventEmitter);!function(e){!function(e){e.Closed="closed";e.Connecting="connecting";e.Open="open";e.Pending="pending";e.Reconnecting="reconnecting";e.Ringing="ringing"}(e.State||(e.State={}));!function(e){e.AudioLatency="audio-latency";e.ChoppyAudio="choppy-audio";e.DroppedCall="dropped-call";e.Echo="echo";e.NoisyCall="noisy-call";e.OneWayAudio="one-way-audio"}(e.FeedbackIssue||(e.FeedbackIssue={}));!function(e){e[e.One=1]="One";e[e.Two=2]="Two";e[e.Three=3]="Three";e[e.Four=4]="Four";e[e.Five=5]="Five"}(e.FeedbackScore||(e.FeedbackScore={}));!function(e){e.Incoming="INCOMING";e.Outgoing="OUTGOING"}(e.CallDirection||(e.CallDirection={}));!function(e){e.Opus="opus";e.PCMU="pcmu"}(e.Codec||(e.Codec={}));!function(e){e.None="none";e.Timeout="timeout"}(e.IceGatheringFailureReason||(e.IceGatheringFailureReason={}));!function(e){e.ConnectionDisconnected="ConnectionDisconnected";e.ConnectionFailed="ConnectionFailed";e.IceGatheringFailed="IceGatheringFailed";e.LowBytes="LowBytes"}(e.MediaFailure||(e.MediaFailure={}))}(O||(O={}));function j(){return"TJSxxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}n.default=O},{"./constants":7,"./device":9,"./errors":12,"./log":14,"./rtc":21,"./rtc/icecandidate":20,"./rtc/sdp":26,"./statsMonitor":32,"./util":33,backoff:40,events:46}],7:[function(e,t,n){var i="twilio-client",r="1.12.4";t.exports.SOUNDS_BASE_URL="https://sdk.twilio.com/js/client/sounds/releases/1.0.0";t.exports.PACKAGE_NAME=i;t.exports.RELEASE_VERSION=r;t.exports.USED_ERRORS=["AuthorizationErrors.AccessTokenExpired","AuthorizationErrors.AccessTokenInvalid","AuthorizationErrors.AuthenticationFailed","ClientErrors.BadRequest","GeneralErrors.ConnectionError","GeneralErrors.TransportError","GeneralErrors.UnknownError","MediaErrors.ClientLocalDescFailed","MediaErrors.ClientRemoteDescFailed","MediaErrors.ConnectionError","SignalingErrors.ConnectionDisconnected","SignalingErrors.ConnectionError"]},{}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(){var e=this;this._promise=new Promise((function(t,n){e._resolve=t;e._reject=n}))}Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0});e.prototype.reject=function(e){this._reject(e)};e.prototype.resolve=function(e){this._resolve(e)};return e}();n.default=i},{}],9:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){i(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i};Object.defineProperty(n,"__esModule",{value:!0});var s=e("events"),c=e("./audiohelper"),l=e("./connection"),u=e("./dialtonePlayer"),d=e("./errors"),p=e("./log"),f=e("./regions"),h=e("./util"),m=e("./constants"),g=e("./eventpublisher"),v=e("./pstream"),_=e("./rtc"),b=e("./rtc/getusermedia"),y=e("./sound"),S=3e4,E=2e3,T=!1,w=!1,C=function(e){r(t,e);function t(n,i){var r,a=e.call(this)||this;a.audio=null;a.connections=[];a.isInitialized=!1;a.sounds={};a.token=null;a._activeConnection=null;a._chunderURIs=[];a._connectionInputStream=null;a._connectionSinkIds=["default"];a._edge=null;a._enabledSounds=((r={})[t.SoundName.Disconnect]=!0,r[t.SoundName.Incoming]=!0,r[t.SoundName.Outgoing]=!0,r);a._log=p.default.getInstance();a._publisher=null;a._region=null;a._status=t.Status.Offline;a.mediaPresence={audio:!0};a.options={allowIncomingWhileBusy:!1,audioConstraints:!0,closeProtection:!1,codecPreferences:[l.default.Codec.PCMU,l.default.Codec.Opus],connectionFactory:l.default,debug:!1,dscp:!0,enableIceRestart:!1,eventgw:"eventgw.twilio.com",forceAggressiveIceNomination:!1,iceServers:[],noRegister:!1,pStreamFactory:v,rtcConstraints:{},soundFactory:y,sounds:{},warnings:!0};a.regTimer=null;a.soundcache=new Map;a.stream=null;a._confirmClose=function(e){if(!a._activeConnection)return"";var t=a.options.closeProtection||!1,n="string"!=typeof t?"A call is currently in-progress. Leaving or reloading this page will end the call.":t;(e||window.event).returnValue=n;return n};a._createDefaultPayload=function(e){var t={aggressive_nomination:a.options.forceAggressiveIceNomination,browser_extension:a._isBrowserExtension,dscp:!!a.options.dscp,ice_restart_enabled:a.options.enableIceRestart,platform:_.getMediaEngine(),sdk_version:m.RELEASE_VERSION};function n(e,n){n&&(t[e]=n)}if(e){var i=e.parameters.CallSid;n("call_sid",/^TJ/.test(i)?void 0:i);n("temp_call_sid",e.outboundConnectionId);n("audio_codec",e.codec);t.direction=e.direction}n("gateway",a.stream&&a.stream.gateway);n("selected_region",a.options.region);n("region",a.stream&&a.stream.region);return t};a._disconnectAll=function(){a.connections.splice(0).forEach((function(e){return e.disconnect()}));a._activeConnection&&a._activeConnection.disconnect()};a._onSignalingClose=function(){a.stream=null};a._onSignalingConnected=function(e){var t=f.getRegionShortcode(e.region);a._edge=f.regionToEdge[t]||e.region;a._region=t||e.region;a._sendPresence()};a._onSignalingError=function(e){if(e.error){var t=o({},e.error),n=e.callsid;n&&(t.connection=a._findConnection(n));if(31201===t.code)t.twilioError=new d.AuthorizationErrors.AuthenticationFailed;else if(31204===t.code)t.twilioError=new d.AuthorizationErrors.AccessTokenInvalid;else if(31205===t.code){a._stopRegistrationTimer();t.twilioError=new d.AuthorizationErrors.AccessTokenExpired}else t.twilioError||(t.twilioError=new d.GeneralErrors.UnknownError);a._log.info("Received error: ",t);a.emit("error",t)}};a._onSignalingInvite=function(e){var n=!!a._activeConnection;if(!n||a.options.allowIncomingWhileBusy)if(e.callsid&&e.sdp){var i=e.parameters||{};i.CallSid=i.CallSid||e.callsid;var r=Object.assign({},h.queryToJson(i.Params)),o=a._makeConnection(r,{callParameters:i,offerSdp:e.sdp});a.connections.push(o);o.once("accept",(function(){a.soundcache.get(t.SoundName.Incoming).stop();a._publishNetworkChange()}));var s=a._enabledSounds.incoming&&!n?function(){return a.soundcache.get(t.SoundName.Incoming).play()}:function(){return Promise.resolve()};a._showIncomingConnection(o,s)}else a.emit("error",{message:"Malformed invite from gateway",twilioError:new d.ClientErrors.BadRequest});else a._log.info("Device busy; ignoring incoming invite")};a._onSignalingOffline=function(){a._log.info("Stream is offline");a._status=t.Status.Offline;a._edge=null;a._region=null;a.emit("offline",a)};a._onSignalingReady=function(){a._log.info("Stream is ready");a._status=t.Status.Ready;a.emit("ready",a)};a._publishNetworkChange=function(){a._activeConnection&&a._networkInformation&&a._publisher.info("network-information","network-change",{connection_type:a._networkInformation.type,downlink:a._networkInformation.downlink,downlinkMax:a._networkInformation.downlinkMax,effective_type:a._networkInformation.effectiveType,rtt:a._networkInformation.rtt},a._activeConnection)};a._updateInputStream=function(e){var t=a._activeConnection;if(t&&!e)return Promise.reject(new d.InvalidStateError("Cannot unset input device while a call is in progress."));a._connectionInputStream=e;return t?t._setInputTracksFromStream(e):Promise.resolve()};a._updateSinkIds=function(e,t){return("ringtone"===e?a._updateRingtoneSinkIds(t):a._updateSpeakerSinkIds(t)).then((function(){a._publisher.info("audio",e+"-devices-set",{audio_device_ids:t},a._activeConnection)}),(function(n){a._publisher.error("audio",e+"-devices-set-failed",{audio_device_ids:t,message:n.message},a._activeConnection);throw n}))};if(window){var s=window,c=s.msBrowser||s.browser||s.chrome;a._isBrowserExtension=!!c&&!!c.runtime&&!!c.runtime.id||!!s.safari&&!!s.safari.extension}a._isBrowserExtension&&a._log.info("Running as browser extension.");if(navigator){var u=navigator;a._networkInformation=u.connection||u.mozConnection||u.webkitConnection}if(n)a.setup(n,i);else if(i)throw new d.InvalidArgumentError("Cannot construct a Device with options but without a token");return a}Object.defineProperty(t,"audioContext",{get:function(){return t._audioContext},enumerable:!0,configurable:!0});Object.defineProperty(t,"extension",{get:function(){var e,t,n="undefined"!=typeof document?document.createElement("audio"):{canPlayType:!1};try{e=n.canPlayType&&!!n.canPlayType("audio/mpeg").replace(/no/,"")}catch(t){e=!1}try{t=n.canPlayType&&!!n.canPlayType("audio/ogg;codecs='vorbis'").replace(/no/,"")}catch(e){t=!1}return t&&!e?"ogg":"mp3"},enumerable:!0,configurable:!0});Object.defineProperty(t,"isSupported",{get:function(){return _.enabled()},enumerable:!0,configurable:!0});Object.defineProperty(t,"packageName",{get:function(){return m.PACKAGE_NAME},enumerable:!0,configurable:!0});t.toString=function(){return"[Twilio.Device class]"};Object.defineProperty(t,"version",{get:function(){return m.RELEASE_VERSION},enumerable:!0,configurable:!0});t.prototype.activeConnection=function(){return this.isInitialized?this._activeConnection||this.connections[0]:null};t.prototype.cancel=function(e){return this._addHandler(t.EventName.Cancel,e)};t.prototype.connect=function(e,n){if("function"==typeof e){this._addHandler(t.EventName.Connect,e);return null}this._throwUnlessSetup("connect");if(this._activeConnection)throw new d.InvalidStateError("A Connection is already active");var i=e||{};n=n||this.options&&this.options.audioConstraints||{};var r=this._activeConnection=this._makeConnection(i);this.connections.splice(0).forEach((function(e){return e.ignore()}));this.soundcache.get(t.SoundName.Incoming).stop();r.accept(n);this._publishNetworkChange();return r};t.prototype.destroy=function(){this._disconnectAll();this._stopRegistrationTimer();this.audio&&this.audio._unbind();if(this.stream){this.stream.destroy();this.stream=null}this._networkInformation&&"function"==typeof this._networkInformation.removeEventListener&&this._networkInformation.removeEventListener("change",this._publishNetworkChange);if("undefined"!=typeof window&&window.removeEventListener){window.removeEventListener("beforeunload",this._confirmClose);window.removeEventListener("unload",this._disconnectAll)}};t.prototype.disconnect=function(e){return this._addHandler(t.EventName.Disconnect,e)};t.prototype.disconnectAll=function(){this._throwUnlessSetup("disconnectAll");this._disconnectAll()};Object.defineProperty(t.prototype,"edge",{get:function(){return this._edge},enumerable:!0,configurable:!0});t.prototype.error=function(e){return this._addHandler(t.EventName.Error,e)};t.prototype.incoming=function(e){return this._addHandler(t.EventName.Incoming,e)};t.prototype.offline=function(e){return this._addHandler(t.EventName.Offline,e)};t.prototype.ready=function(e){return this._addHandler(t.EventName.Ready,e)};t.prototype.region=function(){this._log.warn("`Device.region` is deprecated and will be removed in the next major release. Please use `Device.edge` instead.");this._throwUnlessSetup("region");return"string"==typeof this._region?this._region:"offline"};t.prototype.registerPresence=function(){this._throwUnlessSetup("registerPresence");this.mediaPresence.audio=!0;this._sendPresence();return this};t.prototype.removeListener=function(e,t){s.EventEmitter.prototype.removeListener.call(this,e,t);return this};t.prototype.setup=function(e,n){var i=this;void 0===n&&(n={});if(h.isLegacyEdge())throw new d.NotSupportedError("Microsoft Edge Legacy (https://support.microsoft.com/en-us/help/4533505/what-is-microsoft-edge-legacy) is deprecated and will not be able to connect to Twilio to make or receive calls after September 1st, 2020. Please see this documentation for a list of supported browsers https://www.twilio.com/docs/voice/client/javascript#supported-browsers");if(!t.isSupported&&!n.ignoreBrowserSupport){if(window&&window.location&&"http:"===window.location.protocol)throw new d.NotSupportedError("twilio.js wasn't able to find WebRTC browser support.           This is most likely because this page is served over http rather than https,           which does not support WebRTC in many browsers. Please load this page over https and           try again.");throw new d.NotSupportedError("twilio.js 1.3+ SDKs require WebRTC browser support.         For more information, see <https://www.twilio.com/docs/api/client/twilio-js>.         If you have any questions about this announcement, please contact         Twilio Support at <help@twilio.com>.")}if(!e)throw new d.InvalidArgumentError("Token is required for Device.setup()");Object.assign(this.options,n);this._log.setDefaultLevel(this.options.debug?p.default.levels.DEBUG:this.options.warnings?p.default.levels.WARN:p.default.levels.SILENT);this._chunderURIs=this.options.chunderw?["wss://"+this.options.chunderw+"/signal"]:f.getChunderURIs(this.options.edge,this.options.region,this._log.warn.bind(this._log)).map((function(e){return"wss://"+e+"/signal"}));void 0===t._isUnifiedPlanDefault&&(t._isUnifiedPlanDefault="undefined"!=typeof window&&"undefined"!=typeof RTCPeerConnection&&"undefined"!=typeof RTCRtpTransceiver&&h.isUnifiedPlanDefault(window,window.navigator,RTCPeerConnection,RTCRtpTransceiver));t._audioContext||("undefined"!=typeof AudioContext?t._audioContext=new AudioContext:"undefined"!=typeof webkitAudioContext&&(t._audioContext=new webkitAudioContext));if(t._audioContext&&n.fakeLocalDTMF)t._dialtonePlayer||(t._dialtonePlayer=new u.default(t._audioContext));else if(t._dialtonePlayer){t._dialtonePlayer.cleanup();delete t._dialtonePlayer}if(this.isInitialized){this._log.info("Found existing Device; using new token but ignoring options");this.updateToken(e);return this}this.isInitialized=!0;this.options.dscp&&(this.options.rtcConstraints.optional=[{googDscp:!0}]);var r=function(e,t){if(!w){i._log.warn("Device.sounds is deprecated and will be removed in the next breaking release. Please use the new functionality available on Device.audio.");w=!0}void 0!==t&&(i._enabledSounds[e]=t);return i._enabledSounds[e]};[t.SoundName.Disconnect,t.SoundName.Incoming,t.SoundName.Outgoing].forEach((function(e){i.sounds[e]=r.bind(null,e)}));for(var o={disconnect:{filename:"disconnect",maxDuration:3e3},dtmf0:{filename:"dtmf-0",maxDuration:1e3},dtmf1:{filename:"dtmf-1",maxDuration:1e3},dtmf2:{filename:"dtmf-2",maxDuration:1e3},dtmf3:{filename:"dtmf-3",maxDuration:1e3},dtmf4:{filename:"dtmf-4",maxDuration:1e3},dtmf5:{filename:"dtmf-5",maxDuration:1e3},dtmf6:{filename:"dtmf-6",maxDuration:1e3},dtmf7:{filename:"dtmf-7",maxDuration:1e3},dtmf8:{filename:"dtmf-8",maxDuration:1e3},dtmf9:{filename:"dtmf-9",maxDuration:1e3},dtmfh:{filename:"dtmf-hash",maxDuration:1e3},dtmfs:{filename:"dtmf-star",maxDuration:1e3},incoming:{filename:"incoming",shouldLoop:!0},outgoing:{filename:"outgoing",maxDuration:3e3}},a=0,s=Object.keys(o);a<s.length;a++){var l=s[a],v=o[l],_=m.SOUNDS_BASE_URL+"/"+v.filename+"."+t.extension+"?cache="+m.RELEASE_VERSION,y=this.options.sounds&&this.options.sounds[l]||_,S=new this.options.soundFactory(l,y,{audioContext:this.options.disableAudioContextSounds?null:t.audioContext,maxDuration:v.maxDuration,shouldLoop:v.shouldLoop});this.soundcache.set(l,S)}this._publisher=(this.options.Publisher||g)("twilio-js-sdk",e,{defaultPayload:this._createDefaultPayload,host:this.options.eventgw,metadata:{app_name:this.options.appName,app_version:this.options.appVersion}});!1===this.options.publishEvents&&this._publisher.disable();this._networkInformation&&"function"==typeof this._networkInformation.addEventListener&&this._networkInformation.addEventListener("change",this._publishNetworkChange);this.audio=new(this.options.AudioHelper||c.default)(this._updateSinkIds,this._updateInputStream,b,{audioContext:t.audioContext,enabledSounds:this._enabledSounds});this.audio.on("deviceChange",(function(e){var t=i._activeConnection,n=e.map((function(e){return e.deviceId}));i._publisher.info("audio","device-change",{lost_active_device_ids:n},t);t&&t.mediaStream._onInputDevicesChanged()}));this.mediaPresence.audio=!this.options.noRegister;this.updateToken(e);if("undefined"!=typeof window&&window.addEventListener){window.addEventListener("unload",this._disconnectAll);this.options.closeProtection&&window.addEventListener("beforeunload",this._confirmClose)}this.on(t.EventName.Error,(function(){i.listenerCount("error")>1||i._log.info("Uncaught error event suppressed.")}));return this};t.prototype.status=function(){this._throwUnlessSetup("status");return this._activeConnection?t.Status.Busy:this._status};t.prototype.toString=function(){return"[Twilio.Device instance]"};t.prototype.unregisterPresence=function(){this._throwUnlessSetup("unregisterPresence");this.mediaPresence.audio=!1;this._sendPresence();return this};t.prototype.updateToken=function(e){this._throwUnlessSetup("updateToken");this.token=e;this.register(e)};t.prototype._addHandler=function(e,t){if(!T){this._log.warn("Device callback handlers (connect, error, offline, incoming, cancel, ready, disconnect)         have been deprecated and will be removed in the next breaking release. Instead, the EventEmitter         interface can be used to set event listeners. Example: device.on('"+e+"', handler)");T=!0}this.addListener(e,t);return this};t.prototype._asyncEmit=function(e){for(var t=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];setTimeout((function(){return t.emit.apply(t,a([e],n))}))};t.prototype._findConnection=function(e){return this.connections.find((function(t){return t.parameters.CallSid===e||t.outboundConnectionId===e}))||null};t.prototype._makeConnection=function(e,n){var i=this;if(void 0===t._isUnifiedPlanDefault)throw new d.InvalidStateError("Device has not been initialized.");var r={audioHelper:this.audio,getUserMedia:b,isUnifiedPlanDefault:t._isUnifiedPlanDefault,pstream:this.stream,publisher:this._publisher,soundcache:this.soundcache};n=Object.assign({MediaStream:this.options.MediaStream||this.options.mediaStreamFactory||_.PeerConnection,audioConstraints:this.options.audioConstraints,beforeAccept:function(e){if(i._activeConnection&&i._activeConnection!==e){i._activeConnection.disconnect();i._removeConnection(i._activeConnection)}},codecPreferences:this.options.codecPreferences,dialtonePlayer:t._dialtonePlayer,dscp:this.options.dscp,enableIceRestart:this.options.enableIceRestart,enableRingingState:this.options.enableRingingState,forceAggressiveIceNomination:this.options.forceAggressiveIceNomination,getInputStream:function(){return i._connectionInputStream},getSinkIds:function(){return i._connectionSinkIds},maxAverageBitrate:this.options.maxAverageBitrate,rtcConfiguration:this.options.rtcConfiguration||{iceServers:this.options.iceServers},rtcConstraints:this.options.rtcConstraints,shouldPlayDisconnect:function(){return i._enabledSounds.disconnect},twimlParams:e},n);var o=new this.options.connectionFactory(r,n);o.once("accept",(function(){i._removeConnection(o);i._activeConnection=o;i.audio&&i.audio._maybeStartPollingVolume();o.direction===l.default.CallDirection.Outgoing&&i._enabledSounds.outgoing&&i.soundcache.get(t.SoundName.Outgoing).play();var e={edge:i._edge||i._region},n=i.options.edge;n&&(e.selected_edge=Array.isArray(n)?n:[n]);i._publisher.info("settings","edge",e,o);i._asyncEmit("connect",o)}));o.addListener("error",(function(e){"closed"===o.status()&&i._removeConnection(o);i.audio&&i.audio._maybeStopPollingVolume();i._maybeStopIncomingSound();i._asyncEmit("error",e)}));o.once("cancel",(function(){i._log.info("Canceled: "+o.parameters.CallSid);i._removeConnection(o);i.audio&&i.audio._maybeStopPollingVolume();i._maybeStopIncomingSound();i._asyncEmit("cancel",o)}));o.once("disconnect",(function(){i.audio&&i.audio._maybeStopPollingVolume();i._removeConnection(o);i._asyncEmit("disconnect",o)}));o.once("reject",(function(){i._log.info("Rejected: "+o.parameters.CallSid);i.audio&&i.audio._maybeStopPollingVolume();i._removeConnection(o);i._maybeStopIncomingSound()}));o.once("transportClose",(function(){if(o.status()===l.default.State.Pending){i.audio&&i.audio._maybeStopPollingVolume();i._removeConnection(o);i._maybeStopIncomingSound()}}));return o};t.prototype._maybeStopIncomingSound=function(){this.connections.length||this.soundcache.get(t.SoundName.Incoming).stop()};t.prototype._removeConnection=function(e){this._activeConnection===e&&(this._activeConnection=null);for(var t=this.connections.length-1;t>=0;t--)e===this.connections[t]&&this.connections.splice(t,1)};t.prototype._sendPresence=function(){if(this.stream){this.stream.register({audio:this.mediaPresence.audio});this.mediaPresence.audio?this._startRegistrationTimer():this._stopRegistrationTimer()}};t.prototype._setupStream=function(e){this._log.info("Setting up VSP");this.stream=this.options.pStreamFactory(e,this._chunderURIs,{backoffMaxMs:this.options.backoffMaxMs});this.stream.addListener("close",this._onSignalingClose);this.stream.addListener("connected",this._onSignalingConnected);this.stream.addListener("error",this._onSignalingError);this.stream.addListener("invite",this._onSignalingInvite);this.stream.addListener("offline",this._onSignalingOffline);this.stream.addListener("ready",this._onSignalingReady)};t.prototype._showIncomingConnection=function(e,t){var n,i=this;return Promise.race([t(),new Promise((function(e,t){n=setTimeout((function(){t(new Error("Playing incoming ringtone took too long; it might not play. Continuing execution..."))}),E)}))]).catch((function(e){i._log.info(e.message)})).then((function(){clearTimeout(n);i.emit("incoming",e)}))};t.prototype._startRegistrationTimer=function(){var e=this;this._stopRegistrationTimer();this.regTimer=setTimeout((function(){e._sendPresence()}),S)};t.prototype._stopRegistrationTimer=function(){this.regTimer&&clearTimeout(this.regTimer)};t.prototype._throwUnlessSetup=function(e){if(!this.isInitialized)throw new d.InvalidStateError("Call Device.setup() before "+e)};t.prototype._updateRingtoneSinkIds=function(e){return Promise.resolve(this.soundcache.get(t.SoundName.Incoming).setSinkIds(e))};t.prototype._updateSpeakerSinkIds=function(e){Array.from(this.soundcache.entries()).filter((function(e){return e[0]!==t.SoundName.Incoming})).forEach((function(t){return t[1].setSinkIds(e)}));this._connectionSinkIds=e;var n=this._activeConnection;return n?n._setSinkIds(e):Promise.resolve()};t.prototype.register=function(e){if(this.stream){this.stream.setToken(e);this._publisher.setToken(e)}else this._setupStream(e)};return t}(s.EventEmitter);!function(e){!function(e){e.Cancel="cancel";e.Connect="connect";e.Disconnect="disconnect";e.Error="error";e.Incoming="incoming";e.Offline="offline";e.Ready="ready"}(e.EventName||(e.EventName={}));!function(e){e.Busy="busy";e.Offline="offline";e.Ready="ready"}(e.Status||(e.Status={}));!function(e){e.Incoming="incoming";e.Outgoing="outgoing";e.Disconnect="disconnect";e.Dtmf0="dtmf0";e.Dtmf1="dtmf1";e.Dtmf2="dtmf2";e.Dtmf3="dtmf3";e.Dtmf4="dtmf4";e.Dtmf5="dtmf5";e.Dtmf6="dtmf6";e.Dtmf7="dtmf7";e.Dtmf8="dtmf8";e.Dtmf9="dtmf9";e.DtmfS="dtmfs";e.DtmfH="dtmfh"}(e.SoundName||(e.SoundName={}))}(C||(C={}));n.default=C},{"./audiohelper":5,"./connection":6,"./constants":7,"./dialtonePlayer":10,"./errors":12,"./eventpublisher":13,"./log":14,"./pstream":16,"./regions":17,"./rtc":21,"./rtc/getusermedia":19,"./sound":31,"./util":33,events:46}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./errors"),r={dtmf0:[1360,960],dtmf1:[1230,720],dtmf2:[1360,720],dtmf3:[1480,720],dtmf4:[1230,790],dtmf5:[1360,790],dtmf6:[1480,790],dtmf7:[1230,870],dtmf8:[1360,870],dtmf9:[1480,870],dtmfh:[1480,960],dtmfs:[1230,960]},o=function(){function e(e){var t=this;this._context=e;this._gainNodes=[];this._gainNodes=[this._context.createGain(),this._context.createGain()];this._gainNodes.forEach((function(e){e.connect(t._context.destination);e.gain.value=.1;t._gainNodes.push(e)}))}e.prototype.cleanup=function(){this._gainNodes.forEach((function(e){e.disconnect()}))};e.prototype.play=function(e){var t=this,n=r[e];if(!n)throw new i.InvalidArgumentError("Invalid DTMF sound name");[this._context.createOscillator(),this._context.createOscillator()].forEach((function(e,i){e.type="sine";e.frequency.value=n[i];e.connect(t._gainNodes[i]);e.start();e.stop(t._context.currentTime+.1);e.addEventListener("ended",(function(){return e.disconnect()}))}))};return e}();n.default=o},{"./errors":12}],11:[function(e,t,n){"use strict";var i,r,o,a,s,c,l=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){i(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});function u(e,t,n){if("string"==typeof t){e.message=t;n instanceof Error&&(e.originalError=n)}else t instanceof Error&&(e.originalError=t)}!function(e){var t=function(t){l(n,t);function n(n,i){var r=t.call(this,"")||this;r.causes=[];r.code=20101;r.description="Invalid access token";r.explanation="Twilio was unable to validate your Access Token";r.solutions=[];Object.setPrototypeOf(r,e.AccessTokenInvalid.prototype);u(r,n,i);return r}return n}(Error);e.AccessTokenInvalid=t;var n=function(t){l(n,t);function n(n,i){var r=t.call(this,"")||this;r.causes=[];r.code=20104;r.description="Access token expired or expiration date invalid";r.explanation="The Access Token provided to the Twilio API has expired, the expiration time specified in the token was invalid, or the expiration time specified was too far in the future";r.solutions=[];Object.setPrototypeOf(r,e.AccessTokenExpired.prototype);u(r,n,i);return r}return n}(Error);e.AccessTokenExpired=n;var i=function(t){l(n,t);function n(n,i){var r=t.call(this,"")||this;r.causes=[];r.code=20151;r.description="Authentication Failed";r.explanation="The Authentication with the provided JWT failed";r.solutions=[];Object.setPrototypeOf(r,e.AuthenticationFailed.prototype);u(r,n,i);return r}return n}(Error);e.AuthenticationFailed=i}(r=n.AuthorizationErrors||(n.AuthorizationErrors={}));!function(e){var t=function(t){l(n,t);function n(n,i){var r=t.call(this,"")||this;r.causes=[];r.code=31400;r.description="Bad Request (HTTP/SIP)";r.explanation="The request could not be understood due to malformed syntax.";r.solutions=[];Object.setPrototypeOf(r,e.BadRequest.prototype);u(r,n,i);return r}return n}(Error);e.BadRequest=t}(o=n.ClientErrors||(n.ClientErrors={}));!function(e){var t=function(t){l(n,t);function n(n,i){var r=t.call(this,"")||this;r.causes=[];r.code=31e3;r.description="Unknown Error";r.explanation="An unknown error has occurred. See error details for more information.";r.solutions=[];Object.setPrototypeOf(r,e.UnknownError.prototype);u(r,n,i);return r}return n}(Error);e.UnknownError=t;var n=function(t){l(n,t);function n(n,i){var r=t.call(this,"")||this;r.causes=[];r.code=31005;r.description="Connection error";r.explanation="A connection error occurred during the call";r.solutions=[];Object.setPrototypeOf(r,e.ConnectionError.prototype);u(r,n,i);return r}return n}(Error);e.ConnectionError=n;var i=function(t){l(n,t);function n(n,i){var r=t.call(this,"")||this;r.causes=[];r.code=31009;r.description="Transport error";r.explanation="No transport available to send or receive messages";r.solutions=[];Object.setPrototypeOf(r,e.TransportError.prototype);u(r,n,i);return r}return n}(Error);e.TransportError=i}(a=n.GeneralErrors||(n.GeneralErrors={}));!function(e){var t=function(t){l(n,t);function n(n,i){var r=t.call(this,"")||this;r.causes=[];r.code=53e3;r.description="Signaling connection error";r.explanation="Raised whenever a signaling connection error occurs that is not covered by a more specific error code.";r.solutions=[];Object.setPrototypeOf(r,e.ConnectionError.prototype);u(r,n,i);return r}return n}(Error);e.ConnectionError=t;var n=function(t){l(n,t);function n(n,i){var r=t.call(this,"")||this;r.causes=["The device running your application lost its Internet connection."];r.code=53001;r.description="Signaling connection disconnected";r.explanation="Raised whenever the signaling connection is unexpectedly disconnected.";r.solutions=["Ensure the device running your application has access to a stable Internet connection."];Object.setPrototypeOf(r,e.ConnectionDisconnected.prototype);u(r,n,i);return r}return n}(Error);e.ConnectionDisconnected=n}(s=n.SignalingErrors||(n.SignalingErrors={}));!function(e){var t=function(t){l(n,t);function n(n,i){var r=t.call(this,"")||this;r.causes=["The Client may not be using a supported WebRTC implementation.","The Client may not have the necessary resources to create or apply a new media description."];r.code=53400;r.description="Client is unable to create or apply a local media description";r.explanation="Raised whenever a Client is unable to create or apply a local media description.";r.solutions=["If you are experiencing this error using the JavaScript SDK, ensure you are running it with a supported WebRTC implementation."];Object.setPrototypeOf(r,e.ClientLocalDescFailed.prototype);u(r,n,i);return r}return n}(Error);e.ClientLocalDescFailed=t;var n=function(t){l(n,t);function n(n,i){var r=t.call(this,"")||this;r.causes=["The Client may not be using a supported WebRTC implementation.","The Client may be connecting peer-to-peer with another Participant that is not using a supported WebRTC implementation.","The Client may not have the necessary resources to apply a new media description."];r.code=53402;r.description="Client is unable to apply a remote media description";r.explanation="Raised whenever the Client receives a remote media description but is unable to apply it.";r.solutions=["If you are experiencing this error using the JavaScript SDK, ensure you are running it with a supported WebRTC implementation."];Object.setPrototypeOf(r,e.ClientRemoteDescFailed.prototype);u(r,n,i);return r}return n}(Error);e.ClientRemoteDescFailed=n;var i=function(t){l(n,t);function n(n,i){var r=t.call(this,"")||this;r.causes=["The Client was unable to establish a media connection.","A media connection which was active failed liveliness checks."];r.code=53405;r.description="Media connection failed";r.explanation="Raised by the Client or Server whenever a media connection fails.";r.solutions=["If the problem persists, try connecting to another region.","Check your Client's network connectivity.","If you've provided custom ICE Servers then ensure that the URLs and credentials are valid."];Object.setPrototypeOf(r,e.ConnectionError.prototype);u(r,n,i);return r}return n}(Error);e.ConnectionError=i}(c=n.MediaErrors||(n.MediaErrors={}));n.errorsByCode=new Map([[20101,r.AccessTokenInvalid],[20104,r.AccessTokenExpired],[20151,r.AuthenticationFailed],[31400,o.BadRequest],[31e3,a.UnknownError],[31005,a.ConnectionError],[31009,a.TransportError],[53e3,s.ConnectionError],[53001,s.ConnectionDisconnected],[53400,c.ClientLocalDescFailed],[53402,c.ClientRemoteDescFailed],[53405,c.ConnectionError]]);Object.freeze(n.errorsByCode)},{}],12:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){i(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o=e("./generated");n.AuthorizationErrors=o.AuthorizationErrors;n.ClientErrors=o.ClientErrors;n.GeneralErrors=o.GeneralErrors;n.MediaErrors=o.MediaErrors;n.SignalingErrors=o.SignalingErrors;var a=function(e){r(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(Error);n.InvalidArgumentError=a;var s=function(e){r(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(Error);n.InvalidStateError=s;var c=function(e){r(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(Error);n.NotSupportedError=c;function l(e){var t=o.errorsByCode.get(e);if(!t)throw new a("Error code "+e+" not found");return t}n.getErrorByCode=l},{"./generated":11}],13:[function(e,t,n){"use strict";var i=e("./request");function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);var o=(n=Object.assign({defaultPayload:function(){return{}},host:"eventgw.twilio.com"},n)).defaultPayload;"function"!=typeof o&&(o=function(){return Object.assign({},n.defaultPayload)});var a=!0,s=Object.assign({app_name:void 0,app_version:void 0},n.metadata);Object.defineProperties(this,{_defaultPayload:{value:o},_isEnabled:{get:function(){return a},set:function(e){a=e}},_host:{value:n.host},_request:{value:n.request||i,writable:!0},_token:{value:t,writable:!0},isEnabled:{enumerable:!0,get:function(){return a}},metadata:{enumerable:!0,get:function(){return s}},productName:{enumerable:!0,value:e},token:{enumerable:!0,get:function(){return this._token}}})}r.prototype._post=function(e,t,n,i,r,o,a){if(!this.isEnabled&&!a)return Promise.resolve();if(!o||!(o.parameters&&o.parameters.CallSid||o.outboundConnectionId))return Promise.resolve();var s={publisher:this.productName,group:n,name:i,timestamp:(new Date).toISOString(),level:t.toUpperCase(),payload_type:"application/json",private:!1,payload:r&&r.forEach?r.slice(0):Object.assign(this._defaultPayload(o),r)};this.metadata&&(s.publisher_metadata=this.metadata);var c={url:"https://"+this._host+"/v4/"+e,body:s,headers:{"Content-Type":"application/json","X-Twilio-Token":this.token}},l=this;return new Promise((function(e,t){l._request.post(c,(function(n){n?t(n):e()}))}))};r.prototype.post=function(e,t,n,i,r,o){return this._post("EndpointEvents",e,t,n,i,r,o)};r.prototype.debug=function(e,t,n,i){return this.post("debug",e,t,n,i)};r.prototype.info=function(e,t,n,i){return this.post("info",e,t,n,i)};r.prototype.warn=function(e,t,n,i){return this.post("warning",e,t,n,i)};r.prototype.error=function(e,t,n,i){return this.post("error",e,t,n,i)};r.prototype.postMetrics=function(e,t,n,i,r){var a=this;return new Promise((function(s){var c=n.map(o).map((function(e){return Object.assign(e,i)}));s(a._post("EndpointMetrics","info",e,t,c,r))}))};r.prototype.setToken=function(e){this._token=e};r.prototype.enable=function(){this._isEnabled=!0};r.prototype.disable=function(){this._isEnabled=!1};function o(e){return{timestamp:new Date(e.timestamp).toISOString(),total_packets_received:e.totals.packetsReceived,total_packets_lost:e.totals.packetsLost,total_packets_sent:e.totals.packetsSent,total_bytes_received:e.totals.bytesReceived,total_bytes_sent:e.totals.bytesSent,packets_received:e.packetsReceived,packets_lost:e.packetsLost,packets_lost_fraction:e.packetsLostFraction&&Math.round(100*e.packetsLostFraction)/100,bytes_received:e.bytesReceived,bytes_sent:e.bytesSent,audio_codec:e.codecName,audio_level_in:e.audioInputLevel,audio_level_out:e.audioOutputLevel,call_volume_input:e.inputVolume,call_volume_output:e.outputVolume,jitter:e.jitter,rtt:e.rtt,mos:e.mos&&Math.round(100*e.mos)/100}}t.exports=r},{"./request":18}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("loglevel"),r=e("./constants"),o=function(){function e(e){this._log=(e&&e.LogLevelModule?e.LogLevelModule:i).getLogger(r.PACKAGE_NAME)}e.getInstance=function(){e.instance||(e.instance=new e);return e.instance};e.prototype.debug=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this._log).debug.apply(e,t)};e.prototype.error=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this._log).error.apply(e,t)};e.prototype.info=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this._log).info.apply(e,t)};e.prototype.setDefaultLevel=function(e){this._log.setDefaultLevel(e)};e.prototype.warn=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this._log).warn.apply(e,t)};e.levels=i.levels;return e}();n.default=o},{"./constants":7,loglevel:47}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e("./constants"),r=e("./errors"),o=i.SOUNDS_BASE_URL+"/outgoing.mp3",a=function(){function e(e,t,n,i){this._name=e;this._availableDevices=t;this._beforeChange=n;this._isSupported=i;this._activeDevices=new Set}e.prototype.delete=function(e){var t=!!this._activeDevices.delete(e),n=this._availableDevices.get("default")||Array.from(this._availableDevices.values())[0];!this._activeDevices.size&&n&&this._activeDevices.add(n);var i=Array.from(this._activeDevices.values()).map((function(e){return e.deviceId}));this._beforeChange(this._name,i);return!!t};e.prototype.get=function(){return this._activeDevices};e.prototype.set=function(e){var t=this;if(!this._isSupported)return Promise.reject(new r.NotSupportedError("This browser does not support audio output selection"));var n=Array.isArray(e)?e:[e];if(!n.length)return Promise.reject(new r.InvalidArgumentError("Must specify at least one device to set"));var i=[],o=n.map((function(e){var n=t._availableDevices.get(e);n||i.push(e);return n}));return i.length?Promise.reject(new r.InvalidArgumentError("Devices not found: "+i.join(", "))):new Promise((function(e){e(t._beforeChange(t._name,n))})).then((function(){t._activeDevices.clear();o.forEach(t._activeDevices.add,t._activeDevices)}))};e.prototype.test=function(e){void 0===e&&(e=o);return this._isSupported?this._activeDevices.size?Promise.all(Array.from(this._activeDevices).map((function(t){var n;return new Promise((function(t){(n=new Audio(e)).oncanplay=t})).then((function(){return n.setSinkId(t.deviceId).then((function(){return n.play()}))}))}))):Promise.reject(new r.InvalidStateError("No active output devices to test")):Promise.reject(new r.NotSupportedError("This browser does not support audio output selection"))};return e}();n.default=a},{"./constants":7,"./errors":12}],16:[function(e,t,n){"use strict";function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var r=e("./constants"),o=e("events").EventEmitter,a=e("./log").default,s=e("util"),c=e("./wstransport").default,l=e("./errors"),u=l.GeneralErrors,d=l.SignalingErrors,p="1.5";function f(e,t,n){if(!(this instanceof f))return new f(e,t,n);var i={TransportFactory:c};n=n||{};for(var r in i)r in n||(n[r]=i[r]);this.options=n;this.token=e||"";this.status="disconnected";this.gateway=null;this.region=null;this._messageQueue=[];this._uris=t;this._handleTransportClose=this._handleTransportClose.bind(this);this._handleTransportError=this._handleTransportError.bind(this);this._handleTransportMessage=this._handleTransportMessage.bind(this);this._handleTransportOpen=this._handleTransportOpen.bind(this);this._log=a.getInstance();this.on("error",(function(){}));var o=this;this.addListener("ready",(function(){o.status="ready"}));this.addListener("offline",(function(){o.status="offline"}));this.addListener("close",(function(){o._log.info('Received "close" from server. Destroying PStream...');o._destroy()}));this.transport=new this.options.TransportFactory(this._uris,{backoffMaxMs:this.options.backoffMaxMs});Object.defineProperties(this,{uri:{enumerable:!0,get:function(){return this.transport.uri}}});this.transport.on("close",this._handleTransportClose);this.transport.on("error",this._handleTransportError);this.transport.on("message",this._handleTransportMessage);this.transport.on("open",this._handleTransportOpen);this.transport.open();return this}s.inherits(f,o);f.prototype._handleTransportClose=function(){this.emit("transportClose");if("disconnected"!==this.status){"offline"!==this.status&&this.emit("offline",this);this.status="disconnected"}};f.prototype._handleTransportError=function(e){e?this.emit("error",void 0!==e.code?{error:e}:e):this.emit("error",{error:{code:31e3,message:"Websocket closed without a provided reason",twilioError:new d.ConnectionDisconnected}})};f.prototype._handleTransportMessage=function(e){if(e&&e.data&&"string"==typeof e.data){var t=JSON.parse(e.data),n=t.type,i=t.payload,r=void 0===i?{}:i;this.gateway=r.gateway||this.gateway;this.region=r.region||this.region;"error"===n&&r.error&&(r.error.twilioError=new d.ConnectionError);this.emit(n,r)}};f.prototype._handleTransportOpen=function(){var e=this;this.status="connected";this.setToken(this.token);this._messageQueue.splice(0,this._messageQueue.length).forEach((function(t){return e._publish.apply(e,i(t))}))};f.toString=function(){return"[Twilio.PStream class]"};f.prototype.toString=function(){return"[Twilio.PStream instance]"};f.prototype.setToken=function(e){this._log.info("Setting token and publishing listen");this.token=e;var t={token:e,browserinfo:h()};this._publish("listen",t)};f.prototype.register=function(e){var t={media:e};this._publish("register",t,!0)};f.prototype.invite=function(e,t,n){var i={callsid:t,sdp:e,twilio:n?{params:n}:{}};this._publish("invite",i,!0)};f.prototype.answer=function(e,t){this._publish("answer",{sdp:e,callsid:t},!0)};f.prototype.dtmf=function(e,t){this._publish("dtmf",{callsid:e,dtmf:t},!0)};f.prototype.hangup=function(e,t){var n=t?{callsid:e,message:t}:{callsid:e};this._publish("hangup",n,!0)};f.prototype.reject=function(e){this._publish("reject",{callsid:e},!0)};f.prototype.reinvite=function(e,t){this._publish("reinvite",{sdp:e,callsid:t},!1)};f.prototype._destroy=function(){this.transport.removeListener("close",this._handleTransportClose);this.transport.removeListener("error",this._handleTransportError);this.transport.removeListener("message",this._handleTransportMessage);this.transport.removeListener("open",this._handleTransportOpen);this.transport.close();this.emit("offline",this)};f.prototype.destroy=function(){this._log.info("PStream.destroy() called...");this._destroy();return this};f.prototype.publish=function(e,t){return this._publish(e,t,!0)};f.prototype._publish=function(e,t,n){var i=JSON.stringify({type:e,version:p,payload:t});if(!this.transport.send(i)){this.emit("error",{error:{code:31009,message:"No transport available to send or receive messages",twilioError:new u.TransportError}});n&&this._messageQueue.push([e,t,!0])}};function h(){var e="undefined"!=typeof navigator?navigator:{};return{p:"browser",v:r.RELEASE_VERSION,browser:{userAgent:e.userAgent||"unknown",platform:e.platform||"unknown"},plugin:"rtc"}}t.exports=f},{"./constants":7,"./errors":12,"./log":14,"./wstransport":34,events:46,util:58}],17:[function(e,t,n){"use strict";var i,r,o,a;Object.defineProperty(n,"__esModule",{value:!0});var s,c,l,u=e("./errors");!function(e){e.Au="au";e.Br="br";e.Ie="ie";e.Jp="jp";e.Sg="sg";e.UsOr="us-or";e.UsVa="us-va"}(s=n.DeprecatedRegion||(n.DeprecatedRegion={}));!function(e){e.Sydney="sydney";e.SaoPaulo="sao-paulo";e.Dublin="dublin";e.Frankfurt="frankfurt";e.Tokyo="tokyo";e.Singapore="singapore";e.Ashburn="ashburn";e.Umatilla="umatilla";e.Roaming="roaming";e.AshburnIx="ashburn-ix";e.SanJoseIx="san-jose-ix";e.LondonIx="london-ix";e.FrankfurtIx="frankfurt-ix";e.SingaporeIx="singapore-ix"}(c=n.Edge||(n.Edge={}));!function(e){e.Au1="au1";e.Br1="br1";e.De1="de1";e.De1Ix="de1-ix";e.Gll="gll";e.Ie1="ie1";e.Ie1Ix="ie1-ix";e.Ie1Tnx="ie1-tnx";e.Jp1="jp1";e.Sg1="sg1";e.Sg1Ix="sg1-ix";e.Sg1Tnx="sg1-tnx";e.Us1="us1";e.Us1Ix="us1-ix";e.Us1Tnx="us1-tnx";e.Us2="us2";e.Us2Ix="us2-ix";e.Us2Tnx="us2-tnx"}(l=n.Region||(n.Region={}));n.deprecatedRegions=((i={})[s.Au]=l.Au1,i[s.Br]=l.Br1,i[s.Ie]=l.Ie1,i[s.Jp]=l.Jp1,i[s.Sg]=l.Sg1,i[s.UsOr]=l.Us1,i[s.UsVa]=l.Us1,i);n.regionShortcodes={ASIAPAC_SINGAPORE:l.Sg1,ASIAPAC_SYDNEY:l.Au1,ASIAPAC_TOKYO:l.Jp1,EU_FRANKFURT:l.De1,EU_IRELAND:l.Ie1,SOUTH_AMERICA_SAO_PAULO:l.Br1,US_EAST_VIRGINIA:l.Us1,US_WEST_OREGON:l.Us2};(r={})[l.Au1]="chunderw-vpc-gll-au1.twilio.com",r[l.Br1]="chunderw-vpc-gll-br1.twilio.com",r[l.De1]="chunderw-vpc-gll-de1.twilio.com",r[l.De1Ix]="chunderw-vpc-gll-de1-ix.twilio.com",r[l.Gll]="chunderw-vpc-gll.twilio.com",r[l.Ie1]="chunderw-vpc-gll-ie1.twilio.com",r[l.Ie1Ix]="chunderw-vpc-gll-ie1-ix.twilio.com",r[l.Ie1Tnx]="chunderw-vpc-gll-ie1-tnx.twilio.com",r[l.Jp1]="chunderw-vpc-gll-jp1.twilio.com",r[l.Sg1]="chunderw-vpc-gll-sg1.twilio.com",r[l.Sg1Ix]="chunderw-vpc-gll-sg1-ix.twilio.com",r[l.Sg1Tnx]="chunderw-vpc-gll-sg1-tnx.twilio.com",r[l.Us1]="chunderw-vpc-gll-us1.twilio.com",r[l.Us1Ix]="chunderw-vpc-gll-us1-ix.twilio.com",r[l.Us1Tnx]="chunderw-vpc-gll-us1-tnx.twilio.com",r[l.Us2]="chunderw-vpc-gll-us2.twilio.com",r[l.Us2Ix]="chunderw-vpc-gll-us2-ix.twilio.com",r[l.Us2Tnx]="chunderw-vpc-gll-us2-tnx.twilio.com";n.edgeToRegion=((o={})[c.Sydney]=l.Au1,o[c.SaoPaulo]=l.Br1,o[c.Dublin]=l.Ie1,o[c.Frankfurt]=l.De1,o[c.Tokyo]=l.Jp1,o[c.Singapore]=l.Sg1,o[c.Ashburn]=l.Us1,o[c.Umatilla]=l.Us2,o[c.Roaming]=l.Gll,o[c.AshburnIx]=l.Us1Ix,o[c.SanJoseIx]=l.Us2Ix,o[c.LondonIx]=l.Ie1Ix,o[c.FrankfurtIx]=l.De1Ix,o[c.SingaporeIx]=l.Sg1Ix,o);n.regionToEdge=((a={})[l.Au1]=c.Sydney,a[l.Br1]=c.SaoPaulo,a[l.Ie1]=c.Dublin,a[l.De1]=c.Frankfurt,a[l.Jp1]=c.Tokyo,a[l.Sg1]=c.Singapore,a[l.Us1]=c.Ashburn,a[l.Us2]=c.Umatilla,a[l.Gll]=c.Roaming,a[l.Us1Ix]=c.AshburnIx,a[l.Us2Ix]=c.SanJoseIx,a[l.Ie1Ix]=c.LondonIx,a[l.De1Ix]=c.FrankfurtIx,a[l.Sg1Ix]=c.SingaporeIx,a[l.Us1Tnx]=c.AshburnIx,a[l.Us2Tnx]=c.AshburnIx,a[l.Ie1Tnx]=c.LondonIx,a[l.Sg1Tnx]=c.SingaporeIx,a);n.defaultRegion="gll";n.defaultEdge=c.Roaming;n.defaultChunderRegionURI="chunderw-vpc-gll.twilio.com";function d(e){return e===n.defaultRegion?n.defaultChunderRegionURI:"chunderw-vpc-gll-"+e+".twilio.com"}function p(e){return"voice-js."+e+".twilio.com"}function f(e,t,i){if(t&&"string"!=typeof t)throw new u.InvalidArgumentError("If `region` is provided, it must be of type `string`.");if(e&&"string"!=typeof e&&!Array.isArray(e))throw new u.InvalidArgumentError("If `edge` is provided, it must be of type `string` or an array of strings.");var r,o=[];if(t&&e)throw new u.InvalidArgumentError("You cannot specify `region` when `edge` is specified in`Twilio.Device.Options`.");if(t){var a=t;o.push("Regions are deprecated in favor of edges. Please see this page for documentation: https://www.twilio.com/docs/voice/client/edges.");Object.values(s).includes(a)&&(a=n.deprecatedRegions[a]);if(Object.values(l).includes(a)){var f=n.regionToEdge[a];o.push('Region "'+a+'" is deprecated, please use `edge` "'+f+'".')}r=[d(a)]}else if(e){var h=Object.values(c);r=(Array.isArray(e)?e:[e]).map((function(e){return h.includes(e)?d(n.edgeToRegion[e]):p(e)}))}else r=[n.defaultChunderRegionURI];i&&o.length&&setTimeout((function(){return i(o.join("\n"))}));return r}n.getChunderURIs=f;function h(e){return n.regionShortcodes[e]||null}n.getRegionShortcode=h},{"./errors":12}],18:[function(e,t,n){"use strict";var i=e("xmlhttprequest").XMLHttpRequest;function r(e,t,n){var r={};r.XMLHttpRequest=r.XMLHttpRequest||i;var o=new r.XMLHttpRequest;o.open(e,t.url,!0);o.onreadystatechange=function(){4===o.readyState&&(200<=o.status&&o.status<300?n(null,o.responseText):n(new Error(o.responseText)))};for(var a in t.headers)o.setRequestHeader(a,t.headers[a]);o.send(JSON.stringify(t.body))}var o=r;o.get=function(e,t){return new this("GET",e,t)};o.post=function(e,t){return new this("POST",e,t)};t.exports=o},{xmlhttprequest:2}],19:[function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=e("../errors").NotSupportedError,o=e("../util");function a(e,t){(t=t||{}).util=t.util||o;t.navigator=t.navigator||("undefined"!=typeof navigator?navigator:null);return new Promise((function(n,o){if(!t.navigator)throw new r("getUserMedia is not supported");switch("function"){case i(t.navigator.mediaDevices&&t.navigator.mediaDevices.getUserMedia):return n(t.navigator.mediaDevices.getUserMedia(e));case i(t.navigator.webkitGetUserMedia):return t.navigator.webkitGetUserMedia(e,n,o);case i(t.navigator.mozGetUserMedia):return t.navigator.mozGetUserMedia(e,n,o);case i(t.navigator.getUserMedia):return t.navigator.getUserMedia(e,n,o);default:throw new r("getUserMedia is not supported")}})).catch((function(e){throw t.util.isFirefox()&&"NotReadableError"===e.name?new r("Firefox does not currently support opening multiple audio input trackssimultaneously, even across different tabs.\nRelated Bugzilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324"):e}))}t.exports=a},{"../errors":12,"../util":33}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t=!1);this.deleted=!1;var n,i=e.candidate.split("network-cost ");i[1]&&(n=parseInt(i[1],10));this.candidateType=e.type;this.ip=e.ip||e.address;this.isRemote=t;this.networkCost=n;this.port=e.port;this.priority=e.priority;this.protocol=e.protocol;this.relatedAddress=e.relatedAddress;this.relatedPort=e.relatedPort;this.tcpType=e.tcpType;this.transportId=e.sdpMid}e.prototype.toPayload=function(){return{candidate_type:this.candidateType,deleted:this.deleted,ip:this.ip,is_remote:this.isRemote,"network-cost":this.networkCost,port:this.port,priority:this.priority,protocol:this.protocol,related_address:this.relatedAddress,related_port:this.relatedPort,tcp_type:this.tcpType,transport_id:this.transportId}};return e}();n.IceCandidate=i},{}],21:[function(e,t,n){"use strict";var i=e("./peerconnection"),r=e("./rtcpc").test;function o(){return r()}function a(){return"undefined"!=typeof RTCIceGatherer?"ORTC":"WebRTC"}t.exports={enabled:o,getMediaEngine:a,PeerConnection:i}},{"./peerconnection":24,"./rtcpc":25}],22:[function(e,t,n){"use strict";var i=32767,r="undefined"!=typeof window?window.RTCStatsReport:void 0;function o(e){if(!(this instanceof o))return new o(e);var t=this;Object.defineProperties(this,{size:{enumerable:!0,get:function(){return t._map.size}},_map:{value:e}});this[Symbol.iterator]=e[Symbol.iterator]}if(r){o.prototype=Object.create(r.prototype);o.prototype.constructor=o}["entries","forEach","get","has","keys","values"].forEach((function(e){o.prototype[e]=function(){var t;return(t=this._map)[e].apply(t,arguments)}}));o.fromArray=function(e){return new o(e.reduce((function(e,t){e.set(t.id,t);return e}),new Map))};o.fromRTCStatsResponse=function(e){var t=void 0,n=new Map,i=e.result().reduce((function(e,i){var r=i.id;switch(i.type){case"googCertificate":e.set(r,h(i));break;case"datachannel":e.set(r,m(i));break;case"googCandidatePair":y(i,"googActiveConnection")&&(t=r);e.set(r,f(i));break;case"localcandidate":e.set(r,p(i,!1));break;case"remotecandidate":e.set(r,p(i,!0));break;case"ssrc":S(i,"packetsReceived")?e.set("rtp-"+r,u(i)):e.set("rtp-"+r,d(i));e.set("track-"+r,c(i));e.set("codec-"+r,s(i));break;case"googComponent":var o=a(i);n.set(o.selectedCandidatePairId,r);e.set(r,a(i))}return e}),new Map);if(t){var r=n.get(t);r&&(i.get(r).dtlsState="connected")}return new o(i)};function a(e){return{type:"transport",id:e.id,timestamp:Date.parse(e.timestamp),bytesSent:void 0,bytesReceived:void 0,rtcpTransportStatsId:void 0,dtlsState:void 0,selectedCandidatePairId:e.stat("selectedCandidatePairId"),localCertificateId:e.stat("localCertificateId"),remoteCertificateId:e.stat("remoteCertificateId")}}function s(e){return{type:"codec",id:e.id,timestamp:Date.parse(e.timestamp),payloadType:void 0,mimeType:e.stat("mediaType")+"/"+e.stat("googCodecName"),clockRate:void 0,channels:void 0,sdpFmtpLine:void 0,implementation:void 0}}function c(e){return{type:"track",id:e.id,timestamp:Date.parse(e.timestamp),trackIdentifier:e.stat("googTrackId"),remoteSource:void 0,ended:void 0,kind:e.stat("mediaType"),detached:void 0,ssrcIds:void 0,frameWidth:S(e,"googFrameWidthReceived")?_(e,"googFrameWidthReceived"):_(e,"googFrameWidthSent"),frameHeight:S(e,"googFrameHeightReceived")?_(e,"googFrameHeightReceived"):_(e,"googFrameHeightSent"),framesPerSecond:void 0,framesSent:_(e,"framesEncoded"),framesReceived:void 0,framesDecoded:_(e,"framesDecoded"),framesDropped:void 0,framesCorrupted:void 0,partialFramesLost:void 0,fullFramesLost:void 0,audioLevel:S(e,"audioOutputLevel")?_(e,"audioOutputLevel")/i:(_(e,"audioInputLevel")||0)/i,echoReturnLoss:b(e,"googEchoCancellationReturnLoss"),echoReturnLossEnhancement:b(e,"googEchoCancellationReturnLossEnhancement")}}function l(e,t){return{id:e.id,timestamp:Date.parse(e.timestamp),ssrc:e.stat("ssrc"),associateStatsId:void 0,isRemote:void 0,mediaType:e.stat("mediaType"),trackId:"track-"+e.id,transportId:e.stat("transportId"),codecId:"codec-"+e.id,firCount:t?_(e,"googFirsSent"):void 0,pliCount:_(e,t?"googPlisSent":"googPlisReceived"),nackCount:_(e,t?"googNacksSent":"googNacksReceived"),sliCount:void 0,qpSum:_(e,"qpSum")}}function u(e){var t=l(e,!0);Object.assign(t,{type:"inbound-rtp",packetsReceived:_(e,"packetsReceived"),bytesReceived:_(e,"bytesReceived"),packetsLost:_(e,"packetsLost"),jitter:g(e.stat("googJitterReceived")),fractionLost:void 0,roundTripTime:g(e.stat("googRtt")),packetsDiscarded:void 0,packetsRepaired:void 0,burstPacketsLost:void 0,burstPacketsDiscarded:void 0,burstLossCount:void 0,burstDiscardCount:void 0,burstLossRate:void 0,burstDiscardRate:void 0,gapLossRate:void 0,gapDiscardRate:void 0,framesDecoded:_(e,"framesDecoded")});return t}function d(e){var t=l(e,!1);Object.assign(t,{type:"outbound-rtp",remoteTimestamp:void 0,packetsSent:_(e,"packetsSent"),bytesSent:_(e,"bytesSent"),targetBitrate:void 0,framesEncoded:_(e,"framesEncoded")});return t}function p(e,t){return{type:t?"remote-candidate":"local-candidate",id:e.id,timestamp:Date.parse(e.timestamp),transportId:void 0,isRemote:t,ip:e.stat("ipAddress"),port:_(e,"portNumber"),protocol:e.stat("transport"),candidateType:v(e.stat("candidateType")),priority:b(e,"priority"),url:void 0,relayProtocol:void 0,deleted:void 0}}function f(e){return{type:"candidate-pair",id:e.id,timestamp:Date.parse(e.timestamp),transportId:e.stat("googChannelId"),localCandidateId:e.stat("localCandidateId"),remoteCandidateId:e.stat("remoteCandidateId"),state:void 0,priority:void 0,nominated:void 0,writable:y(e,"googWritable"),readable:void 0,bytesSent:_(e,"bytesSent"),bytesReceived:_(e,"bytesReceived"),lastPacketSentTimestamp:void 0,lastPacketReceivedTimestamp:void 0,totalRoundTripTime:void 0,currentRoundTripTime:g(e.stat("googRtt")),availableOutgoingBitrate:void 0,availableIncomingBitrate:void 0,requestsReceived:_(e,"requestsReceived"),requestsSent:_(e,"requestsSent"),responsesReceived:_(e,"responsesReceived"),responsesSent:_(e,"responsesSent"),retransmissionsReceived:void 0,retransmissionsSent:void 0,consentRequestsSent:_(e,"consentRequestsSent")}}function h(e){return{type:"certificate",id:e.id,timestamp:Date.parse(e.timestamp),fingerprint:e.stat("googFingerprint"),fingerprintAlgorithm:e.stat("googFingerprintAlgorithm"),base64Certificate:e.stat("googDerBase64"),issuerCertificateId:e.stat("googIssuerId")}}function m(e){return{type:"data-channel",id:e.id,timestamp:Date.parse(e.timestamp),label:e.stat("label"),protocol:e.stat("protocol"),datachannelid:e.stat("datachannelid"),transportId:e.stat("transportId"),state:e.stat("state"),messagesSent:void 0,bytesSent:void 0,messagesReceived:void 0,bytesReceived:void 0}}function g(e){return isNaN(e)||""===e?void 0:parseInt(e,10)/1e3}function v(e){switch(e){case"peerreflexive":return"prflx";case"serverreflexive":return"srflx";case"host":case"relay":default:return e}}function _(e,t){var n=e.stat(t);return S(e,t)?parseInt(n,10):void 0}function b(e,t){var n=e.stat(t);return S(e,t)?parseFloat(n):void 0}function y(e,t){var n=e.stat(t);return S(e,t)?"true"===n||!0===n:void 0}function S(e,t){var n=e.stat(t);return void 0!==n&&""!==n}t.exports=o},{}],23:[function(e,t,n){"use strict";var i={r0:94.768,is:1.42611};function r(e,t,n){if(!a(e)||!a(t)||!a(n))return null;var i=o(e,t,n),r=1+.035*i+7e-6*i*(i-60)*(100-i);return r>=1&&r<4.6?r:null}function o(e,t,n){var r=e+2*t+10,o=0;switch(!0){case r<160:o=i.r0-r/40;break;case r<1e3:o=i.r0-(r-120)/10;break;case r>=1e3:o=i.r0-r/100}var a=.01;switch(!0){case-1===n:a=0;o=0;break;case n<=o/2.5:a=2.5;break;case n>o/2.5&&n<100:a=.25}return o-=n*a}function a(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)&&e>=0}t.exports={calculate:r}},{}],24:[function(e,t,n){"use strict";var i=e("../errors"),r=i.InvalidArgumentError,o=i.MediaErrors,a=i.NotSupportedError,s=i.SignalingErrors,c=e("../log").default,l=e("../util"),u=e("./rtcpc"),d=e("./sdp").setIceAggressiveNomination,p=15e3,f="none",h="timeout",m="new",g=50;function v(e,t,n,i){if(!e||!t||!n)throw new r("Audiohelper, pstream and getUserMedia are required arguments");if(!(this instanceof v))return new v(e,t,n,i);function o(){}this.onopen=o;this.onerror=o;this.onclose=o;this.ondisconnected=o;this.onfailed=o;this.onconnected=o;this.onreconnected=o;this.onsignalingstatechange=o;this.ondtlstransportstatechange=o;this.onicegatheringfailure=o;this.onicegatheringstatechange=o;this.oniceconnectionstatechange=o;this.onpcconnectionstatechange=o;this.onicecandidate=o;this.onselectedcandidatepairchange=o;this.onvolume=o;this.version=null;this.pstream=t;this.stream=null;this.sinkIds=new Set(["default"]);this.outputs=new Map;this.status="connecting";this.callSid=null;this.isMuted=!1;this.getUserMedia=n;var a="undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext);this._isSinkSupported=!!a&&"undefined"!=typeof HTMLAudioElement&&HTMLAudioElement.prototype.setSinkId;this._audioContext=a&&e._audioContext;this._hasIceCandidates=!1;this._hasIceGatheringFailures=!1;this._iceGatheringTimeoutId=null;this._masterAudio=null;this._masterAudioDeviceId=null;this._mediaStreamSource=null;this._dtmfSender=null;this._dtmfSenderUnsupported=!1;this._callEvents=[];this._nextTimeToPublish=Date.now();this._onAnswerOrRinging=o;this._onHangup=o;this._remoteStream=null;this._shouldManageStream=!0;this._iceState=m;this._isUnifiedPlan=i.isUnifiedPlan;this.options=i=i||{};this.navigator=i.navigator||("undefined"!=typeof navigator?navigator:null);this.util=i.util||l;this.codecPreferences=i.codecPreferences;this._log=c.getInstance();return this}v.prototype.uri=function(){return this._uri};v.prototype.openWithConstraints=function(e){return this.getUserMedia({audio:e}).then(this._setInputTracksFromStream.bind(this,!1))};v.prototype.setInputTracksFromStream=function(e){var t=this;return this._setInputTracksFromStream(!0,e).then((function(){t._shouldManageStream=!1}))};v.prototype._createAnalyser=function(e,t){t=Object.assign({fftSize:32,smoothingTimeConstant:.3},t);var n=e.createAnalyser();for(var i in t)n[i]=t[i];return n};v.prototype._setVolumeHandler=function(e){this.onvolume=e};v.prototype._startPollingVolume=function(){if(this._audioContext&&this.stream&&this._remoteStream){var e=this._audioContext,t=(this._inputAnalyser=this._createAnalyser(e)).frequencyBinCount,n=new Uint8Array(t);this._inputAnalyser2=this._createAnalyser(e,{minDecibels:-127,maxDecibels:0,smoothingTimeConstant:0});var i=(this._outputAnalyser=this._createAnalyser(e)).frequencyBinCount,r=new Uint8Array(i);this._outputAnalyser2=this._createAnalyser(e,{minDecibels:-127,maxDecibels:0,smoothingTimeConstant:0});this._updateInputStreamSource(this.stream);this._updateOutputStreamSource(this._remoteStream);var o=this;setTimeout((function e(){if(o._audioContext)if("closed"!==o.status){o._inputAnalyser.getByteFrequencyData(n);var t=o.util.average(n);o._inputAnalyser2.getByteFrequencyData(n);var i=o.util.average(n);o._outputAnalyser.getByteFrequencyData(r);var a=o.util.average(r);o._outputAnalyser2.getByteFrequencyData(r);var s=o.util.average(r);o.onvolume(t/255,a/255,i,s);setTimeout(e,g)}else{o._inputAnalyser.disconnect();o._outputAnalyser.disconnect();o._inputAnalyser2.disconnect();o._outputAnalyser2.disconnect()}}),g)}};v.prototype._stopStream=function(e){this._shouldManageStream&&("function"==typeof MediaStreamTrack.prototype.stop?("function"==typeof e.getAudioTracks?e.getAudioTracks():e.audioTracks).forEach((function(e){e.stop()})):e.stop())};v.prototype._updateInputStreamSource=function(e){this._inputStreamSource&&this._inputStreamSource.disconnect();this._inputStreamSource=this._audioContext.createMediaStreamSource(e);this._inputStreamSource.connect(this._inputAnalyser);this._inputStreamSource.connect(this._inputAnalyser2)};v.prototype._updateOutputStreamSource=function(e){this._outputStreamSource&&this._outputStreamSource.disconnect();this._outputStreamSource=this._audioContext.createMediaStreamSource(e);this._outputStreamSource.connect(this._outputAnalyser);this._outputStreamSource.connect(this._outputAnalyser2)};v.prototype._setInputTracksFromStream=function(e,t){return this._isUnifiedPlan?this._setInputTracksForUnifiedPlan(e,t):this._setInputTracksForPlanB(e,t)};v.prototype._setInputTracksForPlanB=function(e,t){var n=this;if(!t)return Promise.reject(new r("Can not set input stream to null while in a call"));if(!t.getAudioTracks().length)return Promise.reject(new r("Supplied input stream has no audio tracks"));var i=this.stream;if(i){this._stopStream(i);y(this.version.pc,i);i.getAudioTracks().forEach(i.removeTrack,i);t.getAudioTracks().forEach(i.addTrack,i);_(this.version.pc,t);this._updateInputStreamSource(this.stream)}else this.stream=e?b(t):t;this.mute(this.isMuted);return this.version?new Promise((function(e,t){n.version.createOffer(n.options.maxAverageBitrate,n.codecPreferences,{audio:!0},(function(){n.version.processAnswer(n.codecPreferences,n._answerSdp,(function(){e(n.stream)}),t)}),t)})):Promise.resolve(this.stream)};v.prototype._setInputTracksForUnifiedPlan=function(e,t){var n=this;if(!t)return Promise.reject(new r("Can not set input stream to null while in a call"));if(!t.getAudioTracks().length)return Promise.reject(new r("Supplied input stream has no audio tracks"));var i=this.stream,o=function(){n.mute(n.isMuted);return Promise.resolve(n.stream)};if(i){this._shouldManageStream&&this._stopStream(i);this._sender||(this._sender=this.version.pc.getSenders()[0]);return this._sender.replaceTrack(t.getAudioTracks()[0]).then((function(){n._updateInputStreamSource(t);return o()}))}this.stream=e?b(t):t;return o()};v.prototype._onInputDevicesChanged=function(){this.stream&&this.stream.getAudioTracks().every((function(e){return"ended"===e.readyState}))&&this._shouldManageStream&&this.openWithConstraints(!0)};v.prototype._onIceGatheringFailure=function(e){this._hasIceGatheringFailures=!0;this.onicegatheringfailure(e)};v.prototype._onMediaConnectionStateChange=function(e){var t=this._iceState;if(t!==e&&("connected"===e||"disconnected"===e||"failed"===e)){this._iceState=e;var n=void 0;switch(e){case"connected":if("disconnected"===t||"failed"===t){n="ICE liveliness check succeeded. Connection with Twilio restored";this._log.info(n);this.onreconnected(n)}else{n="Media connection established.";this._log.info(n);this.onconnected(n)}this._stopIceGatheringTimeout();this._hasIceGatheringFailures=!1;break;case"disconnected":n="ICE liveliness check failed. May be having trouble connecting to Twilio";this._log.info(n);this.ondisconnected(n);break;case"failed":n="Connection with Twilio was interrupted.";this._log.info(n);this.onfailed(n)}}};v.prototype._setSinkIds=function(e){if(!this._isSinkSupported)return Promise.reject(new a("Audio output selection is not supported by this browser"));this.sinkIds=new Set(e.forEach?e:[e]);return this.version?this._updateAudioOutputs():Promise.resolve()};v.prototype._startIceGatheringTimeout=function(){var e=this;this._stopIceGatheringTimeout();this._iceGatheringTimeoutId=setTimeout((function(){e._onIceGatheringFailure(h)}),p)};v.prototype._stopIceGatheringTimeout=function(){clearInterval(this._iceGatheringTimeoutId)};v.prototype._updateAudioOutputs=function(){var e=Array.from(this.sinkIds).filter((function(e){return!this.outputs.has(e)}),this),t=Array.from(this.outputs.keys()).filter((function(e){return!this.sinkIds.has(e)}),this),n=this,i=e.map(this._createAudioOutput,this);return Promise.all(i).then((function(){return Promise.all(t.map(n._removeAudioOutput,n))}))};v.prototype._createAudio=function(e){return new Audio(e)};v.prototype._createAudioOutput=function(e){var t=this._audioContext.createMediaStreamDestination();this._mediaStreamSource.connect(t);var n=this._createAudio();S(n,t.stream);var i=this;return n.setSinkId(e).then((function(){return n.play()})).then((function(){i.outputs.set(e,{audio:n,dest:t})}))};v.prototype._removeAudioOutputs=function(){if(this._masterAudio&&void 0!==this._masterAudioDeviceId){this._disableOutput(this,this._masterAudioDeviceId);this.outputs.delete(this._masterAudioDeviceId);this._masterAudioDeviceId=null;this._masterAudio.paused||this._masterAudio.pause();void 0!==this._masterAudio.srcObject?this._masterAudio.srcObject=null:this._masterAudio.src="";this._masterAudio=null}return Array.from(this.outputs.keys()).map(this._removeAudioOutput,this)};v.prototype._disableOutput=function(e,t){var n=e.outputs.get(t);if(n){if(n.audio){n.audio.pause();n.audio.src=""}n.dest&&n.dest.disconnect()}};v.prototype._reassignMasterOutput=function(e,t){var n=e.outputs.get(t);e.outputs.delete(t);var i=this,r=Array.from(e.outputs.keys())[0]||"default";return n.audio.setSinkId(r).then((function(){i._disableOutput(e,r);e.outputs.set(r,n);e._masterAudioDeviceId=r})).catch((function(){e.outputs.set(t,n);i._log.info("Could not reassign master output. Attempted to roll back.")}))};v.prototype._removeAudioOutput=function(e){if(this._masterAudioDeviceId===e)return this._reassignMasterOutput(this,e);this._disableOutput(this,e);this.outputs.delete(e);return Promise.resolve()};v.prototype._onAddTrack=function(e,t){var n=e._masterAudio=this._createAudio();S(n,t);n.play();var i=Array.from(e.outputs.keys())[0]||"default";e._masterAudioDeviceId=i;e.outputs.set(i,{audio:n});e._mediaStreamSource=e._audioContext.createMediaStreamSource(t);e.pcStream=t;e._updateAudioOutputs()};v.prototype._fallbackOnAddTrack=function(e,t){var n=document&&document.createElement("audio");n.autoplay=!0;S(n,t)||e._log.info("Error attaching stream to element.");e.outputs.set("default",{audio:n})};v.prototype._setEncodingParameters=function(e){if(e&&this._sender&&"function"==typeof this._sender.getParameters&&"function"==typeof this._sender.setParameters){var t=this._sender.getParameters();if(t.priority||t.encodings&&t.encodings.length){t.priority="high";t.encodings&&t.encodings.length&&t.encodings.forEach((function(e){e.priority="high";e.networkPriority="high"}));this._sender.setParameters(t)}}};v.prototype._setupPeerConnection=function(e,t){var n=this,i=this,r=new(this.options.rtcpcFactory||u);r.create(e,t);_(r.pc,this.stream);var o="ontrack"in r.pc?"ontrack":"onaddstream";r.pc[o]=function(e){var t=i._remoteStream=e.stream||e.streams[0];"function"==typeof r.pc.getSenders&&(n._sender=r.pc.getSenders()[0]);i._isSinkSupported?i._onAddTrack(i,t):i._fallbackOnAddTrack(i,t);i._startPollingVolume()};return r};v.prototype._maybeSetIceAggressiveNomination=function(e){return this.options.forceAggressiveIceNomination?d(e):e};v.prototype._setupChannel=function(){var e=this,t=this.version.pc;this.version.pc.onopen=function(){e.status="open";e.onopen()};this.version.pc.onstatechange=function(){if(e.version.pc&&"stable"===e.version.pc.readyState){e.status="open";e.onopen()}};this.version.pc.onsignalingstatechange=function(){var n=t.signalingState;e._log.info('signalingState is "'+n+'"');if(e.version.pc&&"stable"===e.version.pc.signalingState){e.status="open";e.onopen()}e.onsignalingstatechange(t.signalingState)};t.onconnectionstatechange=function(){e._log.info('pc.connectionState is "'+t.connectionState+'"');e.onpcconnectionstatechange(t.connectionState);e._onMediaConnectionStateChange(t.connectionState)};t.onicecandidate=function(t){var n=t.candidate;if(n){e._hasIceCandidates=!0;e.onicecandidate(n);e._setupRTCIceTransportListener()}e._log.info("ICE Candidate: "+JSON.stringify(n))};t.onicegatheringstatechange=function(){var n=t.iceGatheringState;if("gathering"===n)e._startIceGatheringTimeout();else if("complete"===n){e._stopIceGatheringTimeout();e._hasIceCandidates||e._onIceGatheringFailure(f);e._hasIceCandidates&&e._hasIceGatheringFailures&&e._startIceGatheringTimeout()}e._log.info('pc.iceGatheringState is "'+t.iceGatheringState+'"');e.onicegatheringstatechange(n)};t.oniceconnectionstatechange=function(){e._log.info('pc.iceConnectionState is "'+t.iceConnectionState+'"');e.oniceconnectionstatechange(t.iceConnectionState);e._onMediaConnectionStateChange(t.iceConnectionState)}};v.prototype._initializeMediaStream=function(e,t){if("open"===this.status)return!1;if("disconnected"===this.pstream.status){this.onerror({info:{code:31e3,message:"Cannot establish connection. Client is disconnected",twilioError:new s.ConnectionDisconnected}});this.close();return!1}this.version=this._setupPeerConnection(e,t);this._setupChannel();return!0};v.prototype._removeReconnectionListeners=function(){if(this.pstream){this.pstream.removeListener("answer",this._onAnswerOrRinging);this.pstream.removeListener("hangup",this._onHangup)}};v.prototype._setupRTCDtlsTransportListener=function(){var e=this,t=this.getRTCDtlsTransport();if(t&&!t.onstatechange){var n=function(){e._log.info('dtlsTransportState is "'+t.state+'"');e.ondtlstransportstatechange(t.state)};n();t.onstatechange=n}};v.prototype._setupRTCIceTransportListener=function(){var e=this,t=this._getRTCIceTransport();t&&!t.onselectedcandidatepairchange&&(t.onselectedcandidatepairchange=function(){return e.onselectedcandidatepairchange(t.getSelectedCandidatePair())})};v.prototype.iceRestart=function(){var e=this;if(this.options.enableIceRestart){this._log.info("Attempting to restart ICE...");this._hasIceCandidates=!1;this.version.createOffer(this.options.maxAverageBitrate,this.codecPreferences,{iceRestart:!0}).then((function(){e._removeReconnectionListeners();e._onAnswerOrRinging=function(t){e._removeReconnectionListeners();if(t.sdp&&"have-local-offer"===e.version.pc.signalingState){var n=e._maybeSetIceAggressiveNomination(t.sdp);e._answerSdp=n;"closed"!==e.status&&e.version.processAnswer(e.codecPreferences,n,null,(function(t){var n=t&&t.message?t.message:t;e._log.info("Failed to process answer during ICE Restart. Error: "+n)}))}else{var i="Invalid state or param during ICE Restart:hasSdp:"+!!t.sdp+", signalingState:"+e.version.pc.signalingState;e._log.info(i)}};e._onHangup=function(){e._log.info("Received hangup during ICE Restart");e._removeReconnectionListeners()};e.pstream.on("answer",e._onAnswerOrRinging);e.pstream.on("hangup",e._onHangup);e.pstream.reinvite(e.version.getSDP(),e.callSid)})).catch((function(t){var n=t&&t.message?t.message:t;e._log.info("Failed to createOffer during ICE Restart. Error: "+n);e.onfailed(n)}))}};v.prototype.makeOutgoingCall=function(e,t,n,i,r,a){var s=this;if(this._initializeMediaStream(i,r)){var c=this;this.callSid=n;this._onAnswerOrRinging=function(e){if(e.sdp){var t=s._maybeSetIceAggressiveNomination(e.sdp);c._answerSdp=t;"closed"!==c.status&&c.version.processAnswer(s.codecPreferences,t,l,u);c.pstream.removeListener("answer",c._onAnswerOrRinging);c.pstream.removeListener("ringing",c._onAnswerOrRinging)}};this.pstream.on("answer",this._onAnswerOrRinging);this.pstream.on("ringing",this._onAnswerOrRinging);this.version.createOffer(this.options.maxAverageBitrate,this.codecPreferences,{audio:!0},d,p)}function l(){c.options&&c._setEncodingParameters(c.options.dscp);a(c.version.pc)}function u(e){var t=e.message||e;c.onerror({info:{code:31e3,message:"Error processing answer: "+t,twilioError:new o.ClientRemoteDescFailed}})}function d(){if("closed"!==c.status){c.pstream.invite(c.version.getSDP(),c.callSid,t);c._setupRTCDtlsTransportListener()}}function p(e){var t=e.message||e;c.onerror({info:{code:31e3,message:"Error creating the offer: "+t,twilioError:new o.ClientLocalDescFailed}})}};v.prototype.answerIncomingCall=function(e,t,n,i,r){if(this._initializeMediaStream(n,i)){t=this._maybeSetIceAggressiveNomination(t);this._answerSdp=t.replace(/^a=setup:actpass$/gm,"a=setup:passive");this.callSid=e;var a=this;this.version.processSDP(this.options.maxAverageBitrate,this.codecPreferences,t,{audio:!0},s,c)}function s(){if("closed"!==a.status){a.pstream.answer(a.version.getSDP(),e);a.options&&a._setEncodingParameters(a.options.dscp);r(a.version.pc);a._setupRTCDtlsTransportListener()}}function c(e){var t=e.message||e;a.onerror({info:{code:31e3,message:"Error creating the answer: "+t,twilioError:new o.ClientRemoteDescFailed}})}};v.prototype.close=function(){if(this.version&&this.version.pc){"closed"!==this.version.pc.signalingState&&this.version.pc.close();this.version.pc=null}if(this.stream){this.mute(!1);this._stopStream(this.stream)}this.stream=null;this._removeReconnectionListeners();this._stopIceGatheringTimeout();Promise.all(this._removeAudioOutputs()).catch((function(){}));this._mediaStreamSource&&this._mediaStreamSource.disconnect();this._inputAnalyser&&this._inputAnalyser.disconnect();this._outputAnalyser&&this._outputAnalyser.disconnect();this._inputAnalyser2&&this._inputAnalyser2.disconnect();this._outputAnalyser2&&this._outputAnalyser2.disconnect();this.status="closed";this.onclose()};v.prototype.reject=function(e){this.callSid=e};v.prototype.ignore=function(e){this.callSid=e};v.prototype.mute=function(e){this.isMuted=e;this.stream&&(this._sender&&this._sender.track?this._sender.track.enabled=!e:("function"==typeof this.stream.getAudioTracks?this.stream.getAudioTracks():this.stream.audioTracks).forEach((function(t){t.enabled=!e})))};v.prototype.getOrCreateDTMFSender=function(){if(this._dtmfSender||this._dtmfSenderUnsupported)return this._dtmfSender||null;var e=this,t=this.version.pc;if(!t){this._log.info("No RTCPeerConnection available to call createDTMFSender on");return null}if("function"==typeof t.getSenders&&("function"==typeof RTCDTMFSender||"function"==typeof RTCDtmfSender)){var n=t.getSenders().find((function(e){return e.dtmf}));if(n){this._log.info("Using RTCRtpSender#dtmf");this._dtmfSender=n.dtmf;return this._dtmfSender}}if("function"==typeof t.createDTMFSender&&"function"==typeof t.getLocalStreams){var i=t.getLocalStreams().map((function(t){var n=e._getAudioTracks(t);return n&&n[0]}))[0];if(!i){this._log.info("No local audio MediaStreamTrack available on the RTCPeerConnection to pass to createDTMFSender");return null}this._log.info("Creating RTCDTMFSender");this._dtmfSender=t.createDTMFSender(i);return this._dtmfSender}this._log.info("RTCPeerConnection does not support RTCDTMFSender");this._dtmfSenderUnsupported=!0;return null};v.prototype.getRTCDtlsTransport=function(){var e=this.version&&this.version.pc&&"function"==typeof this.version.pc.getSenders&&this.version.pc.getSenders()[0];return e&&e.transport||null};v.prototype._canStopMediaStreamTrack=function(){return"function"==typeof MediaStreamTrack.prototype.stop};v.prototype._getAudioTracks=function(e){return"function"==typeof e.getAudioTracks?e.getAudioTracks():e.audioTracks};v.prototype._getRTCIceTransport=function(){var e=this.getRTCDtlsTransport();return e&&e.iceTransport||null};v.protocol=u.test()?new u:null;function _(e,t){"function"==typeof e.addTrack?t.getAudioTracks().forEach((function(n){e.addTrack(n,t)})):e.addStream(t)}function b(e){var t="undefined"!=typeof MediaStream?new MediaStream:new webkitMediaStream;e.getAudioTracks().forEach(t.addTrack,t);return t}function y(e,t){"function"==typeof e.removeTrack?e.getSenders().forEach((function(t){e.removeTrack(t)})):e.removeStream(t)}function S(e,t){if(void 0!==e.srcObject)e.srcObject=t;else if(void 0!==e.mozSrcObject)e.mozSrcObject=t;else{if(void 0===e.src)return!1;var n=e.options.window||window;e.src=(n.URL||n.webkitURL).createObjectURL(t)}return!0}v.enabled=u.test();t.exports=v},{"../errors":12,"../log":14,"../util":33,"./rtcpc":25,"./sdp":26}],25:[function(e,t,n){(function(n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=e("rtcpeerconnection-shim"),o=e("../log").default,a=e("./sdp"),s=a.setCodecPreferences,c=a.setMaxAverageBitrate,l=e("../util");function u(){if("undefined"!=typeof window)if(l.isLegacyEdge())this.RTCPeerConnection=new r("undefined"!=typeof window?window:n);else if("function"==typeof window.RTCPeerConnection)this.RTCPeerConnection=window.RTCPeerConnection;else if("function"==typeof window.webkitRTCPeerConnection)this.RTCPeerConnection=webkitRTCPeerConnection;else if("function"==typeof window.mozRTCPeerConnection){this.RTCPeerConnection=mozRTCPeerConnection;window.RTCSessionDescription=mozRTCSessionDescription;window.RTCIceCandidate=mozRTCIceCandidate}else this.log.info("No RTCPeerConnection implementation available");else this.log.info("No RTCPeerConnection implementation available. The window object was not found.")}u.prototype.create=function(e,t){this.log=o.getInstance();this.pc=new this.RTCPeerConnection(t,e)};u.prototype.createModernConstraints=function(e){if(void 0===e)return null;var t=Object.assign({},e);if("undefined"==typeof webkitRTCPeerConnection||l.isLegacyEdge()){void 0!==e.audio&&(t.offerToReceiveAudio=e.audio);void 0!==e.video&&(t.offerToReceiveVideo=e.video)}else{t.mandatory={};void 0!==e.audio&&(t.mandatory.OfferToReceiveAudio=e.audio);void 0!==e.video&&(t.mandatory.OfferToReceiveVideo=e.video)}delete t.audio;delete t.video;return t};u.prototype.createOffer=function(e,t,n,i,r){var o=this;n=this.createModernConstraints(n);return p(this.pc.createOffer,this.pc)(n).then((function(n){if(!o.pc)return Promise.resolve();var i=c(n.sdp,e);return f(o.pc.setLocalDescription,o.pc)(new RTCSessionDescription({type:"offer",sdp:s(i,t)}))})).then(i,r)};u.prototype.createAnswer=function(e,t,n,i,r){var o=this;n=this.createModernConstraints(n);return p(this.pc.createAnswer,this.pc)(n).then((function(n){if(!o.pc)return Promise.resolve();var i=c(n.sdp,e);return f(o.pc.setLocalDescription,o.pc)(new RTCSessionDescription({type:"answer",sdp:s(i,t)}))})).then(i,r)};u.prototype.processSDP=function(e,t,n,i,r,o){var a=this;n=s(n,t);var c=new RTCSessionDescription({sdp:n,type:"offer"});return f(this.pc.setRemoteDescription,this.pc)(c).then((function(){a.createAnswer(e,t,i,r,o)}))};u.prototype.getSDP=function(){return this.pc.localDescription.sdp};u.prototype.processAnswer=function(e,t,n,i){if(!this.pc)return Promise.resolve();t=s(t,e);return f(this.pc.setRemoteDescription,this.pc)(new RTCSessionDescription({sdp:t,type:"answer"})).then(n,i)};u.test=function(){if("object"===("undefined"==typeof navigator?"undefined":i(navigator))){var e=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.getUserMedia;if(l.isLegacyEdge(navigator))return!1;if(e&&"function"==typeof window.RTCPeerConnection)return!0;if(e&&"function"==typeof window.webkitRTCPeerConnection)return!0;if(e&&"function"==typeof window.mozRTCPeerConnection){try{if("function"!=typeof(new window.mozRTCPeerConnection).getLocalStreams)return!1}catch(e){return!1}return!0}if("undefined"!=typeof RTCIceGatherer)return!0}return!1};function d(e,t,n){return function(){var i=Array.prototype.slice.call(arguments);return new Promise((function(n){n(e.apply(t,i))})).catch((function(){return new Promise((function(r,o){e.apply(t,n?[r,o].concat(i):i.concat([r,o]))}))}))}}function p(e,t){return d(e,t,!0)}function f(e,t){return d(e,t,!1)}t.exports=u}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../log":14,"../util":33,"./sdp":26,"rtcpeerconnection-shim":54}],26:[function(e,t,n){"use strict";var i=function(){function e(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){n.push(a.value);if(t&&n.length===t)break}}catch(e){r=!0;o=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=e("../util"),o={0:"PCMU",8:"PCMA"},a=111,s=51e4,c=6e3;function l(e){var t=/a=rtpmap:(\d+) (\S+)/m.exec(e)||[null,"",""],n=i(t,3),r=n[1],o=n[2],a=new RegExp("a=fmtp:"+r+" (\\S+)","m").exec(e)||[null,""];return{codecName:o,codecParams:i(a,2)[1]}}function u(e){return r.isChrome(window,window.navigator)?e.split("\n").filter((function(e){return-1===e.indexOf("a=ice-lite")})).join("\n"):e}function d(e,t){if("number"!=typeof t||t<c||t>s)return e;var n=/a=rtpmap:(\d+) opus/m.exec(e),i=n&&n.length?n[1]:a,r=new RegExp("a=fmtp:"+i);return e.split("\n").map((function(e){return r.test(e)?e+";maxaveragebitrate="+t:e})).join("\n")}function p(e,t){var n=f(e);return[e.split("\r\nm=")[0]].concat(n.map((function(e){if(!/^m=(audio|video)/.test(e))return e;var n=e.match(/^m=(audio|video)/)[1],i=h(e),r=m(i,t),o=g(r,e),a=i.get("pcma")||[],s=i.get("pcmu")||[];return("audio"===n?new Set(a.concat(s)):new Set).has(r[0])?o.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):o}))).join("\r\n")}function f(e,t,n){return e.replace(/\r\n\r\n$/,"\r\n").split("\r\nm=").slice(1).map((function(e){return"m="+e})).filter((function(e){var i=new RegExp("m="+(t||".*"),"gm"),r=new RegExp("a="+(n||".*"),"gm");return i.test(e)&&r.test(e)}))}function h(e){return Array.from(v(e)).reduce((function(e,t){var n=t[0],i=t[1],r=e.get(i)||[];return e.set(i,r.concat(n))}),new Map)}function m(e,t){t=t.map((function(e){return e.toLowerCase()}));var n=r.flatMap(t,(function(t){return e.get(t)||[]})),i=r.difference(Array.from(e.keys()),t),o=r.flatMap(i,(function(t){return e.get(t)}));return n.concat(o)}function g(e,t){var n=t.split("\r\n"),i=n[0],r=n.slice(1);return[i=i.replace(/([0-9]+\s?)+$/,e.join(" "))].concat(r).join("\r\n")}function v(e){return _(e).reduce((function(t,n){var i=new RegExp("a=rtpmap:"+n+" ([^/]+)"),r=e.match(i),a=r?r[1].toLowerCase():o[n]?o[n].toLowerCase():"";return t.set(n,a)}),new Map)}function _(e){var t=e.split("\r\n")[0].match(/([0-9]+)/g);return t?t.slice(1).map((function(e){return parseInt(e,10)})):[]}t.exports={getPreferredCodecInfo:l,setCodecPreferences:p,setIceAggressiveNomination:u,setMaxAverageBitrate:d}},{"../util":33}],27:[function(e,t,n){"use strict";var i=e("../errors"),r=i.NotSupportedError,o=i.InvalidArgumentError,a=e("./mockrtcstatsreport"),s="PeerConnection is null",c="WebRTC statistics are unsupported";function l(e,t){t=Object.assign({createRTCSample:d},t);if(!e)return Promise.reject(new o(s));if("function"!=typeof e.getStats)return Promise.reject(new r(c));var n=void 0;try{n=e.getStats()}catch(t){n=new Promise((function(t){return e.getStats(t)})).then(a.fromRTCStatsResponse)}return n.then(t.createRTCSample)}function u(){}function d(e){var t=null,n=new u,i=void 0;Array.from(e.values()).forEach((function(r){if(!r.isRemote){var o=r.type.replace("-","");i=i||r.timestamp;if(r.remoteId){var a=e.get(r.remoteId);a&&a.roundTripTime&&(n.rtt=1e3*a.roundTripTime)}switch(o){case"inboundrtp":n.timestamp=n.timestamp||r.timestamp;n.jitter=1e3*r.jitter;n.packetsLost=r.packetsLost;n.packetsReceived=r.packetsReceived;n.bytesReceived=r.bytesReceived;break;case"outboundrtp":n.timestamp=r.timestamp;n.packetsSent=r.packetsSent;n.bytesSent=r.bytesSent;if(r.codecId){var s=e.get(r.codecId);n.codecName=s?s.mimeType&&s.mimeType.match(/(.*\/)?(.*)/)[2]:r.codecId}break;case"transport":t=r.id}}}));n.timestamp||(n.timestamp=i);var r=e.get(t);if(!r)return n;var o=e.get(r.selectedCandidatePairId);if(!o)return n;var a=e.get(o.localCandidateId),s=e.get(o.remoteCandidateId);n.rtt||(n.rtt=o&&1e3*o.currentRoundTripTime);Object.assign(n,{localAddress:a&&a.ip,remoteAddress:s&&s.ip});return n}t.exports=l},{"../errors":12,"./mockrtcstatsreport":22}],28:[function(e,t,n){var i=e("events").EventEmitter;function r(){Object.defineProperties(this,{_eventEmitter:{value:new i},_handlers:{value:{}}})}r.prototype.dispatchEvent=function(e){return this._eventEmitter.emit(e.type,e)};r.prototype.addEventListener=function(){var e;return(e=this._eventEmitter).addListener.apply(e,arguments)};r.prototype.removeEventListener=function(){var e;return(e=this._eventEmitter).removeListener.apply(e,arguments)};r.prototype._defineEventHandler=function(e){var t=this;Object.defineProperty(this,"on"+e,{get:function(){return t._handlers[e]},set:function(n){var i=t._handlers[e];if(i&&("function"==typeof n||null==n)){t._handlers[e]=null;t.removeEventListener(e,i)}if("function"==typeof n){t._handlers[e]=n;t.addEventListener(e,n)}}})};t.exports=r},{events:46}],29:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function e(t){i(this,e);Object.defineProperties(this,{deviceId:{get:function(){return t.deviceId}},groupId:{get:function(){return t.groupId}},kind:{get:function(){return t.kind}},label:{get:function(){return t.label}}})};t.exports=r},{}],30:[function(e,t,n){var i=e("./eventtarget"),r=e("util").inherits,o=500,a="undefined"!=typeof navigator&&navigator.mediaDevices;function s(){i.call(this);this._defineEventHandler("devicechange");this._defineEventHandler("deviceinfochange");var e=[];Object.defineProperties(this,{_deviceChangeIsNative:{value:f(this,"devicechange")},_deviceInfoChangeIsNative:{value:f(this,"deviceinfochange")},_knownDevices:{value:e},_pollInterval:{value:null,writable:!0}});"function"==typeof a.enumerateDevices&&a.enumerateDevices().then((function(t){t.sort(h).forEach([].push,e)}));this._eventEmitter.on("newListener",function(e){"devicechange"!==e&&"deviceinfochange"!==e||(this._pollInterval=this._pollInterval||setInterval(d.bind(null,this),o))}.bind(this));this._eventEmitter.on("removeListener",function(){if(this._pollInterval&&!u(this)){clearInterval(this._pollInterval);this._pollInterval=null}}.bind(this))}r(s,i);a&&"function"==typeof a.enumerateDevices&&(s.prototype.enumerateDevices=function(){return a.enumerateDevices.apply(a,arguments)});s.prototype.getUserMedia=function(){return a.getUserMedia.apply(a,arguments)};function c(e,t){var n=t.reduce((function(e,t){return e.set(t.deviceId,t.label||null)}),new Map);return e.some((function(e){var t=n.get(e.deviceId);return void 0!==t&&t!==e.label}))}function l(e,t){return e.length!==t.length||p("deviceId",e,t)}function u(e){return["devicechange","deviceinfochange"].reduce((function(t,n){return t+e._eventEmitter.listenerCount(n)}),0)>0}function d(e){a.enumerateDevices().then((function(t){var n=e._knownDevices,i=n.slice();[].splice.apply(n,[0,n.length].concat(t.sort(h)));!e._deviceChangeIsNative&&l(n,i)&&e.dispatchEvent(new Event("devicechange"));!e._deviceInfoChangeIsNative&&c(n,i)&&e.dispatchEvent(new Event("deviceinfochange"))}))}function p(e,t,n){return t.some((function(t,i){return t[e]!==n[i][e]}))}function f(e,t){var n="on"+t;function i(t){e.dispatchEvent(t)}if(n in a){"addEventListener"in a?a.addEventListener(t,i):a[n]=i;return!0}return!1}function h(e,t){return e.deviceId<t.deviceId}t.exports=a?new s:null},{"./eventtarget":28,util:58}],31:[function(e,t,n){"use strict";var i=e("./asyncQueue").AsyncQueue,r=e("@twilio/audioplayer"),o=e("./errors").InvalidArgumentError;function a(e,t,n){if(!(this instanceof a))return new a(e,t,n);if(!e||!t)throw new o("name and url are required arguments");(n=Object.assign({AudioFactory:"undefined"!=typeof Audio?Audio:null,maxDuration:0,shouldLoop:!1},n)).AudioPlayer=n.audioContext?r.bind(r,n.audioContext):n.AudioFactory;Object.defineProperties(this,{_activeEls:{value:new Map},_Audio:{value:n.AudioPlayer},_isSinkSupported:{value:null!==n.AudioFactory&&"function"==typeof n.AudioFactory.prototype.setSinkId},_maxDuration:{value:n.maxDuration},_maxDurationTimeout:{value:null,writable:!0},_operations:{value:new i},_playPromise:{value:null,writable:!0},_shouldLoop:{value:n.shouldLoop},_sinkIds:{value:["default"]},isPlaying:{enumerable:!0,get:function(){return!!this._playPromise}},name:{enumerable:!0,value:e},url:{enumerable:!0,value:t}});this._Audio&&this._play(!0,!1)}function s(e){if(e){e.pause();e.src="";e.srcObject=null;e.load()}}a.prototype._playAudioElement=function(e,t,n){var i=this,r=this._activeEls.get(e);if(!r)throw new o('sinkId: "'+e+"\" doesn't have an audio element");r.muted=!!t;r.loop=!!n;return r.play().then((function(){return r})).catch((function(t){s(r);i._activeEls.delete(e);throw t}))};a.prototype._play=function(e,t){this.isPlaying&&this._stop();this._maxDuration>0&&(this._maxDurationTimeout=setTimeout(this._stop.bind(this),this._maxDuration));t="boolean"==typeof t?t:this._shouldLoop;var n=this;return this._playPromise=Promise.all(this._sinkIds.map((function(i){if(!n._Audio)return Promise.resolve();var r=n._activeEls.get(i);if(r)return n._playAudioElement(i,e,t);"function"==typeof(r=new n._Audio(n.url)).setAttribute&&r.setAttribute("crossorigin","anonymous");return new Promise((function(e){r.addEventListener("canplaythrough",e)})).then((function(){return(n._isSinkSupported?r.setSinkId(i):Promise.resolve()).then((function(){n._activeEls.set(i,r);return n._playPromise?n._playAudioElement(i,e,t):Promise.resolve()}))}))})))};a.prototype._stop=function(){var e=this;this._activeEls.forEach((function(t,n){if(e._sinkIds.includes(n)){t.pause();t.currentTime=0}else{s(t);e._activeEls.delete(n)}}));clearTimeout(this._maxDurationTimeout);this._playPromise=null;this._maxDurationTimeout=null};a.prototype.setSinkIds=function(e){if(this._isSinkSupported){e=e.forEach?e:[e];[].splice.apply(this._sinkIds,[0,this._sinkIds.length].concat(e))}};a.prototype.stop=function(){var e=this;this._operations.enqueue((function(){e._stop();return Promise.resolve()}))};a.prototype.play=function(){var e=this;return this._operations.enqueue((function(){return e._play()}))};t.exports=a},{"./asyncQueue":4,"./errors":12,"@twilio/audioplayer":38}],32:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){i(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i};Object.defineProperty(n,"__esModule",{value:!0});var s=e("events"),c=e("./errors"),l=e("./util"),u=e("./rtc/stats"),d=e("./rtc/mos"),p=5,f=0,h=3,m=1e3,g=5e3,v={audioInputLevel:{maxDuration:10},audioOutputLevel:{maxDuration:10},bytesReceived:{clearCount:2,min:1,raiseCount:3,sampleCount:3},bytesSent:{clearCount:2,min:1,raiseCount:3,sampleCount:3},jitter:{max:30},mos:{min:3},packetsLostFraction:{max:1},rtt:{max:400}};function _(e,t){return t.reduce((function(t,n){return t+(n>e?1:0)}),0)}function b(e,t){return t.reduce((function(t,n){return t+(n<e?1:0)}),0)}var y=function(e){r(t,e);function t(t){var n=e.call(this)||this;n._activeWarnings=new Map;n._currentStreaks=new Map;n._inputVolumes=[];n._outputVolumes=[];n._sampleBuffer=[];n._warningsEnabled=!0;t=t||{};n._getRTCStats=t.getRTCStats||u;n._mos=t.Mos||d;n._peerConnection=t.peerConnection;n._thresholds=o(o({},v),t.thresholds);var i=Object.values(n._thresholds).map((function(e){return e.sampleCount})).filter((function(e){return!!e}));n._maxSampleCount=Math.max.apply(Math,a([p],i));n._peerConnection&&n.enable(n._peerConnection);return n}t.prototype.addVolumes=function(e,t){this._inputVolumes.push(e);this._outputVolumes.push(t)};t.prototype.disable=function(){clearInterval(this._sampleInterval);delete this._sampleInterval;return this};t.prototype.disableWarnings=function(){this._warningsEnabled&&this._activeWarnings.clear();this._warningsEnabled=!1;return this};t.prototype.enable=function(e){if(e){if(this._peerConnection&&e!==this._peerConnection)throw new c.InvalidArgumentError("Attempted to replace an existing PeerConnection in StatsMonitor.enable");this._peerConnection=e}if(!this._peerConnection)throw new c.InvalidArgumentError("Can not enable StatsMonitor without a PeerConnection");this._sampleInterval=this._sampleInterval||setInterval(this._fetchSample.bind(this),m);return this};t.prototype.enableWarnings=function(){this._warningsEnabled=!0;return this};t.prototype.hasActiveWarning=function(e,t){var n=e+":"+t;return!!this._activeWarnings.get(n)};t.prototype._addSample=function(e){var t=this._sampleBuffer;t.push(e);t.length>this._maxSampleCount&&t.splice(0,t.length-this._maxSampleCount)};t.prototype._clearWarning=function(e,t,n){var i=e+":"+t,r=this._activeWarnings.get(i);if(r&&!(Date.now()-r.timeRaised<g)){this._activeWarnings.delete(i);this.emit("warning-cleared",o(o({},n),{name:e,threshold:{name:t,value:this._thresholds[e][t]}}))}};t.prototype._createSample=function(e,t){var n=t&&t.totals.bytesSent||0,i=t&&t.totals.bytesReceived||0,r=t&&t.totals.packetsSent||0,o=t&&t.totals.packetsReceived||0,a=t&&t.totals.packetsLost||0,s=e.bytesSent-n,c=e.bytesReceived-i,u=e.packetsSent-r,d=e.packetsReceived-o,p=e.packetsLost-a,f=d+p,h=f>0?p/f*100:0,m=e.packetsReceived+e.packetsLost,g=m>0?e.packetsLost/m*100:100,v="number"!=typeof e.rtt&&t?t.rtt:e.rtt;return{audioInputLevel:Math.round(l.average(this._inputVolumes.splice(0))),audioOutputLevel:Math.round(l.average(this._outputVolumes.splice(0))),bytesReceived:c,bytesSent:s,codecName:e.codecName,jitter:e.jitter,mos:this._mos.calculate(v,e.jitter,t&&h),packetsLost:p,packetsLostFraction:h,packetsReceived:d,packetsSent:u,rtt:v,timestamp:e.timestamp,totals:{bytesReceived:e.bytesReceived,bytesSent:e.bytesSent,packetsLost:e.packetsLost,packetsLostFraction:g,packetsReceived:e.packetsReceived,packetsSent:e.packetsSent}}};t.prototype._fetchSample=function(){var e=this;this._getSample().then((function(t){e._addSample(t);e._raiseWarnings();e.emit("sample",t)})).catch((function(t){e.disable();e.emit("error",t)}))};t.prototype._getSample=function(){var e=this;return this._getRTCStats(this._peerConnection).then((function(t){var n=null;e._sampleBuffer.length&&(n=e._sampleBuffer[e._sampleBuffer.length-1]);return e._createSample(t,n)}))};t.prototype._raiseWarning=function(e,t,n){var i=e+":"+t;if(!this._activeWarnings.has(i)){this._activeWarnings.set(i,{timeRaised:Date.now()});this.emit("warning",o(o({},n),{name:e,threshold:{name:t,value:this._thresholds[e][t]}}))}};t.prototype._raiseWarnings=function(){var e=this;this._warningsEnabled&&Object.keys(this._thresholds).forEach((function(t){return e._raiseWarningsForStat(t)}))};t.prototype._raiseWarningsForStat=function(e){var t=this._sampleBuffer,n=this._thresholds[e],i=n.clearCount||f,r=n.raiseCount||h,o=n.sampleCount||this._maxSampleCount,a=t.slice(-o),s=a.map((function(t){return t[e]}));if(!s.some((function(e){return null==e}))){var c;"number"==typeof n.max&&((c=_(n.max,s))>=r?this._raiseWarning(e,"max",{values:s,samples:a}):c<=i&&this._clearWarning(e,"max",{values:s,samples:a}));"number"==typeof n.min&&((c=b(n.min,s))>=r?this._raiseWarning(e,"min",{values:s,samples:a}):c<=i&&this._clearWarning(e,"min",{values:s,samples:a}));if("number"==typeof n.maxDuration&&t.length>1){var l=(a=t.slice(-2))[0][e],u=a[1][e],d=this._currentStreaks.get(e)||0,p=l===u?d+1:0;this._currentStreaks.set(e,p);p>=n.maxDuration?this._raiseWarning(e,"maxDuration",{value:p}):0===p&&this._clearWarning(e,"maxDuration",{value:d})}}};return t}(s.EventEmitter);n.default=y},{"./errors":12,"./rtc/mos":23,"./rtc/stats":27,"./util":33,events:46}],33:[function(e,t,n){(function(e){function t(e){if(!(this instanceof t))return new t(e);this.message=e}t.prototype.toString=function(){return"Twilio.Exception: "+this.message};function i(e){return e&&e.length?e.reduce((function(e,t){return e+t}))/e.length:0}function r(e,t,n){n=n||function(e){return e};var i=new Set(t.map(n));return e.filter((function(e){return!i.has(n(e))}))}function o(e){return!!e.userAgent.match("Electron")}function a(e,t){var n=!!t.userAgent.match("CriOS"),i=!!t.userAgent.match("HeadlessChrome"),r=void 0!==e.chrome&&"Google Inc."===t.vendor&&-1===t.userAgent.indexOf("OPR")&&-1===t.userAgent.indexOf("Edge");return n||o(t)||r||i}function s(t){return!!(t=t||("undefined"==typeof window?e.navigator:window.navigator))&&"string"==typeof t.userAgent&&/firefox|fxios/i.test(t.userAgent)}function c(t){return!!(t=t||("undefined"==typeof window?e.navigator:window.navigator))&&"string"==typeof t.userAgent&&/edge\/\d+/i.test(t.userAgent)}function l(e){return!!e.vendor&&-1!==e.vendor.indexOf("Apple")&&e.userAgent&&-1===e.userAgent.indexOf("CriOS")&&-1===e.userAgent.indexOf("FxiOS")}function u(e,t,n,i){if(void 0===e||void 0===t||void 0===n||void 0===i||void 0===n.prototype||void 0===i.prototype)return!1;if(a(e,t)&&n.prototype.addTransceiver){var r=new n,o=!0;try{r.addTransceiver("audio")}catch(e){o=!1}r.close();return o}return!!s(t)||!!l(t)&&"currentDirection"in i.prototype}function d(e){return e?e.split("&").reduce((function(e,t){var n=t.split("="),i=n[0],r=decodeURIComponent((n[1]||"").replace(/\+/g,"%20"));i&&(e[i]=r);return e}),{}):""}function p(e,t){var n=e instanceof Map||e instanceof Set?Array.from(e.values()):e;t=t||function(e){return e};return n.reduce((function(e,n){var i=t(n);return e.concat(i)}),[])}n.Exception=t;n.average=i;n.difference=r;n.isElectron=o;n.isChrome=a;n.isFirefox=s;n.isLegacyEdge=c;n.isSafari=l;n.isUnifiedPlanDefault=u;n.queryToJson=d;n.flatMap=p}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],34:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){i(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var o,a=e("events"),s=e("ws"),c=e("./errors"),l=e("./log"),u=e("backoff"),d=1e4,p=5e3,f=15e3;!function(e){e.Connecting="connecting";e.Closed="closed";e.Open="open"}(o=n.WSTransportState||(n.WSTransportState={}));var h=function(e){r(t,e);function t(t,n){void 0===n&&(n={});var i=e.call(this)||this;i.state=o.Closed;i._log=l.default.getInstance();i._shouldFallback=!1;i._uriIndex=0;i._moveUriIndex=function(){i._uriIndex++;i._uriIndex>=i._uris.length&&(i._uriIndex=0)};i._onSocketClose=function(e){i._log.info("Received websocket close event code: "+e.code+". Reason: "+e.reason);if(1006===e.code||1015===e.code){i.emit("error",{code:31005,message:e.reason||"Websocket connection to Twilio's signaling servers were unexpectedly ended. If this is happening consistently, there may be an issue resolving the hostname provided. If a region or an edge is being specified in Device setup, ensure it is valid.",twilioError:new c.SignalingErrors.ConnectionError});var t=i.state===o.Open||i._previousState===o.Open;!i._shouldFallback&&t||i._moveUriIndex();i._shouldFallback=!0}i._closeSocket()};i._onSocketError=function(e){i._log.info("WebSocket received error: "+e.message);i.emit("error",{code:31e3,message:e.message||"WSTransport socket error",twilioError:new c.SignalingErrors.ConnectionDisconnected})};i._onSocketMessage=function(e){i._setHeartbeatTimeout();i._socket&&"\n"===e.data?i._socket.send("\n"):i.emit("message",e)};i._onSocketOpen=function(){i._log.info("WebSocket opened successfully.");i._timeOpened=Date.now();i._shouldFallback=!1;i._setState(o.Open);clearTimeout(i._connectTimeout);i._setHeartbeatTimeout();i.emit("open")};i._connectTimeoutMs=n.connectTimeoutMs||p;var r=100;t&&t.length>1&&(r=Math.floor(4001*Math.random())+1e3);var a={factor:2,initialDelay:r,maxDelay:"number"==typeof n.backoffMaxMs?Math.max(n.backoffMaxMs,3e3):2e4,randomisationFactor:.4};i._log.info("Initializing transport backoff using config: ",a);i._backoff=u.exponential(a);i._uris=t;i._WebSocket=n.WebSocket||s;i._backoff.on("backoff",(function(e,t){i.state!==o.Closed&&i._log.info("Will attempt to reconnect WebSocket in "+t+"ms")}));i._backoff.on("ready",(function(e){i.state!==o.Closed&&i._connect(e+1)}));return i}t.prototype.close=function(){this._log.info("WSTransport.close() called...");this._close()};t.prototype.open=function(){this._log.info("WSTransport.open() called...");!this._socket||this._socket.readyState!==s.CONNECTING&&this._socket.readyState!==s.OPEN?this._connect():this._log.info("WebSocket already open.")};t.prototype.send=function(e){if(!this._socket||this._socket.readyState!==s.OPEN)return!1;try{this._socket.send(e)}catch(e){this._log.info("Error while sending message:",e.message);this._closeSocket();return!1}return!0};t.prototype._close=function(){this._setState(o.Closed);this._closeSocket()};t.prototype._closeSocket=function(){clearTimeout(this._connectTimeout);clearTimeout(this._heartbeatTimeout);this._log.info("Closing and cleaning up WebSocket...");if(this._socket){this._socket.removeEventListener("close",this._onSocketClose);this._socket.removeEventListener("error",this._onSocketError);this._socket.removeEventListener("message",this._onSocketMessage);this._socket.removeEventListener("open",this._onSocketOpen);this._socket.readyState!==s.CONNECTING&&this._socket.readyState!==s.OPEN||this._socket.close();this._timeOpened&&Date.now()-this._timeOpened>d&&this._backoff.reset();this._backoff.backoff();delete this._socket;this.emit("close")}else this._log.info("No WebSocket to clean up.")};t.prototype._connect=function(e){var t=this;e?this._log.info("Attempting to reconnect (retry #"+e+")..."):this._log.info("Attempting to connect...");this._closeSocket();this._setState(o.Connecting);var n=null;try{n=new this._WebSocket(this._uris[this._uriIndex])}catch(e){this._log.info("Could not connect to endpoint:",e.message);this._close();this.emit("error",{code:31e3,message:e.message||"Could not connect to "+this._uris[this._uriIndex],twilioError:new c.SignalingErrors.ConnectionDisconnected});return}delete this._timeOpened;this._connectTimeout=setTimeout((function(){t._log.info("WebSocket connection attempt timed out.");t._moveUriIndex();t._closeSocket()}),this._connectTimeoutMs);n.addEventListener("close",this._onSocketClose);n.addEventListener("error",this._onSocketError);n.addEventListener("message",this._onSocketMessage);n.addEventListener("open",this._onSocketOpen);this._socket=n};t.prototype._setHeartbeatTimeout=function(){var e=this;clearTimeout(this._heartbeatTimeout);this._heartbeatTimeout=setTimeout((function(){e._log.info("No messages received in "+f/1e3+" seconds. Reconnecting...");e._shouldFallback=!0;e._closeSocket()}),f)};t.prototype._setState=function(e){this._previousState=this.state;this.state=e};Object.defineProperty(t.prototype,"uri",{get:function(){return this._uris[this._uriIndex]},enumerable:!0,configurable:!0});return t}(a.EventEmitter);n.default=h},{"./errors":12,"./log":14,backoff:40,events:46,ws:1}],35:[function(e,t,n){"use strict";var i=o(e("babel-runtime/regenerator")),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(e,i.key,i)}}return function(t,n,i){n&&e(t.prototype,n);i&&e(t,i);return t}}();function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(a,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});var u=e("./Deferred"),d=function(e){c(t,e);function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};a(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r._audioNode=null;r._pendingPlayDeferreds=[];r._loop=!1;r._src="";r._sinkId="default";"string"!=typeof n&&(i=n);r._audioContext=e;r._audioElement=new(i.AudioFactory||Audio);r._bufferPromise=r._createPlayDeferred().promise;r._destination=r._audioContext.destination;r._gainNode=r._audioContext.createGain();r._gainNode.connect(r._destination);r._XMLHttpRequest=i.XMLHttpRequestFactory||XMLHttpRequest;r.addEventListener("canplaythrough",(function(){r._resolvePlayDeferreds()}));"string"==typeof n&&(r.src=n);return r}r(t,[{key:"load",value:function(){this._load(this._src)}},{key:"pause",value:function(){if(!this.paused){this._audioElement.pause();this._audioNode.stop();this._audioNode.disconnect(this._gainNode);this._audioNode=null;this._rejectPlayDeferreds(new Error("The play() request was interrupted by a call to pause()."))}}},{key:"play",value:function(){return l(this,void 0,void 0,i.default.mark((function e(){var t,n=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.paused){e.next=6;break}e.next=3;return this._bufferPromise;case 3:if(this.paused){e.next=5;break}return e.abrupt("return");case 5:throw new Error("The play() request was interrupted by a call to pause().");case 6:this._audioNode=this._audioContext.createBufferSource();this._audioNode.loop=this.loop;this._audioNode.addEventListener("ended",(function(){n._audioNode&&n._audioNode.loop||n.dispatchEvent("ended")}));e.next=11;return this._bufferPromise;case 11:t=e.sent;if(!this.paused){e.next=14;break}throw new Error("The play() request was interrupted by a call to pause().");case 14:this._audioNode.buffer=t;this._audioNode.connect(this._gainNode);this._audioNode.start();if(!this._audioElement.srcObject){e.next=19;break}return e.abrupt("return",this._audioElement.play());case 19:case"end":return e.stop()}}),e,this)})))}},{key:"setSinkId",value:function(e){return l(this,void 0,void 0,i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"==typeof this._audioElement.setSinkId){t.next=2;break}throw new Error("This browser does not support setSinkId.");case 2:if(e!==this.sinkId){t.next=4;break}return t.abrupt("return");case 4:if("default"!==e){t.next=11;break}this.paused||this._gainNode.disconnect(this._destination);this._audioElement.srcObject=null;this._destination=this._audioContext.destination;this._gainNode.connect(this._destination);this._sinkId=e;return t.abrupt("return");case 11:t.next=13;return this._audioElement.setSinkId(e);case 13:if(!this._audioElement.srcObject){t.next=15;break}return t.abrupt("return");case 15:this._gainNode.disconnect(this._audioContext.destination);this._destination=this._audioContext.createMediaStreamDestination();this._audioElement.srcObject=this._destination.stream;this._sinkId=e;this._gainNode.connect(this._destination);case 20:case"end":return t.stop()}}),t,this)})))}},{key:"_createPlayDeferred",value:function(){var e=new u.default;this._pendingPlayDeferreds.push(e);return e}},{key:"_load",value:function(e){var t=this;this._src&&this._src!==e&&this.pause();this._src=e;this._bufferPromise=new Promise((function(n,r){return l(t,void 0,void 0,i.default.mark((function t(){var r;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",this._createPlayDeferred().promise);case 2:t.next=4;return p(this._audioContext,this._XMLHttpRequest,e);case 4:r=t.sent;this.dispatchEvent("canplaythrough");n(r);case 7:case"end":return t.stop()}}),t,this)})))}))}},{key:"_rejectPlayDeferreds",value:function(e){var t=this._pendingPlayDeferreds;t.splice(0,t.length).forEach((function(t){return(0,t.reject)(e)}))}},{key:"_resolvePlayDeferreds",value:function(e){var t=this._pendingPlayDeferreds;t.splice(0,t.length).forEach((function(t){return(0,t.resolve)(e)}))}},{key:"destination",get:function(){return this._destination}},{key:"loop",get:function(){return this._loop},set:function(e){if(!e&&this.loop&&!this.paused){var t=function e(){n._audioNode.removeEventListener("ended",e);n.pause()},n=this;this._audioNode.addEventListener("ended",t)}this._loop=e}},{key:"muted",get:function(){return 0===this._gainNode.gain.value},set:function(e){this._gainNode.gain.value=e?0:1}},{key:"paused",get:function(){return null===this._audioNode}},{key:"src",get:function(){return this._src},set:function(e){this._load(e)}},{key:"srcObject",get:function(){return this._audioElement.srcObject},set:function(e){this._audioElement.srcObject=e}},{key:"sinkId",get:function(){return this._sinkId}}]);return t}(e("./EventTarget").default);n.default=d;function p(e,t,n){return l(this,void 0,void 0,i.default.mark((function r(){var o,a;return i.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:(o=new t).open("GET",n,!0);o.responseType="arraybuffer";i.next=5;return new Promise((function(e){o.addEventListener("load",e);o.send()}));case 5:a=i.sent;i.prev=6;return i.abrupt("return",e.decodeAudioData(a.target.response));case 10:i.prev=10;i.t0=i.catch(6);return i.abrupt("return",new Promise((function(t){e.decodeAudioData(a.target.response,t)})));case 13:case"end":return i.stop()}}),r,this,[[6,10]])})))}},{"./Deferred":36,"./EventTarget":37,"babel-runtime/regenerator":39}],36:[function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(e,i.key,i)}}return function(t,n,i){n&&e(t.prototype,n);i&&e(t,i);return t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){var t=this;r(this,e);this.promise=new Promise((function(e,n){t._resolve=e;t._reject=n}))}i(e,[{key:"reject",get:function(){return this._reject}},{key:"resolve",get:function(){return this._resolve}}]);return e}();n.default=o},{}],37:[function(e,t,n){"use strict";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1;i.configurable=!0;"value"in i&&(i.writable=!0);Object.defineProperty(e,i.key,i)}}return function(t,n,i){n&&e(t.prototype,n);i&&e(t,i);return t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=e("events"),a=function(){function e(){r(this,e);this._eventEmitter=new o.EventEmitter}i(e,[{key:"addEventListener",value:function(e,t){return this._eventEmitter.addListener(e,t)}},{key:"dispatchEvent",value:function(e){for(var t,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return(t=this._eventEmitter).emit.apply(t,[e].concat(i))}},{key:"removeEventListener",value:function(e,t){return this._eventEmitter.removeListener(e,t)}}]);return e}();n.default=a},{events:46}],38:[function(e,t,n){"use strict";var i=e("./AudioPlayer");t.exports=i.default},{"./AudioPlayer":35}],39:[function(e,t,n){t.exports=e("regenerator-runtime")},{"regenerator-runtime":52}],40:[function(e,t,n){var i=e("./lib/backoff"),r=e("./lib/strategy/exponential"),o=e("./lib/strategy/fibonacci"),a=e("./lib/function_call.js");t.exports.Backoff=i;t.exports.FunctionCall=a;t.exports.FibonacciStrategy=o;t.exports.ExponentialStrategy=r;t.exports.fibonacci=function(e){return new i(new o(e))};t.exports.exponential=function(e){return new i(new r(e))};t.exports.call=function(e,t,n){var i=Array.prototype.slice.call(arguments);e=i[0];t=i.slice(1,i.length-1);n=i[i.length-1];return new a(e,t,n)}},{"./lib/backoff":41,"./lib/function_call.js":42,"./lib/strategy/exponential":43,"./lib/strategy/fibonacci":44}],41:[function(e,t,n){var i=e("events"),r=e("precond");function o(e){i.EventEmitter.call(this);this.backoffStrategy_=e;this.maxNumberOfRetry_=-1;this.backoffNumber_=0;this.backoffDelay_=0;this.timeoutID_=-1;this.handlers={backoff:this.onBackoff_.bind(this)}}e("util").inherits(o,i.EventEmitter);o.prototype.failAfter=function(e){r.checkArgument(e>0,"Expected a maximum number of retry greater than 0 but got %s.",e);this.maxNumberOfRetry_=e};o.prototype.backoff=function(e){r.checkState(-1===this.timeoutID_,"Backoff in progress.");if(this.backoffNumber_===this.maxNumberOfRetry_){this.emit("fail",e);this.reset()}else{this.backoffDelay_=this.backoffStrategy_.next();this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_);this.emit("backoff",this.backoffNumber_,this.backoffDelay_,e)}};o.prototype.onBackoff_=function(){this.timeoutID_=-1;this.emit("ready",this.backoffNumber_,this.backoffDelay_);this.backoffNumber_++};o.prototype.reset=function(){this.backoffNumber_=0;this.backoffStrategy_.reset();clearTimeout(this.timeoutID_);this.timeoutID_=-1};t.exports=o},{events:46,precond:48,util:58}],42:[function(e,t,n){var i=e("events"),r=e("precond"),o=e("util"),a=e("./backoff"),s=e("./strategy/fibonacci");function c(e,t,n){i.EventEmitter.call(this);r.checkIsFunction(e,"Expected fn to be a function.");r.checkIsArray(t,"Expected args to be an array.");r.checkIsFunction(n,"Expected callback to be a function.");this.function_=e;this.arguments_=t;this.callback_=n;this.lastResult_=[];this.numRetries_=0;this.backoff_=null;this.strategy_=null;this.failAfter_=-1;this.retryPredicate_=c.DEFAULT_RETRY_PREDICATE_;this.state_=c.State_.PENDING}o.inherits(c,i.EventEmitter);c.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3};c.DEFAULT_RETRY_PREDICATE_=function(e){return!0};c.prototype.isPending=function(){return this.state_==c.State_.PENDING};c.prototype.isRunning=function(){return this.state_==c.State_.RUNNING};c.prototype.isCompleted=function(){return this.state_==c.State_.COMPLETED};c.prototype.isAborted=function(){return this.state_==c.State_.ABORTED};c.prototype.setStrategy=function(e){r.checkState(this.isPending(),"FunctionCall in progress.");this.strategy_=e;return this};c.prototype.retryIf=function(e){r.checkState(this.isPending(),"FunctionCall in progress.");this.retryPredicate_=e;return this};c.prototype.getLastResult=function(){return this.lastResult_.concat()};c.prototype.getNumRetries=function(){return this.numRetries_};c.prototype.failAfter=function(e){r.checkState(this.isPending(),"FunctionCall in progress.");this.failAfter_=e;return this};c.prototype.abort=function(){if(!this.isCompleted()&&!this.isAborted()){this.isRunning()&&this.backoff_.reset();this.state_=c.State_.ABORTED;this.lastResult_=[new Error("Backoff aborted.")];this.emit("abort");this.doCallback_()}};c.prototype.start=function(e){r.checkState(!this.isAborted(),"FunctionCall is aborted.");r.checkState(this.isPending(),"FunctionCall already started.");var t=this.strategy_||new s;this.backoff_=e?e(t):new a(t);this.backoff_.on("ready",this.doCall_.bind(this,!0));this.backoff_.on("fail",this.doCallback_.bind(this));this.backoff_.on("backoff",this.handleBackoff_.bind(this));this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_);this.state_=c.State_.RUNNING;this.doCall_(!1)};c.prototype.doCall_=function(e){e&&this.numRetries_++;var t=["call"].concat(this.arguments_);i.EventEmitter.prototype.emit.apply(this,t);var n=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(n))};c.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)};c.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var e=Array.prototype.slice.call(arguments);this.lastResult_=e;i.EventEmitter.prototype.emit.apply(this,["callback"].concat(e));var t=e[0];if(t&&this.retryPredicate_(t))this.backoff_.backoff(t);else{this.state_=c.State_.COMPLETED;this.doCallback_()}}};c.prototype.handleBackoff_=function(e,t,n){this.emit("backoff",e,t,n)};t.exports=c},{"./backoff":41,"./strategy/fibonacci":44,events:46,precond:48,util:58}],43:[function(e,t,n){var i=e("util"),r=e("precond"),o=e("./strategy");function a(e){o.call(this,e);this.backoffDelay_=0;this.nextBackoffDelay_=this.getInitialDelay();this.factor_=a.DEFAULT_FACTOR;if(e&&void 0!==e.factor){r.checkArgument(e.factor>1,"Exponential factor should be greater than 1 but got %s.",e.factor);this.factor_=e.factor}}i.inherits(a,o);a.DEFAULT_FACTOR=2;a.prototype.next_=function(){this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay());this.nextBackoffDelay_=this.backoffDelay_*this.factor_;return this.backoffDelay_};a.prototype.reset_=function(){this.backoffDelay_=0;this.nextBackoffDelay_=this.getInitialDelay()};t.exports=a},{"./strategy":45,precond:48,util:58}],44:[function(e,t,n){var i=e("util"),r=e("./strategy");function o(e){r.call(this,e);this.backoffDelay_=0;this.nextBackoffDelay_=this.getInitialDelay()}i.inherits(o,r);o.prototype.next_=function(){var e=Math.min(this.nextBackoffDelay_,this.getMaxDelay());this.nextBackoffDelay_+=this.backoffDelay_;this.backoffDelay_=e;return e};o.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay();this.backoffDelay_=0};t.exports=o},{"./strategy":45,util:58}],45:[function(e,t,n){e("events"),e("util");function i(e){return null!=e}function r(e){if(i((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(i(e.maxDelay)&&e.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");this.initialDelay_=e.initialDelay||100;this.maxDelay_=e.maxDelay||1e4;if(this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(i(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=e.randomisationFactor||0}r.prototype.getMaxDelay=function(){return this.maxDelay_};r.prototype.getInitialDelay=function(){return this.initialDelay_};r.prototype.next=function(){var e=this.next_(),t=1+Math.random()*this.randomisationFactor_;return Math.round(e*t)};r.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")};r.prototype.reset=function(){this.reset_()};r.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")};t.exports=r},{events:46,util:58}],46:[function(e,t,n){var i=Object.create||w,r=Object.keys||C,o=Function.prototype.bind||I;function a(){if(!this._events||!Object.prototype.hasOwnProperty.call(this,"_events")){this._events=i(null);this._eventsCount=0}this._maxListeners=this._maxListeners||void 0}t.exports=a;a.EventEmitter=a;a.prototype._events=void 0;a.prototype._maxListeners=void 0;var s,c=10;try{var l={};Object.defineProperty&&Object.defineProperty(l,"x",{value:0});s=0===l.x}catch(e){s=!1}s?Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');c=e}}):a.defaultMaxListeners=c;a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');this._maxListeners=e;return this};function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}a.prototype.getMaxListeners=function(){return u(this)};function d(e,t,n){if(t)e.call(n);else for(var i=e.length,r=E(e,i),o=0;o<i;++o)r[o].call(n)}function p(e,t,n,i){if(t)e.call(n,i);else for(var r=e.length,o=E(e,r),a=0;a<r;++a)o[a].call(n,i)}function f(e,t,n,i,r){if(t)e.call(n,i,r);else for(var o=e.length,a=E(e,o),s=0;s<o;++s)a[s].call(n,i,r)}function h(e,t,n,i,r,o){if(t)e.call(n,i,r,o);else for(var a=e.length,s=E(e,a),c=0;c<a;++c)s[c].call(n,i,r,o)}function m(e,t,n,i){if(t)e.apply(n,i);else for(var r=e.length,o=E(e,r),a=0;a<r;++a)o[a].apply(n,i)}a.prototype.emit=function(e){var t,n,i,r,o,a,s="error"===e;if(a=this._events)s=s&&null==a.error;else if(!s)return!1;if(s){arguments.length>1&&(t=arguments[1]);if(t instanceof Error)throw t;var c=new Error('Unhandled "error" event. ('+t+")");c.context=t;throw c}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(i=arguments.length){case 1:d(n,l,this);break;case 2:p(n,l,this,arguments[1]);break;case 3:f(n,l,this,arguments[1],arguments[2]);break;case 4:h(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:r=new Array(i-1);for(o=1;o<i;o++)r[o-1]=arguments[o];m(n,l,this,r)}return!0};function g(e,t,n,r){var o,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(a=e._events){if(a.newListener){e.emit("newListener",t,n.listener?n.listener:n);a=e._events}s=a[t]}else{a=e._events=i(null);e._eventsCount=0}if(s){"function"==typeof s?s=a[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n);if(!s.warned&&(o=u(e))&&o>0&&s.length>o){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');c.name="MaxListenersExceededWarning";c.emitter=e;c.type=t;c.count=s.length;"object"==typeof console&&console.warn&&console.warn("%s: %s",c.name,c.message)}}else{s=a[t]=n;++e._eventsCount}return e}a.prototype.addListener=function(e,t){return g(this,e,t,!1)};a.prototype.on=a.prototype.addListener;a.prototype.prependListener=function(e,t){return g(this,e,t,!0)};function v(){if(!this.fired){this.target.removeListener(this.type,this.wrapFn);this.fired=!0;switch(arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}}function _(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=o.call(v,i);r.listener=n;i.wrapFn=r;return r}a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');this.on(e,_(this,e,t));return this};a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');this.prependListener(e,_(this,e,t));return this};a.prototype.removeListener=function(e,t){var n,r,o,a,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener===t)if(0==--this._eventsCount)this._events=i(null);else{delete r[e];r.removeListener&&this.emit("removeListener",e,n.listener||t)}else if("function"!=typeof n){o=-1;for(a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){s=n[a].listener;o=a;break}if(o<0)return this;0===o?n.shift():S(n,o);1===n.length&&(r[e]=n[0]);r.removeListener&&this.emit("removeListener",e,s||t)}return this};a.prototype.removeAllListeners=function(e){var t,n,o;if(!(n=this._events))return this;if(!n.removeListener){if(0===arguments.length){this._events=i(null);this._eventsCount=0}else n[e]&&(0==--this._eventsCount?this._events=i(null):delete n[e]);return this}if(0===arguments.length){var a,s=r(n);for(o=0;o<s.length;++o)"removeListener"!==(a=s[o])&&this.removeAllListeners(a);this.removeAllListeners("removeListener");this._events=i(null);this._eventsCount=0;return this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this};function b(e,t,n){var i=e._events;if(!i)return[];var r=i[t];return r?"function"==typeof r?n?[r.listener||r]:[r]:n?T(r):E(r,r.length):[]}a.prototype.listeners=function(e){return b(this,e,!0)};a.prototype.rawListeners=function(e){return b(this,e,!1)};a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):y.call(e,t)};a.prototype.listenerCount=y;function y(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function S(e,t){for(var n=t,i=n+1,r=e.length;i<r;n+=1,i+=1)e[n]=e[i];e.pop()}function E(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function T(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function w(e){var t=function(){};t.prototype=e;return new t}function C(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n}function I(e){var t=this;return function(){return t.apply(e,arguments)}}},{}],47:[function(e,t,i){!function(e,r){"use strict";void 0!==(a="function"==typeof(o=r)?o.call(i,n,i,t):o)&&(t.exports=a)}(0,(function(){"use strict";var e=function(){},t="undefined",n=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments]));console.trace&&console.trace()}function a(i){"debug"===i&&(i="log");return typeof console!==t&&("trace"===i&&n?o:void 0!==console[i]?r(console,i):void 0!==console.log?r(console,"log"):e)}function s(t,n){for(var r=0;r<i.length;r++){var o=i[r];this[o]=r<t?e:this.methodFactory(o,t,n)}this.log=this.debug}function c(e,n,i){return function(){if(typeof console!==t){s.call(this,n,i);this[e].apply(this,arguments)}}}function l(e,t,n){return a(e)||c.apply(this,arguments)}function u(e,n,r){var o,a=this,c="loglevel";e&&(c+=":"+e);function u(e){var n=(i[e]||"silent").toUpperCase();if(typeof window!==t){try{window.localStorage[c]=n;return}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+n+";"}catch(e){}}}function d(){var e;if(typeof window!==t){try{e=window.localStorage[c]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,i=n.indexOf(encodeURIComponent(c)+"=");-1!==i&&(e=/^([^;]+)/.exec(n.slice(i))[1])}catch(e){}void 0===a.levels[e]&&(e=void 0);return e}}a.name=e;a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5};a.methodFactory=r||l;a.getLevel=function(){return o};a.setLevel=function(n,i){"string"==typeof n&&void 0!==a.levels[n.toUpperCase()]&&(n=a.levels[n.toUpperCase()]);if(!("number"==typeof n&&n>=0&&n<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;o=n;!1!==i&&u(n);s.call(a,n,e);if(typeof console===t&&n<a.levels.SILENT)return"No console available for logging"};a.setDefaultLevel=function(e){d()||a.setLevel(e,!1)};a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)};a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var p=d();null==p&&(p=null==n?"WARN":n);a.setLevel(p,!1)}var d=new u,p={};d.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=p[e];t||(t=p[e]=new u(e,d.getLevel(),d.methodFactory));return t};var f=typeof window!==t?window.log:void 0;d.noConflict=function(){typeof window!==t&&window.log===d&&(window.log=f);return d};d.getLoggers=function(){return p};return d}))},{}],48:[function(e,t,n){t.exports=e("./lib/checks")},{"./lib/checks":49}],49:[function(e,t,n){var i=e("util"),r=t.exports=e("./errors");function o(e,t,n,r){n=n||"";var o=new e(i.format.apply(this,[n].concat(r)));Error.captureStackTrace(o,t);throw o}function a(e,t,n){o(r.IllegalArgumentError,e,t,n)}function s(e,t,n){o(r.IllegalStateError,e,t,n)}t.exports.checkArgument=function(e,t){e||a(arguments.callee,t,Array.prototype.slice.call(arguments,2))};t.exports.checkState=function(e,t){e||s(arguments.callee,t,Array.prototype.slice.call(arguments,2))};t.exports.checkIsDef=function(e,t){if(void 0!==e)return e;a(arguments.callee,t||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))};t.exports.checkIsDefAndNotNull=function(e,t){if(null!=e)return e;a(arguments.callee,t||'Expected value to be defined and not null but got "'+c(e)+'".',Array.prototype.slice.call(arguments,2))};function c(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array"}return t}function l(e){return function(t,n){var i=c(t);if(i==e)return t;a(arguments.callee,n||'Expected "'+e+'" but got "'+i+'".',Array.prototype.slice.call(arguments,2))}}t.exports.checkIsString=l("string");t.exports.checkIsArray=l("array");t.exports.checkIsNumber=l("number");t.exports.checkIsBoolean=l("boolean");t.exports.checkIsFunction=l("function");t.exports.checkIsObject=l("object")},{"./errors":50,util:58}],50:[function(e,t,n){var i=e("util");function r(e){Error.call(this,e);this.message=e}i.inherits(r,Error);r.prototype.name="IllegalArgumentError";function o(e){Error.call(this,e);this.message=e}i.inherits(o,Error);o.prototype.name="IllegalStateError";t.exports.IllegalStateError=o;t.exports.IllegalArgumentError=r},{util:58}],51:[function(e,t,n){var i,r,o=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}!function(){try{i="function"==typeof setTimeout?setTimeout:a}catch(e){i=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();function c(e){if(i===setTimeout)return setTimeout(e,0);if((i===a||!i)&&setTimeout){i=setTimeout;return setTimeout(e,0)}try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}function l(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout){r=clearTimeout;return clearTimeout(e)}try{return r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}var u,d=[],p=!1,f=-1;function h(){if(p&&u){p=!1;u.length?d=u.concat(d):f=-1;d.length&&m()}}function m(){if(!p){var e=c(h);p=!0;for(var t=d.length;t;){u=d;d=[];for(;++f<t;)u&&u[f].run();f=-1;t=d.length}u=null;p=!1;l(e)}}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.push(new g(e,t));1!==d.length||p||c(m)};function g(e,t){this.fun=e;this.array=t}g.prototype.run=function(){this.fun.apply(null,this.array)};o.title="browser";o.browser=!0;o.env={};o.argv=[];o.version="";o.versions={};function v(){}o.on=v;o.addListener=v;o.once=v;o.off=v;o.removeListener=v;o.removeAllListeners=v;o.emit=v;o.prependListener=v;o.prependOnceListener=v;o.listeners=function(e){return[]};o.binding=function(e){throw new Error("process.binding is not supported")};o.cwd=function(){return"/"};o.chdir=function(e){throw new Error("process.chdir is not supported")};o.umask=function(){return 0}},{}],52:[function(e,t,n){var i=function(){return this}()||Function("return this")(),r=i.regeneratorRuntime&&Object.getOwnPropertyNames(i).indexOf("regeneratorRuntime")>=0,o=r&&i.regeneratorRuntime;i.regeneratorRuntime=void 0;t.exports=e("./runtime");if(r)i.regeneratorRuntime=o;else try{delete i.regeneratorRuntime}catch(e){i.regeneratorRuntime=void 0}},{"./runtime":53}],53:[function(e,t,n){!function(e){"use strict";var n,i=Object.prototype,r=i.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag",l="object"==typeof t,u=e.regeneratorRuntime;if(u)l&&(t.exports=u);else{(u=e.regeneratorRuntime=l?t.exports:{}).wrap=y;var d="suspendedStart",p="suspendedYield",f="executing",h="completed",m={},g={};g[a]=function(){return this};var v=Object.getPrototypeOf,_=v&&v(v(R([])));_&&_!==i&&r.call(_,a)&&(g=_);var b=w.prototype=E.prototype=Object.create(g);T.prototype=b.constructor=w;w.constructor=T;w[c]=T.displayName="GeneratorFunction";u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===T||"GeneratorFunction"===(t.displayName||t.name))};u.mark=function(e){if(Object.setPrototypeOf)Object.setPrototypeOf(e,w);else{e.__proto__=w;c in e||(e[c]="GeneratorFunction")}e.prototype=Object.create(b);return e};u.awrap=function(e){return{__await:e}};C(I.prototype);I.prototype[s]=function(){return this};u.AsyncIterator=I;u.async=function(e,t,n,i){var r=new I(y(e,t,n,i));return u.isGeneratorFunction(t)?r:r.next().then((function(e){return e.done?e.value:r.next()}))};C(b);b[c]="Generator";b[a]=function(){return this};b.toString=function(){return"[object Generator]"};u.keys=function(e){var t=[];for(var n in e)t.push(n);t.reverse();return function n(){for(;t.length;){var i=t.pop();if(i in e){n.value=i;n.done=!1;return n}}n.done=!0;return n}};u.values=R;P.prototype={constructor:P,reset:function(e){this.prev=0;this.next=0;this.sent=this._sent=n;this.done=!1;this.delegate=null;this.method="next";this.arg=n;this.tryEntries.forEach(A);if(!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,r){s.type="throw";s.arg=e;t.next=i;if(r){t.method="next";t.arg=n}return!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};a.type=e;a.arg=t;if(o){this.method="next";this.next=o.finallyLoc;return m}return this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;if("break"===e.type||"continue"===e.type)this.next=e.arg;else if("return"===e.type){this.rval=this.arg=e.arg;this.method="return";this.next="end"}else"normal"===e.type&&t&&(this.next=t);return m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e){this.complete(n.completion,n.afterLoc);A(n);return m}}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;A(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){this.delegate={iterator:R(e),resultName:t,nextLoc:i};"next"===this.method&&(this.arg=n);return m}}}function y(e,t,n,i){var r=t&&t.prototype instanceof E?t:E,o=Object.create(r.prototype),a=new P(i||[]);o._invoke=O(e,n,a);return o}function S(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function E(){}function T(){}function w(){}function C(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function I(e){function t(n,i,o,a){var s=S(e[n],e,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?Promise.resolve(l.__await).then((function(e){t("next",e,o,a)}),(function(e){t("throw",e,o,a)})):Promise.resolve(l).then((function(e){c.value=e;o(c)}),a)}a(s.arg)}var n;function i(e,i){function r(){return new Promise((function(n,r){t(e,i,n,r)}))}return n=n?n.then(r,r):r()}this._invoke=i}function O(e,t,n){var i=d;return function(r,o){if(i===f)throw new Error("Generator is already running");if(i===h){if("throw"===r)throw o;return k()}n.method=r;n.arg=o;for(;;){var a=n.delegate;if(a){var s=j(a,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===d){i=h;throw n.arg}n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var c=S(e,t,n);if("normal"===c.type){i=n.done?h:p;if(c.arg===m)continue;return{value:c.arg,done:n.done}}if("throw"===c.type){i=h;n.method="throw";n.arg=c.arg}}}}function j(e,t){var i=e.iterator[t.method];if(i===n){t.delegate=null;if("throw"===t.method){if(e.iterator.return){t.method="return";t.arg=n;j(e,t);if("throw"===t.method)return m}t.method="throw";t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var r=S(i,e.iterator,t.arg);if("throw"===r.type){t.method="throw";t.arg=r.arg;t.delegate=null;return m}var o=r.arg;if(!o){t.method="throw";t.arg=new TypeError("iterator result is not an object");t.delegate=null;return m}if(!o.done)return o;t[e.resultName]=o.value;t.next=e.nextLoc;if("return"!==t.method){t.method="next";t.arg=n}t.delegate=null;return m}function D(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]);if(2 in e){t.finallyLoc=e[2];t.afterLoc=e[3]}this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal";delete t.arg;e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}];e.forEach(D,this);this.reset(!0)}function R(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function t(){for(;++i<e.length;)if(r.call(e,i)){t.value=e[i];t.done=!1;return t}t.value=n;t.done=!0;return t};return o.next=o}}return{next:k}}function k(){return{value:n,done:!0}}}(function(){return this}()||Function("return this")())},{}],54:[function(e,t,n){"use strict";var i=e("sdp");function r(e,t,n,r,o){var a=i.writeRtpDescription(e.kind,t);a+=i.writeIceParameters(e.iceGatherer.getLocalParameters());a+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":o||"active");a+="a=mid:"+e.mid+"\r\n";e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n";if(e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(r?r.id:"-")+" "+s+"\r\n";a+="a="+c;a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c;if(e.sendEncodingParameters[0].rtx){a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c;a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n";e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n");return a}function o(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r="string"==typeof i;r&&(i=[i]);i=i.filter((function(e){if(0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!n){n=!0;return!0}return 0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}));delete e.url;e.urls=r?i[0]:i;return!!i.length}}))}function a(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},r=function(e,t,n,r){var o=i(e.parameters.apt,n),a=i(t.parameters.apt,r);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};e.codecs.forEach((function(i){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(i.name.toLowerCase()===a.name.toLowerCase()&&i.clockRate===a.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&a.parameters.apt&&!r(i,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(i.numChannels,a.numChannels);n.codecs.push(a);a.rtcpFeedback=a.rtcpFeedback.filter((function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}}));e.headerExtensions.forEach((function(e){for(var i=0;i<t.headerExtensions.length;i++){var r=t.headerExtensions[i];if(e.uri===r.uri){n.headerExtensions.push(r);break}}}));return n}function s(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function c(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));n||e.addRemoteCandidate(t);return!n}function l(e,t){var n=new Error(t);n.name=e;return n}t.exports=function(e,t){function n(t,n){n.addTrack(t);n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,n){n.removeTrack(t);n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}function d(t,n,i,r){var o=new Event("track");o.track=n;o.receiver=i;o.transceiver={receiver:i};o.streams=r;e.setTimeout((function(){t._dispatchEvent("track",o)}))}var p=function(n){var r=this,a=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){r[e]=a[e].bind(a)}));this.canTrickleIceCandidates=null;this.needNegotiation=!1;this.localStreams=[];this.remoteStreams=[];this.localDescription=null;this.remoteDescription=null;this.signalingState="stable";this.iceConnectionState="new";this.iceGatheringState="new";n=JSON.parse(JSON.stringify(n||{}));this.usingBundle="max-bundle"===n.bundlePolicy;if("negotiate"===n.rtcpMuxPolicy)throw l("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require");switch(n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}n.iceServers=o(n.iceServers||[],t);this._iceGatherers=[];if(n.iceCandidatePoolSize)for(var s=n.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n;this.transceivers=[];this._sdpSessionId=i.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=void 0;this._isClosed=!1};p.prototype.onicecandidate=null;p.prototype.onaddstream=null;p.prototype.ontrack=null;p.prototype.onremovestream=null;p.prototype.onsignalingstatechange=null;p.prototype.oniceconnectionstatechange=null;p.prototype.onicegatheringstatechange=null;p.prototype.onnegotiationneeded=null;p.prototype.ondatachannel=null;p.prototype._dispatchEvent=function(e,t){if(!this._isClosed){this.dispatchEvent(t);"function"==typeof this["on"+e]&&this["on"+e](t)}};p.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)};p.prototype.getConfiguration=function(){return this._config};p.prototype.getLocalStreams=function(){return this.localStreams};p.prototype.getRemoteStreams=function(){return this.remoteStreams};p.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&t){n.iceTransport=this.transceivers[0].iceTransport;n.dtlsTransport=this.transceivers[0].dtlsTransport}else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport;n.dtlsTransport=i.dtlsTransport}this.transceivers.push(n);return n};p.prototype.addTrack=function(t,n){if(this._isClosed)throw l("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i;if(this.transceivers.find((function(e){return e.track===t})))throw l("InvalidAccessError","Track already exists.");for(var r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==t.kind||(i=this.transceivers[r]);i||(i=this._createTransceiver(t.kind));this._maybeFireNegotiationNeeded();-1===this.localStreams.indexOf(n)&&this.localStreams.push(n);i.track=t;i.stream=n;i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport);return i.rtpSender};p.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var i=e.clone();e.getTracks().forEach((function(e,t){var n=i.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))}));i.getTracks().forEach((function(e){n.addTrack(e,i)}))}};p.prototype.removeTrack=function(t){if(this._isClosed)throw l("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw l("InvalidAccessError","Sender was not created by this connection.");var i=n.stream;n.rtpSender.stop();n.rtpSender=null;n.track=null;n.stream=null;-1===this.transceivers.map((function(e){return e.stream})).indexOf(i)&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1);this._maybeFireNegotiationNeeded()};p.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))};p.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))};p.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))};p.prototype._createIceGatherer=function(t,n){var i=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var r=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(r,"state",{value:"new",writable:!0});this.transceivers[t].bufferedCandidateEvents=[];this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;r.state=n?"completed":"gathering";null!==i.transceivers[t].bufferedCandidateEvents&&i.transceivers[t].bufferedCandidateEvents.push(e)};r.addEventListener("localcandidate",this.transceivers[t].bufferCandidates);return r};p.prototype._gather=function(t,n){var r=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null;o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates);o.onlocalcandidate=function(e){if(!(r.usingBundle&&n>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering");s.component=1;var l=i.writeCandidate(s);a.candidate=Object.assign(a.candidate,i.parseCandidate(l));a.candidate.candidate=l}var u=i.getMediaSections(r.localDescription.sdp);u[a.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n";r.localDescription.sdp=i.getDescription(r.localDescription.sdp)+u.join("");var d=r.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));if("gathering"!==r.iceGatheringState){r.iceGatheringState="gathering";r._emitGatheringStateChange()}c||r._dispatchEvent("icecandidate",a);if(d){r._dispatchEvent("icecandidate",new Event("icecandidate"));r.iceGatheringState="complete";r._emitGatheringStateChange()}}};e.setTimeout((function(){a.forEach((function(e){o.onlocalcandidate(e)}))}),0)}};p.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateConnectionState()};var i=new e.RTCDtlsTransport(n);i.ondtlsstatechange=function(){t._updateConnectionState()};i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0});t._updateConnectionState()};return{iceTransport:n,dtlsTransport:i}};p.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;if(t){delete t.onlocalcandidate;delete this.transceivers[e].iceGatherer}var n=this.transceivers[e].iceTransport;if(n){delete n.onicestatechange;delete this.transceivers[e].iceTransport}var i=this.transceivers[e].dtlsTransport;if(i){delete i.ondtlsstatechange;delete i.onerror;delete this.transceivers[e].dtlsTransport}};p.prototype._transceive=function(e,n,r){var o=a(e.localCapabilities,e.remoteCapabilities);if(n&&e.rtpSender){o.encodings=e.sendEncodingParameters;o.rtcp={cname:i.localCName,compound:e.rtcpParameters.compound};e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc);e.rtpSender.send(o)}if(r&&e.rtpReceiver&&o.codecs.length>0){"video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx}));e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}];o.rtcp={compound:e.rtcpParameters.compound};e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname);e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc);e.rtpReceiver.receive(o)}};p.prototype.setLocalDescription=function(e){var t,n,r=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(l("TypeError",'Unsupported type "'+e.type+'"'));if(!s("setLocalDescription",e.type,r.signalingState)||r._isClosed)return Promise.reject(l("InvalidStateError","Can not set local "+e.type+" in state "+r.signalingState));if("offer"===e.type){t=i.splitSections(e.sdp);n=t.shift();t.forEach((function(e,t){var n=i.parseRtpParameters(e);r.transceivers[t].localCapabilities=n}));r.transceivers.forEach((function(e,t){r._gather(e.mid,t)}))}else if("answer"===e.type){t=i.splitSections(r.remoteDescription.sdp);n=t.shift();var o=i.matchPrefix(n,"a=ice-lite").length>0;t.forEach((function(e,t){var s=r.transceivers[t],c=s.iceGatherer,l=s.iceTransport,u=s.dtlsTransport,d=s.localCapabilities,p=s.remoteCapabilities;if(!(i.isRejected(e)&&0===i.matchPrefix(e,"a=bundle-only").length||s.isDatachannel)){var f=i.getIceParameters(e,n),h=i.getDtlsParameters(e,n);o&&(h.role="server");if(!r.usingBundle||0===t){r._gather(s.mid,t);"new"===l.state&&l.start(c,f,o?"controlling":"controlled");"new"===u.state&&u.start(h)}var m=a(d,p);r._transceive(s,m.codecs.length>0,!1)}}))}r.localDescription={type:e.type,sdp:e.sdp};"offer"===e.type?r._updateSignalingState("have-local-offer"):r._updateSignalingState("stable");return Promise.resolve()};p.prototype.setRemoteDescription=function(r){var o=this;if(-1===["offer","answer"].indexOf(r.type))return Promise.reject(l("TypeError",'Unsupported type "'+r.type+'"'));if(!s("setRemoteDescription",r.type,o.signalingState)||o._isClosed)return Promise.reject(l("InvalidStateError","Can not set remote "+r.type+" in state "+o.signalingState));var a={};o.remoteStreams.forEach((function(e){a[e.id]=e}));var p=[],f=i.splitSections(r.sdp),h=f.shift(),m=i.matchPrefix(h,"a=ice-lite").length>0,g=i.matchPrefix(h,"a=group:BUNDLE ").length>0;o.usingBundle=g;var v=i.matchPrefix(h,"a=ice-options:")[0];o.canTrickleIceCandidates=!!v&&v.substr(14).split(" ").indexOf("trickle")>=0;f.forEach((function(s,l){var d=i.splitLines(s),f=i.getKind(s),v=i.isRejected(s)&&0===i.matchPrefix(s,"a=bundle-only").length,_=d[0].substr(2).split(" ")[2],b=i.getDirection(s,h),y=i.parseMsid(s),S=i.getMid(s)||i.generateIdentifier();if("application"!==f||"DTLS/SCTP"!==_){var E,T,w,C,I,O,j,D,A,P,R,k=i.parseRtpParameters(s);if(!v){P=i.getIceParameters(s,h);(R=i.getDtlsParameters(s,h)).role="client"}j=i.parseRtpEncodingParameters(s);var x=i.parseRtcpParameters(s),L=i.matchPrefix(s,"a=end-of-candidates",h).length>0,M=i.matchPrefix(s,"a=candidate:").map((function(e){return i.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===r.type||"answer"===r.type)&&!v&&g&&l>0&&o.transceivers[l]){o._disposeIceAndDtlsTransports(l);o.transceivers[l].iceGatherer=o.transceivers[0].iceGatherer;o.transceivers[l].iceTransport=o.transceivers[0].iceTransport;o.transceivers[l].dtlsTransport=o.transceivers[0].dtlsTransport;o.transceivers[l].rtpSender&&o.transceivers[l].rtpSender.setTransport(o.transceivers[0].dtlsTransport);o.transceivers[l].rtpReceiver&&o.transceivers[l].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)}if("offer"!==r.type||v){if("answer"===r.type&&!v){T=(E=o.transceivers[l]).iceGatherer;w=E.iceTransport;C=E.dtlsTransport;I=E.rtpReceiver;O=E.sendEncodingParameters;D=E.localCapabilities;o.transceivers[l].recvEncodingParameters=j;o.transceivers[l].remoteCapabilities=k;o.transceivers[l].rtcpParameters=x;M.length&&"new"===w.state&&(!m&&!L||g&&0!==l?M.forEach((function(e){c(E.iceTransport,e)})):w.setRemoteCandidates(M));if(!g||0===l){"new"===w.state&&w.start(T,P,"controlling");"new"===C.state&&C.start(R)}o._transceive(E,"sendrecv"===b||"recvonly"===b,"sendrecv"===b||"sendonly"===b);if(!I||"sendrecv"!==b&&"sendonly"!==b)delete E.rtpReceiver;else{A=I.track;if(y){a[y.stream]||(a[y.stream]=new e.MediaStream);n(A,a[y.stream]);p.push([A,I,a[y.stream]])}else{a.default||(a.default=new e.MediaStream);n(A,a.default);p.push([A,I,a.default])}}}}else{(E=o.transceivers[l]||o._createTransceiver(f)).mid=S;E.iceGatherer||(E.iceGatherer=o._createIceGatherer(l,g));M.length&&"new"===E.iceTransport.state&&(!L||g&&0!==l?M.forEach((function(e){c(E.iceTransport,e)})):E.iceTransport.setRemoteCandidates(M));D=e.RTCRtpReceiver.getCapabilities(f);t<15019&&(D.codecs=D.codecs.filter((function(e){return"rtx"!==e.name})));O=E.sendEncodingParameters||[{ssrc:1001*(2*l+2)}];var N=!1;if("sendrecv"===b||"sendonly"===b){N=!E.rtpReceiver;I=E.rtpReceiver||new e.RTCRtpReceiver(E.dtlsTransport,f);if(N){var G;A=I.track;if(y&&"-"===y.stream);else if(y){if(!a[y.stream]){a[y.stream]=new e.MediaStream;Object.defineProperty(a[y.stream],"id",{get:function(){return y.stream}})}Object.defineProperty(A,"id",{get:function(){return y.track}});G=a[y.stream]}else{a.default||(a.default=new e.MediaStream);G=a.default}if(G){n(A,G);E.associatedRemoteMediaStreams.push(G)}p.push([A,I,G])}}else if(E.rtpReceiver&&E.rtpReceiver.track){E.associatedRemoteMediaStreams.forEach((function(e){var t=e.getTracks().find((function(e){return e.id===E.rtpReceiver.track.id}));t&&u(t,e)}));E.associatedRemoteMediaStreams=[]}E.localCapabilities=D;E.remoteCapabilities=k;E.rtpReceiver=I;E.rtcpParameters=x;E.sendEncodingParameters=O;E.recvEncodingParameters=j;o._transceive(o.transceivers[l],!1,N)}}else o.transceivers[l]={mid:S,isDatachannel:!0}}));void 0===o._dtlsRole&&(o._dtlsRole="offer"===r.type?"active":"passive");o.remoteDescription={type:r.type,sdp:r.sdp};"offer"===r.type?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable");Object.keys(a).forEach((function(t){var n=a[t];if(n.getTracks().length){if(-1===o.remoteStreams.indexOf(n)){o.remoteStreams.push(n);var i=new Event("addstream");i.stream=n;e.setTimeout((function(){o._dispatchEvent("addstream",i)}))}p.forEach((function(e){var t=e[0],i=e[1];n.id===e[2].id&&d(o,t,i,[n])}))}}));p.forEach((function(e){e[2]||d(o,e[0],e[1],[])}));e.setTimeout((function(){o&&o.transceivers&&o.transceivers.forEach((function(e){if(e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0){console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification");e.iceTransport.addRemoteCandidate({})}}))}),4e3);return Promise.resolve()};p.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop();e.dtlsTransport&&e.dtlsTransport.stop();e.rtpSender&&e.rtpSender.stop();e.rtpReceiver&&e.rtpReceiver.stop()}));this._isClosed=!0;this._updateSignalingState("closed")};p.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)};p.prototype._maybeFireNegotiationNeeded=function(){var t=this;if("stable"===this.signalingState&&!0!==this.needNegotiation){this.needNegotiation=!0;e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0)}};p.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach((function(e){t[e.iceTransport.state]++;t[e.dtlsTransport.state]++}));t.connected+=t.completed;e="new";t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":(t.connected>0||t.completed>0)&&(e="connected");if(e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}};p.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(l("InvalidStateError","Can not call createOffer after close"));var o=n.transceivers.filter((function(e){return"audio"===e.kind})).length,a=n.transceivers.filter((function(e){return"video"===e.kind})).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio);void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}n.transceivers.forEach((function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)}));for(;o>0||a>0;){if(o>0){n._createTransceiver("audio");o--}if(a>0){n._createTransceiver("video");a--}}var c=i.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach((function(r,o){var a=r.track,s=r.kind,c=r.mid||i.generateIdentifier();r.mid=c;r.iceGatherer||(r.iceGatherer=n._createIceGatherer(o,n.usingBundle));var l=e.RTCRtpSender.getCapabilities(s);t<15019&&(l.codecs=l.codecs.filter((function(e){return"rtx"!==e.name})));l.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1");r.remoteCapabilities&&r.remoteCapabilities.codecs&&r.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))}));l.headerExtensions.forEach((function(e){(r.remoteCapabilities&&r.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var u=r.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&t>=15019&&"video"===s&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1});r.wantReceive&&(r.rtpReceiver=new e.RTCRtpReceiver(r.dtlsTransport,s));r.localCapabilities=l;r.sendEncodingParameters=u}));"max-compat"!==n._config.bundlePolicy&&(c+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n");c+="a=ice-options:trickle\r\n";n.transceivers.forEach((function(e,t){c+=r(e,e.localCapabilities,"offer",e.stream,n._dtlsRole);c+="a=rtcp-rsize\r\n";if(e.iceGatherer&&"new"!==n.iceGatheringState&&(0===t||!n.usingBundle)){e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1;c+="a="+i.writeCandidate(e)+"\r\n"}));"completed"===e.iceGatherer.state&&(c+="a=end-of-candidates\r\n")}}));var u=new e.RTCSessionDescription({type:"offer",sdp:c});return Promise.resolve(u)};p.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(l("InvalidStateError","Can not call createAnswer after close"));var o=i.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(o+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n");var s=i.getMediaSections(n.remoteDescription.sdp).length;n.transceivers.forEach((function(e,i){if(!(i+1>s))if(e.isDatachannel)o+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n";else{if(e.stream){var c;"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]);c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}var l=a(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx;o+=r(e,l,"answer",e.stream,n._dtlsRole);e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}}));var c=new e.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(c)};p.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(r,o){if(!n.remoteDescription)return o(l("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var s=0;s<n.transceivers.length;s++)if(n.transceivers[s].mid===e.sdpMid){a=s;break}var u=n.transceivers[a];if(!u)return o(l("OperationError","Can not add ICE candidate"));if(u.isDatachannel)return r();var d=Object.keys(e.candidate).length>0?i.parseCandidate(e.candidate):{};if("tcp"===d.protocol&&(0===d.port||9===d.port))return r();if(d.component&&1!==d.component)return r();if((0===a||a>0&&u.iceTransport!==n.transceivers[0].iceTransport)&&!c(u.iceTransport,d))return o(l("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2));(t=i.getMediaSections(n.remoteDescription.sdp))[a]+="a="+(d.type?p:"end-of-candidates")+"\r\n";n.remoteDescription.sdp=t.join("")}else for(var f=0;f<n.transceivers.length;f++)if(!n.transceivers[f].isDatachannel){n.transceivers[f].iceTransport.addRemoteCandidate({});(t=i.getMediaSections(n.remoteDescription.sdp))[f]+="a=end-of-candidates\r\n";n.remoteDescription.sdp=i.getDescription(n.remoteDescription.sdp)+t.join("");if(n.usingBundle)break}r()}))};p.prototype.getStats=function(){var e=[];this.transceivers.forEach((function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(n){t[n]&&e.push(t[n].getStats())}))}));var t=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise((function(n){var i=new Map;Promise.all(e).then((function(e){e.forEach((function(e){Object.keys(e).forEach((function(n){e[n].type=t(e[n]);i.set(n,e[n])}))}));n(i)}))}))};var f=["createOffer","createAnswer"];f.forEach((function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}}));(f=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}}));["getStats"].forEach((function(e){var t=p.prototype[e];p.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}}));return p}},{sdp:55}],55:[function(e,t,n){"use strict";var i={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};i.localCName=i.generateIdentifier();i.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))};i.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))};i.getDescription=function(e){var t=i.splitSections(e);return t&&t[0]};i.getMediaSections=function(e){var t=i.splitSections(e);t.shift();return t};i.matchPrefix=function(e,t){return i.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))};i.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1];n.usernameFragment=t[i+1];break;default:n[t[i]]=t[i+1]}return n};i.writeCandidate=function(e){var t=[];t.push(e.foundation);t.push(e.component);t.push(e.protocol.toUpperCase());t.push(e.priority);t.push(e.address||e.ip);t.push(e.port);var n=e.type;t.push("typ");t.push(n);if("host"!==n&&e.relatedAddress&&e.relatedPort){t.push("raddr");t.push(e.relatedAddress);t.push("rport");t.push(e.relatedPort)}if(e.tcpType&&"tcp"===e.protocol.toLowerCase()){t.push("tcptype");t.push(e.tcpType)}if(e.usernameFragment||e.ufrag){t.push("ufrag");t.push(e.usernameFragment||e.ufrag)}return"candidate:"+t.join(" ")};i.parseIceOptions=function(e){return e.substr(14).split(" ")};i.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};t=t[0].split("/");n.name=t[0];n.clockRate=parseInt(t[1],10);n.channels=3===t.length?parseInt(t[2],10):1;n.numChannels=n.channels;return n};i.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"};i.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}};i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"};i.parseFmtp=function(e){for(var t,n={},i=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)n[(t=i[r].trim().split("="))[0].trim()]=t[1];return n};i.writeFmtp=function(e){var t="",n=e.payloadType;void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType);if(e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}));t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t};i.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}};i.writeRtcpFb=function(e){var t="",n=e.payloadType;void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType);e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}));return t};i.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);if(i>-1){n.attribute=e.substr(t+1,i-t-1);n.value=e.substr(i+1)}else n.attribute=e.substr(t+1);return n};i.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}};i.getMid=function(e){var t=i.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)};i.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}};i.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:i.matchPrefix(e+t,"a=fingerprint:").map(i.parseFingerprint)}};i.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}));return n};i.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}};i.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?i.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"};i.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}};i.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")};i.getCryptoParameters=function(e,t){return i.matchPrefix(e+t,"a=crypto:").map(i.parseCryptoLine)};i.getIceParameters=function(e,t){var n=i.matchPrefix(e+t,"a=ice-ufrag:")[0],r=i.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substr(12),password:r.substr(10)}:null};i.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"};i.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=i.splitLines(e)[0].split(" "),r=3;r<n.length;r++){var o=n[r],a=i.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=i.parseRtpMap(a),c=i.matchPrefix(e,"a=fmtp:"+o+" ");s.parameters=c.length?i.parseFmtp(c[0]):{};s.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(i.parseRtcpFb);t.codecs.push(s);switch(s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}i.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(i.parseExtmap(e))}));return t};i.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ";n+=t.codecs.length>0?"9":"0";n+=" UDP/TLS/RTP/SAVPF ";n+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n";n+="c=IN IP4 0.0.0.0\r\n";n+="a=rtcp:9 IN IP4 0.0.0.0\r\n";t.codecs.forEach((function(e){n+=i.writeRtpMap(e);n+=i.writeFmtp(e);n+=i.writeRtcpFb(e)}));var r=0;t.codecs.forEach((function(e){e.maxptime>r&&(r=e.maxptime)}));r>0&&(n+="a=maxptime:"+r+"\r\n");n+="a=rtcp-mux\r\n";t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=i.writeExtmap(e)}));return n};i.parseRtpEncodingParameters=function(e){var t,n=[],r=i.parseRtpParameters(e),o=-1!==r.fecMechanisms.indexOf("RED"),a=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,l=i.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));l.length>0&&l[0].length>1&&l[0][0]===c&&(t=l[0][1]);r.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var i={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(i.rtx={ssrc:t});n.push(i);if(o){(i=JSON.parse(JSON.stringify(i))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"};n.push(i)}}}));0===n.length&&c&&n.push({ssrc:c});var u=i.matchPrefix(e,"b=");if(u.length){u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0;n.forEach((function(e){e.maxBitrate=u}))}return n};i.parseRtcpParameters=function(e){var t={},n=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];if(n){t.cname=n.value;t.ssrc=n.ssrc}var r=i.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=r.length>0;t.compound=0===r.length;var o=i.matchPrefix(e,"a=rtcp-mux");t.mux=o.length>0;return t};i.parseMsid=function(e){var t,n=i.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var r=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return r.length>0?{stream:(t=r[0].value.split(" "))[0],track:t[1]}:void 0};i.parseSctpDescription=function(e){var t,n=i.parseMLine(e),r=i.matchPrefix(e,"a=max-message-size:");r.length>0&&(t=parseInt(r[0].substr(19),10));isNaN(t)&&(t=65536);var o=i.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(i.matchPrefix(e,"a=sctpmap:").length>0){var a=i.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}};i.writeSctpDescription=function(e,t){var n=[];n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"];void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n");return n.join("")};i.generateSessionId=function(){return Math.random().toString().substr(2,21)};i.writeSessionBoilerplate=function(e,t,n){var r=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||i.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};i.writeMediaSection=function(e,t,n,r){var o=i.writeRtpDescription(e.kind,t);o+=i.writeIceParameters(e.iceGatherer.getLocalParameters());o+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active");o+="a=mid:"+e.mid+"\r\n";e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n";if(e.rtpSender){var a="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a;o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a;if(e.sendEncodingParameters[0].rtx){o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a;o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n";e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n");return o};i.getDirection=function(e,t){for(var n=i.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?i.getDirection(t):"sendrecv"};i.getKind=function(e){return i.splitLines(e)[0].split(" ")[0].substr(2)};i.isRejected=function(e){return"0"===e.split(" ",2)[1]};i.parseMLine=function(e){var t=i.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}};i.parseOLine=function(e){var t=i.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}};i.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=i.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0};"object"==typeof t&&(t.exports=i)},{}],56:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t;e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype;e.prototype=new n;e.prototype.constructor=e}},{}],57:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],58:[function(e,t,n){(function(t,i){var r=/%[sdj%]/g;n.format=function(e){if(!E(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,o=i.length,a=String(e).replace(r,(function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}})),c=i[n];n<o;c=i[++n])b(c)||!I(c)?a+=" "+c:a+=" "+s(c);return a};n.deprecate=function(e,r){if(w(i.process))return function(){return n.deprecate(e,r).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;function a(){if(!o){if(t.throwDeprecation)throw new Error(r);t.traceDeprecation?console.trace(r):console.error(r);o=!0}return e.apply(this,arguments)}return a};var o,a={};n.debuglog=function(e){w(o)&&(o=t.env.NODE_DEBUG||"");e=e.toUpperCase();if(!a[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var i=t.pid;a[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,i,t)}}else a[e]=function(){};return a[e]};function s(e,t){var i={seen:[],stylize:l};arguments.length>=3&&(i.depth=arguments[2]);arguments.length>=4&&(i.colors=arguments[3]);_(t)?i.showHidden=t:t&&n._extend(i,t);w(i.showHidden)&&(i.showHidden=!1);w(i.depth)&&(i.depth=2);w(i.colors)&&(i.colors=!1);w(i.customInspect)&&(i.customInspect=!0);i.colors&&(i.stylize=c);return d(i,e,i.depth)}n.inspect=s;s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function c(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function l(e,t){return e}function u(e){var t={};e.forEach((function(e,n){t[e]=!0}));return t}function d(e,t,i){if(e.customInspect&&t&&D(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(i,e);E(r)||(r=d(e,r,i));return r}var o=p(e,t);if(o)return o;var a=Object.keys(t),s=u(a);e.showHidden&&(a=Object.getOwnPropertyNames(t));if(j(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return f(t);if(0===a.length){if(D(t)){var c=t.name?": "+t.name:"";return e.stylize("[Function"+c+"]","special")}if(C(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(O(t))return e.stylize(Date.prototype.toString.call(t),"date");if(j(t))return f(t)}var l,_="",b=!1,y=["{","}"];if(v(t)){b=!0;y=["[","]"]}D(t)&&(_=" [Function"+(t.name?": "+t.name:"")+"]");C(t)&&(_=" "+RegExp.prototype.toString.call(t));O(t)&&(_=" "+Date.prototype.toUTCString.call(t));j(t)&&(_=" "+f(t));if(0===a.length&&(!b||0==t.length))return y[0]+_+y[1];if(i<0)return C(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);l=b?h(e,t,i,s,a):a.map((function(n){return m(e,t,i,s,n,b)}));e.seen.pop();return g(l,_,y)}function p(e,t){if(w(t))return e.stylize("undefined","undefined");if(E(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return S(t)?e.stylize(""+t,"number"):_(t)?e.stylize(""+t,"boolean"):b(t)?e.stylize("null","null"):void 0}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,n,i,r){for(var o=[],a=0,s=t.length;a<s;++a)L(t,String(a))?o.push(m(e,t,n,i,String(a),!0)):o.push("");r.forEach((function(r){r.match(/^\d+$/)||o.push(m(e,t,n,i,r,!0))}));return o}function m(e,t,n,i,r,o){var a,s,c;(c=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?s=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(s=e.stylize("[Setter]","special"));L(i,r)||(a="["+r+"]");s||(e.seen.indexOf(c.value)<0?(s=b(n)?d(e,c.value,null):d(e,c.value,n-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special"));if(w(a)){if(o&&r.match(/^\d+$/))return s;if((a=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){a=a.substr(1,a.length-2);a=e.stylize(a,"name")}else{a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");a=e.stylize(a,"string")}}return a+": "+s}function g(e,t,n){return e.reduce((function(e,t){t.indexOf("\n");return e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function v(e){return Array.isArray(e)}n.isArray=v;function _(e){return"boolean"==typeof e}n.isBoolean=_;function b(e){return null===e}n.isNull=b;function y(e){return null==e}n.isNullOrUndefined=y;function S(e){return"number"==typeof e}n.isNumber=S;function E(e){return"string"==typeof e}n.isString=E;function T(e){return"symbol"==typeof e}n.isSymbol=T;function w(e){return void 0===e}n.isUndefined=w;function C(e){return I(e)&&"[object RegExp]"===P(e)}n.isRegExp=C;function I(e){return"object"==typeof e&&null!==e}n.isObject=I;function O(e){return I(e)&&"[object Date]"===P(e)}n.isDate=O;function j(e){return I(e)&&("[object Error]"===P(e)||e instanceof Error)}n.isError=j;function D(e){return"function"==typeof e}n.isFunction=D;function A(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}n.isPrimitive=A;n.isBuffer=e("./support/isBuffer");function P(e){return Object.prototype.toString.call(e)}function R(e){return e<10?"0"+e.toString(10):e.toString(10)}var k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function x(){var e=new Date,t=[R(e.getHours()),R(e.getMinutes()),R(e.getSeconds())].join(":");return[e.getDate(),k[e.getMonth()],t].join(" ")}n.log=function(){console.log("%s - %s",x(),n.format.apply(n,arguments))};n.inherits=e("inherits");n._extend=function(e,t){if(!t||!I(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e};function L(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}).call(this,e("_process"),void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":57,_process:51,inherits:56}]},{},[3])(3),void 0!==(a=function(){return s}.apply(t,[]))&&(e.exports=a)}).call(this,n("H9b4"))},ON69:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("P4dz"),r=n("fBvv"),o=n("llmf");function a(e){if(!e)return!1;return Object(i.g)(e,r.w)===o.a}},ge5o:function(e,t,n){"use strict";var i=n("QYOI");const r=Object(i.Record)({type:null,icon:null,label:null,engagementType:null,onboardingAware:!1,Component:null,wrappers:Object(i.Seq)(),passthruRtePlugins:void 0,localTransforms:Object(i.Seq)(),applicable:()=>!0},"InteractionDescriptorRecord");t.a=r},lOuL:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n("Oc1M"),r=n.n(i),o=n("jI6T"),a=n("Nw75"),s=n("VfuR"),c=n.n(s),l=n("folk");const u=r()(o.a),d={propTypes:{taskId:c.a.number},stores:[l.a],deref({taskId:e}){if(!e)return a.b;const t=l.a.get(e);return t?u(t):a.b}}},"t+2z":function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));n.d(t,"b",(function(){return l}));n.d(t,"f",(function(){return f}));n.d(t,"g",(function(){return h}));n.d(t,"h",(function(){return m}));n.d(t,"e",(function(){return g}));n.d(t,"c",(function(){return v}));n.d(t,"d",(function(){return _}));n.d(t,"m",(function(){return y}));n.d(t,"j",(function(){return S}));n.d(t,"i",(function(){return E}));n.d(t,"k",(function(){return T}));n.d(t,"l",(function(){return w}));var i=n("0xjy"),r=n("7OzJ");const o="record",a="taskQueueBarInteraction",s={BACK_TO_TASKS:"backToTasks",COMPLETED:"completed",RESCHEDULED:"rescheduled",SKIPPED:"skipped",SKIP_TO_REMAINING_TASK:"skipToRemainingTask",VIEW_REMAINING_TASKS:"viewRemainingTasks"},c={LOG_ACTIVITY_AND_COMPLETE_TASK:"logActivityAndCompleteTask",LOG_CALL_AND_COMPLETE_TASK:"logCallAndCompleteTask",LOG_EMAIL_AND_COMPLETE_TASK:"logEmailAndCompleteTask",LOG_MEETING_AND_COMPLETE_TASK:"logMeetingAndCompleteTask",QUEUE_BAR_BUTTON:"queueBarButton",SAVE_CALL_AND_COMPLETE_TASK:"saveCallAndCompleteTask",SAVE_NOTE_AND_COMPLETE_TASK:"saveNoteAndCompleteTask",SCHEDULE_AND_COMPLETE_TASK:"scheduleAndCompleteTask",SEND_EMAIL_AND_COMPLETE_TASK:"sendEmailAndCompleteTask"},l=e=>{switch(e){case"email":return c.SEND_EMAIL_AND_COMPLETE_TASK;case"logged-email":return c.LOG_EMAIL_AND_COMPLETE_TASK;case"call":return c.SAVE_CALL_AND_COMPLETE_TASK;case"logged-call":return c.LOG_CALL_AND_COMPLETE_TASK;case"note":return c.SAVE_NOTE_AND_COMPLETE_TASK;case"activity":return c.LOG_ACTIVITY_AND_COMPLETE_TASK;case"schedule":return c.SCHEDULE_AND_COMPLETE_TASK;case"logged-meeting":return c.LOG_MEETING_AND_COMPLETE_TASK;default:return null}},u="unassociatedTaskModalInteraction",d={VIEWED:"viewed",ASSOCIATIONS_ADDED:"associationsAdded",DISMISSED:"dismissed",MARKED_COMPLETED:"markedCompleted",SKIPPED:"skipped"};function p(e,t={}){const{queueType:n,source:o,taskType:s}=t;i.a.log(a,{action:e,category:s,source:o,type:n},{namespace:r.i})}function f({queueType:e,source:t,taskType:n}){p(s.COMPLETED,{queueType:e,source:t,taskType:n})}function h({taskType:e}){p(s.RESCHEDULED,{taskType:e})}function m({taskType:e}){p(s.SKIPPED,{taskType:e})}function g(){p(s.SKIP_TO_REMAINING_TASK)}function v(){p(s.VIEW_REMAINING_TASKS)}function _(){p(s.BACK_TO_TASKS)}function b(e,t={}){const{associationCount:n,taskType:a}=t;i.a.log(u,{screen:o,action:e,associationCount:n,taskType:a},{namespace:r.i})}function y({associationCount:e,taskType:t}){b(d.VIEWED,{associationCount:e,taskType:t})}function S(){b(d.DISMISSED)}function E({associationCount:e,taskType:t}){b(d.ASSOCIATIONS_ADDED,{associationCount:e,taskType:t})}function T({taskType:e}){b(d.MARKED_COMPLETED,{taskType:e})}function w({taskType:e}){b(d.SKIPPED,{taskType:e})}},wcGk:function(e,t,n){"use strict";var i=n("0n1C");function r(e){return Object(i.c)(e)||Object(i.d)(e)}t.a=r},zTpe:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var i=n("QgEn"),r=n("sl/w"),o=n("iJaT"),a=n("6A2w"),s=n("AuX0"),c=n("qS8i"),l=n("RCaW"),u=n("DqRu"),d=n("y3ei"),p=n("y0q9");function f(){const e=Object(p.a)().getState().get("callStatus");return[d.INITIALIZING_OUTBOUND_CALL,d.RINGING,d.ANSWERED,d.ENDING].includes(e)}function h({handleConfirm:e,handleReject:t,isQueueTask:n}){const d=f();let p;p=n?d?"calling.hoistedPreventNavigation.inTaskQueue.inProgress":"calling.hoistedPreventNavigation.inTaskQueue.ended":d?"calling.hoistedPreventNavigation.notInTaskQueue.inProgress":"calling.hoistedPreventNavigation.notInTaskQueue.ended";return Object(i.jsxs)(o.a,{use:"conversational",width:600,"data-selenium-test":"calling-prevent-navigation-modal",children:[Object(i.jsx)(a.a,{children:Object(i.jsx)(l.a,{children:Object(i.jsx)(r.a,{message:"calling.preventNavigationTitle"})})}),Object(i.jsx)(c.a,{className:"m-top-3",children:Object(i.jsx)(r.a,{message:p})}),Object(i.jsxs)(s.a,{align:"center",children:[!n&&Object(i.jsx)(u.a,{use:"primary",onClick:e,"data-selenium-test":"calling-prevent-navigation-confirm-button",children:Object(i.jsx)(r.a,{message:"calling.confirmCloseActiveCall.confirmLabel"})}),Object(i.jsx)(u.a,{onClick:t,"data-selenium-test":"calling-prevent-navigation-reject-button",children:Object(i.jsx)(r.a,{message:"calling.confirmCloseActiveCall.rejectLabel"})})]})]})}}}]);
//# sourceMappingURL=default~hoisted-call-communicator-wrapper-v2.js.map